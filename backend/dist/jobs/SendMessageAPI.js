'use strict';const z=b,B=b;function a(){const E=['externalKey','urlMessageStatus','SendMessageAPI','number','4zrdJhS','166506slHDaz','split','6778240uoMIGY','13259043mJKVNX','15634DPiZxW','./../services/ContactServices/CreateContactService','getWbot','add','whatsapp','error\x20session','NUMBER_NOT_FOUND','__importDefault','@$s.whatsapp.net','__esModule','WebHooksAPI','../libs/wbot-baileys','7412364AVonjC','275030TOECmN','apiConfig','tenantId','type','jid','66WMQfCy','6339245cxAUrU','authToken','8csUuEI','../services/MessageServices/CreateMessageSystemService','defineProperty','findOne','../libs/Queue','158yFdxJM','default','pending'];a=function(){return E;};return a();}(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=parseInt(x(0x16d))/0x1*(-parseInt(x(0x161))/0x2)+-parseInt(x(0x169))/0x3+-parseInt(x(0x168))/0x4*(parseInt(x(0x15a))/0x5)+parseInt(x(0x153))/0x6+parseInt(y(0x16b))/0x7+-parseInt(x(0x15c))/0x8*(-parseInt(y(0x16c))/0x9)+-parseInt(x(0x154))/0xa*(parseInt(x(0x159))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xe8c8e));function b(c,d){const e=a();return b=function(f,g){f=f-0x14c;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[z(0x14e)]||function(c){const A=z;return c&&c[A(0x150)]?c:{'default':c};};Object[z(0x15e)](exports,B(0x150),{'value':!![]});const Queue_1=__importDefault(require(B(0x160))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CreateMessageSystemService_1=__importDefault(require(z(0x15d))),wbot_baileys_1=require(B(0x152)),Contact_1=__importDefault(require('../models/Contact')),CreateContactService_1=__importDefault(require(B(0x16e))),AppError_1=__importDefault(require('../errors/AppError'));exports[B(0x162)]={'key':z(0x166),'options':{'delay':0x1f4,'attempts':0x1,'removeOnComplete':!![],'removeOnFail':![]},async 'handle'({data:c}){const C=z,D=z,d=(0x0,wbot_baileys_1[C(0x16f)])(c['sessionId']);try{const e=c[D(0x167)]+D(0x14f),f=await d['onWhatsApp'](e);if(f[0x0]['exists']==![])throw new AppError_1[(D(0x162))](D(0x14d),0x194);c[D(0x167)]=f[0x0][D(0x158)][D(0x16a)]('@')[0x0];let g=await Contact_1[C(0x162)][D(0x15f)]({'where':{'number':c[D(0x167)],'tenantId':c['tenantId']}});!g&&(g=await(0x0,CreateContactService_1[C(0x162)])({'name':c[C(0x167)],'number':c[C(0x167)],'tenantId':c[C(0x156)]}));const h=await(0x0,FindOrCreateTicketService_1['default'])({'contact':g,'whatsappId':d['id'],'unreadMessages':0x0,'tenantId':c[C(0x156)],'groupContact':undefined,'channel':C(0x171)});await(0x0,CreateMessageSystemService_1[C(0x162)])({'msg':c,'tenantId':c[D(0x156)],'ticket':h,'sendType':'API','status':D(0x163)}),await h['update']({'apiConfig':{...c[D(0x155)],'externalKey':c[C(0x164)]}});}catch(i){const j={'ack':-0x2,'body':c['body'],'messageId':'','number':c[C(0x167)],'externalKey':c['externalKey'],'error':C(0x14c),'type':'hookMessageStatus','authToken':c[C(0x15b)]};c?.['apiConfig']?.[C(0x165)]&&Queue_1['default'][D(0x170)](C(0x151),{'url':c['apiConfig'][C(0x165)],'type':j[D(0x157)],'payload':j});throw new Error(i);}}};