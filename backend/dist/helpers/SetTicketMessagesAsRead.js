'use strict';function a(){const t=['s.whatsapp.net','__esModule','logger','g.us','2876VWyUhk','813HmvyrN','180ieVbCi','key','./GetTicketWbotBaileys','number','132IpDzHH','../libs/cache','dataJson','40340UhLuzy','8CaaKxU','512856zVMOok','forEach','tenantId','contacts:','update','readMessages','1414476mIaCqZ','../utils/logger','chatModify','11905uiGusg','2842987RaRXyV','createdAt','isGroup','warn','findAll','cacheLayer','contactId','set','ticket:update','DESC','length','contact','default','parse','1069268EmOlwm'];a=function(){return t;};return a();}const n=b,o=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=-parseInt(k(0x202))/0x1+-parseInt(k(0x1f7))/0x2*(-parseInt(k(0x1f8))/0x3)+parseInt(l(0x1f2))/0x4+-parseInt(k(0x1e3))/0x5*(parseInt(k(0x1f9))/0x6)+parseInt(l(0x1e4))/0x7*(parseInt(k(0x201))/0x8)+-parseInt(k(0x208))/0x9+-parseInt(k(0x200))/0xa*(-parseInt(l(0x1fd))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x5a5c2));function b(c,d){const e=a();return b=function(f,g){f=f-0x1e3;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this['__importDefault']||function(c){const m=b;return c&&c[m(0x1f4)]?c:{'default':c};};Object['defineProperty'](exports,n(0x1f4),{'value':!![]});const cache_1=require(n(0x1fe)),Message_1=__importDefault(require('../models/Message')),logger_1=require(n(0x209)),GetTicketWbotBaileys_1=__importDefault(require(n(0x1fb))),socketEmit_1=__importDefault(require('./socketEmit')),SetTicketMessagesAsRead=async c=>{const p=n,q=o;try{await c[p(0x206)]({'unreadMessages':0x0}),await cache_1[q(0x1e9)][p(0x1eb)](p(0x205)+c[q(0x1ea)]+':unreads','0');if(c['channel']==='whatsapp'){const d=await(0x0,GetTicketWbotBaileys_1[p(0x1f0)])(c),e=await Message_1['default'][p(0x1e8)]({'where':{'ticketId':c['id'],'fromMe':![],'read':![]},'order':[[p(0x1e5),q(0x1ed)]]});e[q(0x203)](async f=>{const r=q,s=p,g=JSON[r(0x1f1)](f['dataJson']);g[s(0x1fa)]&&g[s(0x1fa)]['fromMe']===![]&&await d[r(0x207)]([g[s(0x1fa)]]);});if(e[q(0x1ee)]>0x0){const f=JSON[q(0x1f1)](JSON['stringify'](e[0x0][p(0x1ff)]));f[p(0x1fa)]&&f[q(0x1fa)]['fromMe']===![]&&await d[p(0x20a)]({'markRead':!![],'lastMessages':[f]},c[q(0x1ef)][q(0x1fc)]+'@'+(c[q(0x1e6)]?p(0x1f6):q(0x1f3)));}await Message_1[p(0x1f0)][q(0x206)]({'read':!![]},{'where':{'ticketId':c['id'],'read':![]}}),(0x0,socketEmit_1[p(0x1f0)])({'tenantId':c[p(0x204)],'type':q(0x1ec),'payload':c});}}catch(g){console['log'](g),logger_1[p(0x1f5)][q(0x1e7)]('Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20WhatsApp\x20session\x20disconnected?\x20Err:\x20'+g);}};exports['default']=SetTicketMessagesAsRead;