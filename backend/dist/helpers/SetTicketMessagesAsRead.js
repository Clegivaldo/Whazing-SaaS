'use strict';const m=b,n=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=parseInt(k(0xf0))/0x1+-parseInt(l(0xfb))/0x2*(-parseInt(l(0xe6))/0x3)+-parseInt(k(0x102))/0x4*(-parseInt(k(0xfe))/0x5)+parseInt(k(0xf4))/0x6+parseInt(k(0xeb))/0x7*(-parseInt(l(0xf2))/0x8)+parseInt(l(0xe7))/0x9*(parseInt(k(0xe5))/0xa)+-parseInt(l(0x101))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xa28a4));function b(c,d){const e=a();return b=function(f,g){f=f-0xe2;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[m(0xef)]||function(c){return c&&c['__esModule']?c:{'default':c};};function a(){const s=['2680368fVxxxx','1333746fUKUAU','logger','dataJson','contact','14qnrEGI','contactId','channel','fromMe','__importDefault','411150liHsIk','update','2621656FrGqCV','s.whatsapp.net','5021880LTFTBJ','log','chatModify','number','key','readMessages',':unreads','2gfsJyf','findAll','length','1486850vuxgpN','default','tenantId','15555826EqVpTJ','4FuguLz','set','contacts:','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20WhatsApp\x20session\x20disconnected?\x20Err:\x20','parse','warn','defineProperty','forEach','whatsapp','20kWuBGm'];a=function(){return s;};return a();}Object[n(0xe2)](exports,'__esModule',{'value':!![]});const cache_1=require('../libs/cache'),Message_1=__importDefault(require('../models/Message')),logger_1=require('../utils/logger'),GetTicketWbotBaileys_1=__importDefault(require('./GetTicketWbotBaileys')),socketEmit_1=__importDefault(require('./socketEmit')),SetTicketMessagesAsRead=async c=>{const o=m,p=m;try{await c[o(0xf1)]({'unreadMessages':0x0}),await cache_1['cacheLayer'][o(0x103)](o(0x104)+c[p(0xec)]+o(0xfa),'0');if(c[p(0xed)]===o(0xe4)){const d=await(0x0,GetTicketWbotBaileys_1[o(0xff)])(c),e=await Message_1[p(0xff)][p(0xfc)]({'where':{'ticketId':c['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});e[o(0xe3)](async f=>{const q=o,r=p,g=JSON['parse'](f[q(0xe9)]);g[r(0xf8)]&&g[q(0xf8)][q(0xee)]===![]&&await d[q(0xf9)]([g[r(0xf8)]]);});if(e[p(0xfd)]>0x0){const f=JSON[p(0x106)](JSON['stringify'](e[0x0][o(0xe9)]));f['key']&&f['key'][o(0xee)]===![]&&await d[p(0xf6)]({'markRead':!![],'lastMessages':[f]},c[o(0xea)][o(0xf7)]+'@'+(c['isGroup']?'g.us':p(0xf3)));}await Message_1[o(0xff)]['update']({'read':!![]},{'where':{'ticketId':c['id'],'read':![]}}),(0x0,socketEmit_1[o(0xff)])({'tenantId':c[p(0x100)],'type':'ticket:update','payload':c});}}catch(g){console[p(0xf5)](g),logger_1[o(0xe8)][p(0x107)](p(0x105)+g);}};exports[n(0xff)]=SetTicketMessagesAsRead;