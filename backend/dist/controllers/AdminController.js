'use strict';const v=b,x=b;(function(c,d){const t=b,u=b,e=c();while(!![]){try{const f=parseInt(t(0x90))/0x1+parseInt(u(0xaf))/0x2*(parseInt(u(0x84))/0x3)+-parseInt(u(0x7b))/0x4+-parseInt(t(0x8f))/0x5*(-parseInt(t(0x96))/0x6)+-parseInt(t(0xad))/0x7*(-parseInt(t(0xbf))/0x8)+parseInt(t(0x77))/0x9+-parseInt(u(0x83))/0xa*(parseInt(u(0x8b))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xa2ec5));var __importDefault=this&&this[v(0xc8)]||function(c){const w=v;return c&&c[w(0x9d)]?c:{'default':c};};Object[v(0xb1)](exports,'__esModule',{'value':!![]}),exports['addMonthTenant']=exports[x(0xb5)]=exports[x(0x9c)]=exports[x(0xa4)]=exports['adminUpdateTenant']=exports[x(0x99)]=exports['storeChannel']=exports[x(0xab)]=exports['updateSettings']=exports[v(0x82)]=exports[v(0x79)]=exports['indexTenants']=exports['updateUser']=exports[x(0x73)]=exports['indexUsers']=exports[v(0x75)]=void 0x0;const socket_1=require('../libs/socket'),AdminListChatFlowService_1=__importDefault(require(v(0x9b))),AdminListSettingsService_1=__importDefault(require(v(0x7e))),AdminListTenantsService_1=__importDefault(require(v(0xbd))),AdminListUsersService_1=__importDefault(require(x(0xac))),AdminListChannelsService_1=__importDefault(require(v(0x81))),AdminUpdateUserService_1=__importDefault(require(x(0xa2))),UpdateSettingService_1=__importDefault(require(v(0xc7))),AppError_1=__importDefault(require(v(0xb8))),CreateWhatsAppService_1=__importDefault(require(v(0xa6))),CreateUserService_1=__importDefault(require('../services/UserServices/CreateUserService')),AdminCreateTenantService_1=require(v(0x6f)),AdminStatusTenant_1=__importDefault(require('../services/AdminServices/AdminStatusTenant')),AdminUpdateTenantService_1=__importDefault(require(v(0x76))),AdminListUsersByTenantService_1=__importDefault(require(v(0x88))),CheckSettingstenant1_1=__importDefault(require(x(0x89))),CheckSettingsGeneral_1=__importDefault(require(v(0xba))),ListTotalUsersService_1=__importDefault(require(v(0x92))),AdminDeleteTenantService_1=__importDefault(require(v(0x9e))),AdminAddmonthTenantService_1=__importDefault(require(v(0xb6))),moment_1=__importDefault(require(v(0x94))),store=async(c,d)=>{const y=x,z=x,{tenantName:e,status:f,password:g,name:h,cnpj:i,maxUsers:j,maxConnections:k,planId:l,phone:m,email:n,dueDate:o,recurrence:p}=c['body'],{tenantId:q}=c[y(0xc0)],r=await(0x0,AdminCreateTenantService_1[y(0xa9)])({'name':e,'status':y(0xae),'cnpj':i,'tenantId':q,'maxUsers':j,'maxConnections':k,'planId':l,'phone':m,'email':n,'dueDate':o,'recurrence':p}),s=await(0x0,CreateUserService_1[z(0x6d)])({'email':n,'password':g,'name':h,'tenantId':r['id'],'profile':'admin','configs':{'filtrosAtendimento':{'searchParam':'','pageNumber':0x1,'status':[y(0xc4),'pending'],'showAll':!![],'count':null,'queuesIds':[],'withUnreadMessages':![],'isNotAssignedUser':![],'includeNotQueueDefined':!![]},'isDark':![]}});return d[z(0x8d)](0xc8)[y(0xc1)]({'tenant':r,'user':s});};exports[v(0x75)]=store;const indexUsers=async(c,d)=>{const A=x,B=v,{searchParam:e,pageNumber:f}=c[A(0x93)],{users:g,count:h,hasMore:i}=await(0x0,AdminListUsersService_1['default'])({'searchParam':e,'pageNumber':f});return d[B(0x8d)](0xc8)[B(0xc1)]({'users':g,'count':h,'hasMore':i});};exports[x(0x7a)]=indexUsers;const getUsersByTenant=async(c,d)=>{const C=v,D=v,{tenantId:e}=c[C(0xb2)],f=await(0x0,AdminListUsersByTenantService_1[C(0x6d)])(e);return d[D(0x8d)](0xc8)['json']({'users':f});};exports['getUsersByTenant']=getUsersByTenant;const updateUser=async(c,d)=>{const E=x,F=v,e=c[E(0xa0)],{userId:f}=c[F(0xb2)],g=await(0x0,AdminUpdateUserService_1[F(0x6d)])({'userData':e,'userId':f}),h=(0x0,socket_1[F(0xbc)])();return g&&h[F(0x6b)](g['tenantId']+E(0x87),{'action':'update','user':g}),d[E(0x8d)](0xc8)[F(0xc1)](g);};exports[v(0xa7)]=updateUser;function b(c,d){const e=a();return b=function(f,g){f=f-0x69;let h=e[f];return h;},b(c,d);}const indexTenants=async(c,d)=>{const G=x,H=x,{tenantId:e}=c[G(0xc0)],f=await(0x0,AdminListTenantsService_1['default'])(e);return d[H(0x8d)](0xc8)['json'](f);};exports[v(0x86)]=indexTenants;const indexChatFlow=async(c,d)=>{const I=x,J=x,{tenantId:e}=c[I(0xb2)],f=await(0x0,AdminListChatFlowService_1[I(0x6d)])({'tenantId':e});return d[I(0x8d)](0xc8)['json'](f);};exports[v(0x79)]=indexChatFlow;const indexSettings=async(c,d)=>{const K=v,L=x,{tenantId:e}=c[K(0xb2)],f=await(0x0,AdminListSettingsService_1[L(0x6d)])(e);return d['status'](0xc8)[K(0xc1)](f);};exports[x(0x82)]=indexSettings;const updateSettings=async(c,d)=>{const M=v,N=x,{tenantId:e}=c[M(0xb2)],{value:f,key:g}=c[N(0xa0)],h=await(0x0,UpdateSettingService_1['default'])({'key':g,'value':f,'tenantId':e}),i=(0x0,socket_1['getIO'])();return i[M(0x6b)](e+M(0xbe),{'action':M(0xaa),'setting':h}),d[N(0x8d)](0xc8)[M(0xc1)](h);};exports[v(0xc3)]=updateSettings;const indexChannels=async(c,d)=>{const O=x,P=x,{tenantId:e}=c['query'],f=await(0x0,AdminListChannelsService_1[O(0x6d)])({'tenantId':e});return d[P(0x8d)](0xc8)[P(0xc1)](f);};exports['indexChannels']=indexChannels;function a(){const a4=['moment','error','24942wsfXrc','recurrence','userCreation','updateStatusEmpresa','tMyxH','../services/AdminServices/AdminListChatFlowService','store2','__esModule','../services/AdminServices/AdminDeleteTenantService','maxUsers','body','RECAPTCHA_SECRET_KEY','../services/AdminServices/AdminUpdateUserService','data','signup','timeTest','../services/WhatsappService/CreateWhatsAppService','updateUser','value','CreateTenantService','update','indexChannels','../services/AdminServices/AdminListUsersService','28CWPUtf','active','8eXTpZe','WKDoj','defineProperty','params','empty\x20captcha','captchaToken','deleteTenant','../services/AdminServices/AdminAddmonthTenantService','🤖\x20be\x20gone','../errors/AppError','DISCONNECTED','../helpers/CheckSettingsGeneral','mensal','getIO','../services/AdminServices/AdminListTenantsService',':settings','92968wbQgGQ','user','json','&response=','updateSettings','open','enabled','pending','../services/SettingServices/UpdateSettingService','__importDefault','nJrog','format','emit','Ação\x20não\x20permitida','default','send','../services/AdminServices/AdminCreateTenantService','storeChannel','env','plano','getUsersByTenant','disabled','store','../services/AdminServices/AdminUpdateTenantService','10568781ncYDUC','success','indexChatFlow','indexUsers','1986812HqSPFf','add','pRihf','../services/AdminServices/AdminListSettingsService','🙎🏻‍♂️\x20Signup\x20disabled','maxConnections','../services/AdminServices/AdminListChannelsService','indexSettings','844210ddFefq','795078GqAFli','https://www.google.com/recaptcha/api/siteverify?secret=','indexTenants',':user','../services/AdminServices/AdminListUsersByTenantService','../helpers/CheckSettingstenant1','admin','473jMoqkX','adminUpdateTenant','status','addMonthTenant','1585cyStpU','1195473TAXGVL','Erro\x20ao\x20adicionar\x20mês\x20ao\x20tenant.','../services/UserServices/ListTotalUsersService','query'];a=function(){return a4;};return a();}const storeChannel=async(c,d)=>{const Q=x,R=x,{name:e,tenantId:f,tokenTelegram:g,instagramUser:h,instagramKey:i,type:j,wabaBSP:k,tokenAPI:l}=c[Q(0xa0)],m={'name':e,'status':Q(0xb9),'tenantId':f,'tokenTelegram':g,'instagramUser':h,'instagramKey':i,'type':j,'wabaBSP':k,'tokenAPI':l},n=await(0x0,CreateWhatsAppService_1[Q(0x6d)])(m);return d['status'](0xc8)['json'](n);};exports[v(0x70)]=storeChannel;const updateStatusEmpresa=async(c,d)=>{const S=v,T=x,{tenantId:e}=c[S(0xb2)],{status:f}=c[T(0xa0)];if(e=='1')throw new AppError_1[(S(0x6d))](S(0x6c));const g=await(0x0,AdminStatusTenant_1[S(0x6d)])({'id':e,'status':f});return d[T(0x8d)](0xc8)[T(0xc1)](g);};exports[v(0x99)]=updateStatusEmpresa;const adminUpdateTenant=async(c,d)=>{const U=x,V=x,{tenantId:e}=c['params'],{name:f,cnpj:g,maxUsers:h,maxConnections:i,planId:j,phone:k,email:l,dueDate:m,recurrence:n}=c[U(0xa0)];if(e=='1')throw new AppError_1[(U(0x6d))](U(0x6c));const o=await(0x0,AdminUpdateTenantService_1[V(0x6d)])({'id':e,'name':f,'cnpj':g,'maxUsers':h,'maxConnections':i,'planId':j,'phone':k,'email':l,'dueDate':m,'recurrence':n});return d[U(0x8d)](0xc8)[V(0xc1)](o);};exports[x(0x8c)]=adminUpdateTenant;const signup=async(c,d)=>{const W=x,X=x,e=await(0x0,CheckSettingstenant1_1[W(0x6d)])(X(0x98));if(e!==X(0x74)){const g=await(0x0,ListTotalUsersService_1['default'])();if(g>=0xa){if(W(0x7d)!=='pRihf')return d[X(0x8d)](0x191)[X(0xc1)]('🤖\x20be\x20gone');else throw new AppError_1[(W(0x6d))]('ERR_USER_LIMIT_USER_CREATION',0x190);}}if(await(0x0,CheckSettingsGeneral_1[X(0x6d)])('allowSignup')!==X(0xc5))return d[W(0x8d)](0x191)[W(0xc1)](X(0x7f));if(process['env'][W(0xa1)]){if(X(0x69)!==W(0x69))return g&&h[X(0x9d)]?i:{'default':j};else{if(!c['body'][X(0xb4)])return d[X(0x8d)](0x191)[X(0xc1)](X(0xb3));const j=await axios['post'](W(0x85)+process[W(0x71)][W(0xa1)]+W(0xc2)+c[X(0xa0)][X(0xb4)]);if(!j[X(0xa3)][X(0x78)])return d[X(0x8d)](0x191)[X(0xc1)](X(0xb7));}}const f=await(0x0,CheckSettingsGeneral_1['default'])(X(0xa5));return c[W(0xa0)]['dueDate']=(0x0,moment_1['default'])()[W(0x7c)](f,'day')[X(0x6a)](),c['body'][X(0x97)]=X(0xbb),c['body'][X(0x9f)]=c[X(0xa0)][X(0x72)][W(0x9f)],c[X(0xa0)]['planId']=c[W(0xa0)][W(0x72)][X(0xa8)],c['body'][X(0x80)]=c['body'][W(0x72)][X(0x80)],(0x0,exports[X(0x9c)])(c,d);};exports[v(0xa4)]=signup;const store2=async(c,d)=>{const Y=x,Z=x,{tenantName:e,status:f,password:g,name:h,cnpj:i,maxUsers:j,maxConnections:k,planId:l,phone:m,email:n,dueDate:o,recurrence:p}=c[Y(0xa0)],q=await(0x0,AdminCreateTenantService_1[Z(0xa9)])({'name':e,'status':Z(0xae),'cnpj':i,'maxUsers':j,'maxConnections':k,'planId':l,'phone':m,'email':n,'dueDate':o,'recurrence':p}),r=await(0x0,CreateUserService_1[Z(0x6d)])({'email':n,'password':g,'name':h,'tenantId':q['id'],'profile':Z(0x8a),'configs':{'filtrosAtendimento':{'searchParam':'','pageNumber':0x1,'status':[Z(0xc4),Y(0xc6)],'showAll':!![],'count':null,'queuesIds':[],'withUnreadMessages':![],'isNotAssignedUser':![],'includeNotQueueDefined':!![]},'isDark':![]}});return d['status'](0xc8)[Z(0xc1)]({'tenant':q,'user':r});};exports[x(0x9c)]=store2;const deleteTenant=async(c,d)=>{const a0=v,a1=x,{tenantId:e}=c[a0(0xb2)];return await(0x0,AdminDeleteTenantService_1['default'])({'tenantId':e}),d[a1(0x8d)](0xcc)[a0(0x6e)]();};exports[x(0xb5)]=deleteTenant;const addMonthTenant=async(c,d)=>{const a2=v,a3=x;try{if(a2(0xb0)!==a2(0x9a)){const {tenantId:e}=c[a2(0xb2)],f=await(0x0,AdminAddmonthTenantService_1[a3(0x6d)])({'tenantId':e});return d[a3(0x8d)](0xc8)[a3(0xc1)](f);}else throw new d['default']('ERR_USER_LIMIT_USER_CREATION',0x190);}catch(h){return console[a2(0x95)]('Erro\x20ao\x20adicionar\x20mês\x20ao\x20tenant:',h),d[a3(0x8d)](0x1f4)[a2(0xc1)]({'error':a3(0x91)});}};exports[x(0x8e)]=addMonthTenant;