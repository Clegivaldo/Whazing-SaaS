'use strict';const v=b,w=b;(function(c,d){const t=b,u=b,e=c();while(!![]){try{const f=-parseInt(t(0x1f0))/0x1*(parseInt(t(0x1c1))/0x2)+-parseInt(t(0x1c4))/0x3*(-parseInt(t(0x1e2))/0x4)+-parseInt(t(0x1ce))/0x5*(-parseInt(u(0x1c7))/0x6)+-parseInt(u(0x1e6))/0x7+-parseInt(u(0x1df))/0x8+-parseInt(t(0x1b8))/0x9+parseInt(u(0x1be))/0xa*(parseInt(t(0x1d3))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x5845d));var __importDefault=this&&this[v(0x1f1)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[v(0x1ed)](exports,w(0x201),{'value':!![]}),exports[w(0x1c9)]=exports[v(0x1fe)]=exports['adminUpdateTenant']=exports['updateStatusEmpresa']=exports[w(0x1cd)]=exports[v(0x1d7)]=exports[v(0x1fb)]=exports['indexSettings']=exports[v(0x1c5)]=exports[v(0x1db)]=exports[w(0x1cc)]=exports[w(0x1c2)]=exports[v(0x1d9)]=exports[w(0x200)]=void 0x0;const socket_1=require('../libs/socket'),AdminListChatFlowService_1=__importDefault(require(w(0x1f3))),AdminListSettingsService_1=__importDefault(require(w(0x205))),AdminListTenantsService_1=__importDefault(require(v(0x1dc))),AdminListUsersService_1=__importDefault(require(v(0x1bb))),AdminListChannelsService_1=__importDefault(require(v(0x1ec))),AdminUpdateUserService_1=__importDefault(require(v(0x1e7))),UpdateSettingService_1=__importDefault(require(v(0x1b9))),AppError_1=__importDefault(require(v(0x203))),CreateWhatsAppService_1=__importDefault(require(w(0x1e9))),CreateUserService_1=__importDefault(require(w(0x1e5))),AdminCreateTenantService_1=require(w(0x1e3)),AdminStatusTenant_1=__importDefault(require(v(0x1dd))),AdminUpdateTenantService_1=__importDefault(require('../services/AdminServices/AdminUpdateTenantService')),AdminListUsersByTenantService_1=__importDefault(require(w(0x1fd))),CheckSettingstenant1_1=__importDefault(require('../helpers/CheckSettingstenant1')),ListTotalUsersService_1=__importDefault(require(w(0x1d1))),moment_1=__importDefault(require(w(0x1da))),store=async(c,d)=>{const x=w,y=v,{tenantName:e,status:f,password:g,name:h,cnpj:i,maxUsers:j,maxConnections:k,planId:l,phone:m,email:n,dueDate:o,recurrence:p}=c[x(0x1cf)],{tenantId:q}=c[x(0x206)],r=await(0x0,AdminCreateTenantService_1[y(0x1f4)])({'name':e,'status':y(0x1ef),'cnpj':i,'tenantId':q,'maxUsers':j,'maxConnections':k,'planId':l,'phone':m,'email':n,'dueDate':o,'recurrence':p}),s=await(0x0,CreateUserService_1['default'])({'email':n,'password':g,'name':h,'tenantId':r['id'],'profile':x(0x1f6),'configs':{'filtrosAtendimento':{'searchParam':'','pageNumber':0x1,'status':[y(0x1ee),y(0x1f7)],'showAll':!![],'count':null,'queuesIds':[],'withUnreadMessages':![],'isNotAssignedUser':![],'includeNotQueueDefined':!![]},'isDark':![]}});return d[y(0x1d4)](0xc8)['json']({'tenant':r,'user':s});};function a(){const Y=['update','indexUsers','moment','indexTenants','../services/AdminServices/AdminListTenantsService','../services/AdminServices/AdminStatusTenant','disabled','1319912SWogJb','NYIkw','dueDate','4BkNTjQ','../services/AdminServices/AdminCreateTenantService','DISCONNECTED','../services/UserServices/CreateUserService','522956MMoIIa','../services/AdminServices/AdminUpdateUserService','timeTest','../services/WhatsappService/CreateWhatsAppService','query','hoAxE','../services/AdminServices/AdminListChannelsService','defineProperty','open','active','1ZIuLYv','__importDefault','env','../services/AdminServices/AdminListChatFlowService','CreateTenantService','emit','admin','pending','getIO','planId','tenantId','updateSettings','updateStatusEmpresa','../services/AdminServices/AdminListUsersByTenantService','signup','day','store','__esModule','userCreation','../errors/AppError','pbFkg','../services/AdminServices/AdminListSettingsService','user','default','🤖\x20be\x20gone','captchaToken','maxUsers','ERR_USER_LIMIT_USER_CREATION','indexSettings','4702023QytxQh','../services/SettingServices/UpdateSettingService','format','../services/AdminServices/AdminListUsersService','post','params','502060YTrhJC','enabled','value','306526VECaqQ','getUsersByTenant','add','355782CXOvhd','indexChatFlow','mensal','780XqwgMU','🙎🏻‍♂️\x20Signup\x20disabled','store2','plano','json','updateUser','storeChannel','140yZqTqU','body','data','../services/UserServices/ListTotalUsersService','Ação\x20não\x20permitida','253Cvbhng','status','maxConnections',':settings','indexChannels'];a=function(){return Y;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x1b6;let h=e[f];return h;},b(c,d);}exports['store']=store;const indexUsers=async(c,d)=>{const z=v,A=v,{searchParam:e,pageNumber:f}=c[z(0x1ea)],{users:g,count:h,hasMore:i}=await(0x0,AdminListUsersService_1[A(0x207)])({'searchParam':e,'pageNumber':f});return d[z(0x1d4)](0xc8)[A(0x1cb)]({'users':g,'count':h,'hasMore':i});};exports[w(0x1d9)]=indexUsers;const getUsersByTenant=async(c,d)=>{const B=w,C=w,{tenantId:e}=c['params'],f=await(0x0,AdminListUsersByTenantService_1[B(0x207)])(e);return d['status'](0xc8)[B(0x1cb)]({'users':f});};exports['getUsersByTenant']=getUsersByTenant;const updateUser=async(c,d)=>{const D=v,E=w,e=c[D(0x1cf)],{userId:f}=c['params'],g=await(0x0,AdminUpdateUserService_1[E(0x207)])({'userData':e,'userId':f}),h=(0x0,socket_1[D(0x1f8)])();return g&&h[E(0x1f5)](g[E(0x1fa)]+':user',{'action':E(0x1d8),'user':g}),d['status'](0xc8)[E(0x1cb)](g);};exports[w(0x1cc)]=updateUser;const indexTenants=async(c,d)=>{const F=w,G=w,{tenantId:e}=c[F(0x206)],f=await(0x0,AdminListTenantsService_1[F(0x207)])(e);return d['status'](0xc8)[F(0x1cb)](f);};exports['indexTenants']=indexTenants;const indexChatFlow=async(c,d)=>{const H=v,{tenantId:e}=c['params'],f=await(0x0,AdminListChatFlowService_1[H(0x207)])({'tenantId':e});return d['status'](0xc8)['json'](f);};exports['indexChatFlow']=indexChatFlow;const indexSettings=async(c,d)=>{const I=v,J=v,{tenantId:e}=c[I(0x1bd)],f=await(0x0,AdminListSettingsService_1[J(0x207)])(e);return d[I(0x1d4)](0xc8)['json'](f);};exports[w(0x1b7)]=indexSettings;const updateSettings=async(c,d)=>{const K=w,L=v,{tenantId:e}=c[K(0x1bd)],{value:f,key:g}=c[K(0x1cf)],h=await(0x0,UpdateSettingService_1[L(0x207)])({'key':g,'value':f,'tenantId':e}),i=(0x0,socket_1['getIO'])();return i[L(0x1f5)](e+K(0x1d6),{'action':L(0x1d8),'setting':h}),d[L(0x1d4)](0xc8)[K(0x1cb)](h);};exports[v(0x1fb)]=updateSettings;const indexChannels=async(c,d)=>{const M=v,N=w,{tenantId:e}=c[M(0x1ea)],f=await(0x0,AdminListChannelsService_1[N(0x207)])({'tenantId':e});return d['status'](0xc8)[N(0x1cb)](f);};exports['indexChannels']=indexChannels;const storeChannel=async(c,d)=>{const O=w,P=v,{name:e,tenantId:f,tokenTelegram:g,instagramUser:h,instagramKey:i,type:j,wabaBSP:k,tokenAPI:l}=c['body'],m={'name':e,'status':O(0x1e4),'tenantId':f,'tokenTelegram':g,'instagramUser':h,'instagramKey':i,'type':j,'wabaBSP':k,'tokenAPI':l},n=await(0x0,CreateWhatsAppService_1[P(0x207)])(m);return d[O(0x1d4)](0xc8)[P(0x1cb)](n);};exports[w(0x1cd)]=storeChannel;const updateStatusEmpresa=async(c,d)=>{const Q=w,R=w,{tenantId:e}=c[Q(0x1bd)],{status:f}=c['body'];if(e=='1'){if(R(0x1e0)!==Q(0x1eb))throw new AppError_1[(R(0x207))]('Ação\x20não\x20permitida');else throw new d[(R(0x207))](R(0x1d2));}const g=await(0x0,AdminStatusTenant_1[Q(0x207)])({'id':e,'status':f});return d[R(0x1d4)](0xc8)[R(0x1cb)](g);};exports[v(0x1fc)]=updateStatusEmpresa;const adminUpdateTenant=async(c,d)=>{const S=v,T=v,{tenantId:e}=c[S(0x1bd)],{name:f,cnpj:g,maxUsers:h,maxConnections:i,planId:j,phone:k,email:l,dueDate:m,recurrence:n}=c[S(0x1cf)];if(e=='1')throw new AppError_1[(T(0x207))](T(0x1d2));const o=await(0x0,AdminUpdateTenantService_1[S(0x207)])({'id':e,'name':f,'cnpj':g,'maxUsers':h,'maxConnections':i,'planId':j,'phone':k,'email':l,'dueDate':m,'recurrence':n});return d['status'](0xc8)['json'](o);};exports['adminUpdateTenant']=adminUpdateTenant;const signup=async(c,d)=>{const U=v,V=w,e=await(0x0,CheckSettingstenant1_1[U(0x207)])(V(0x202));if(e!==U(0x1de)){const g=await(0x0,ListTotalUsersService_1['default'])();if(g>=0xa)throw new AppError_1['default'](U(0x1b6),0x190);}if(await(0x0,CheckSettingstenant1_1['default'])('allowSignup')!==V(0x1bf))return d[U(0x1d4)](0x191)[U(0x1cb)](U(0x1c8));if(process[U(0x1f2)]['RECAPTCHA_SECRET_KEY']){if(!c['body'][V(0x209)])return U(0x204)!==U(0x204)?g&&h[U(0x201)]?i:{'default':j}:d[U(0x1d4)](0x191)[U(0x1cb)]('empty\x20captcha');const h=await axios[U(0x1bc)]('https://www.google.com/recaptcha/api/siteverify?secret='+process[U(0x1f2)]['RECAPTCHA_SECRET_KEY']+'&response='+c[V(0x1cf)][V(0x209)]);if(!h[U(0x1d0)]['success'])return d[V(0x1d4)](0x191)[U(0x1cb)](U(0x208));}const f=await(0x0,CheckSettingstenant1_1[U(0x207)])(V(0x1e8));return c[U(0x1cf)][V(0x1e1)]=(0x0,moment_1['default'])()[V(0x1c3)](f,V(0x1ff))[U(0x1ba)](),c[U(0x1cf)]['recurrence']=V(0x1c6),c[V(0x1cf)][V(0x20a)]=c[V(0x1cf)][V(0x1ca)][U(0x20a)],c[V(0x1cf)][U(0x1f9)]=c[V(0x1cf)]['plano'][V(0x1c0)],c['body'][V(0x1d5)]=c[U(0x1cf)][U(0x1ca)][U(0x1d5)],(0x0,exports[V(0x1c9)])(c,d);};exports[w(0x1fe)]=signup;const store2=async(c,d)=>{const W=w,X=v,{tenantName:e,status:f,password:g,name:h,cnpj:i,maxUsers:j,maxConnections:k,planId:l,phone:m,email:n,dueDate:o,recurrence:p}=c[W(0x1cf)],q=await(0x0,AdminCreateTenantService_1[W(0x1f4)])({'name':e,'status':X(0x1ef),'cnpj':i,'maxUsers':j,'maxConnections':k,'planId':l,'phone':m,'email':n,'dueDate':o,'recurrence':p}),r=await(0x0,CreateUserService_1[X(0x207)])({'email':n,'password':g,'name':h,'tenantId':q['id'],'profile':X(0x1f6),'configs':{'filtrosAtendimento':{'searchParam':'','pageNumber':0x1,'status':[W(0x1ee),'pending'],'showAll':!![],'count':null,'queuesIds':[],'withUnreadMessages':![],'isNotAssignedUser':![],'includeNotQueueDefined':!![]},'isDark':![]}});return d[X(0x1d4)](0xc8)[W(0x1cb)]({'tenant':q,'user':r});};exports[w(0x1c9)]=store2;