'use strict';const C=b,E=b;(function(c,d){const A=b,B=b,e=c();while(!![]){try{const f=-parseInt(A(0xac))/0x1+-parseInt(A(0xab))/0x2+parseInt(B(0xa6))/0x3+-parseInt(B(0x9d))/0x4+parseInt(A(0x6f))/0x5+parseInt(A(0x9b))/0x6*(parseInt(A(0xae))/0x7)+-parseInt(A(0x8a))/0x8*(-parseInt(B(0x96))/0x9);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xe9dc6));var __importDefault=this&&this[C(0x73)]||function(c){const D=C;return c&&c[D(0x80)]?c:{'default':c};};Object[C(0x7d)](exports,C(0x80),{'value':!![]}),exports[E(0x75)]=exports[C(0x82)]=exports[C(0x7b)]=exports[C(0xa1)]=void 0x0;const socket_1=require(C(0x8e)),InternalMessage_1=__importDefault(require(E(0x7f))),User_1=__importDefault(require(C(0x86))),ListCountUnreadMessage_1=__importDefault(require(E(0x97))),MessageService_1=__importDefault(require(C(0x77))),ReadMessageService_1=__importDefault(require('../services/InternalMessage/ReadMessageService')),logger_1=require(E(0x6e)),listarMensagens=async(c,d)=>{const F=E,G=C;try{if(F(0xaf)===G(0xaf)){const {id:e}=c[F(0x90)],{userId:f}=c[F(0xa3)],{isGroup:g}=c['query'],h=await MessageService_1['default'][G(0xa1)](e,f,g);return d[F(0x76)](0xc8)[F(0x79)]({'mensagens':h});}else return f['error'](g),h['status'](0x1f4)[F(0x79)]({'error':G(0x7c)});}catch(j){return console[G(0x83)](j),d['status'](0x1f4)[G(0x79)]({'error':G(0x7c)});}};exports[E(0xa1)]=listarMensagens;const criarMensagem=async(c,d)=>{const H=E,I=E;try{const {text:e,timestamp:f,receiverId:g,isGroup:h}=c['body'],{id:i,tenantId:j}=c[H(0x90)],k=c[I(0x72)],l=(0x0,socket_1[I(0x93)])(),m={'text':e,'timestamp':f,'receiverId':g,'senderId':i,'tenantId':j,'groupId':null,'mediaType':'chat','mediaUrl':undefined,'createdAt':new Date(),'updatedAt':new Date()};(h===!![]||h===I(0xa0))&&(m[I(0x91)]=undefined,m[I(0x89)]=g);let n={};if(k&&k[I(0xb0)]>0x0)await Promise[H(0x74)](k[H(0x71)](async p=>{const J=H,K=I;if(J(0x9c)!=='ZaxRT'){try{if('pLRUg'!==J(0x7e)){if(!p[K(0x98)]){if(K(0x88)===J(0x8b)){const t=f[J(0xa5)]['split']('/')[0x1][J(0x92)](';')[0x0];g[J(0x98)]=new h()[K(0xaa)]()+'.'+t;}else{const t=p[J(0xa5)][J(0x92)]('/')[0x1]['split'](';')[0x0];p[K(0x98)]=new Date()[K(0xaa)]()+'.'+t;}}}else e[J(0x94)][J(0x83)](f);}catch(v){if(K(0xa8)===J(0x81))throw new d('ERR_CREATING_MESSAGE_SYSTEM');else logger_1[J(0x94)][J(0x83)](v);}const q={...m,'text':p['originalname'],'mediaUrl':p['filename'],'mediaType':p[K(0xad)]||p[J(0xa5)][J(0x95)](0x0,p['mimetype'][K(0x9e)]('/'))},r=await MessageService_1[K(0x87)][J(0x7b)](q);n=await InternalMessage_1[J(0x87)]['findByPk'](r['id']);if(!n){if(J(0x99)!==J(0x99))return g&&h['__esModule']?i:{'default':j};else throw new Error('ERR_CREATING_MESSAGE_SYSTEM');}}else{if(!g[J(0x98)]){const z=k[K(0xa5)][J(0x92)]('/')[0x1][K(0x92)](';')[0x0];l[K(0x98)]=new m()[K(0xaa)]()+'.'+z;}}}));else{if(I(0x8c)==='UZzsa')return f[I(0x83)](g),h[H(0x76)](0x1f4)['json']({'error':H(0x8d)});else n=await MessageService_1[H(0x87)][I(0x7b)](m);}const o=await InternalMessage_1[H(0x87)]['findOne']({'where':{'id':n['id']},'include':[{'model':User_1['default'],'as':H(0x9a),'attributes':['id','name']},{'model':User_1[I(0x87)],'as':I(0x85),'attributes':['id','name']}]});return l[I(0xa4)](j+H(0xa7),{'action':I(0x84),'data':{'id':o['id'],'receiverId':o[H(0x91)],'mediaType':o[H(0xad)],'mediaName':o[H(0xa2)],'mediaUrl':o[H(0x78)],'senderId':i,'timestamp':o[I(0x9f)],'sender':o[H(0x9a)],'groupId':o['groupId'],'receiver':o[I(0x85)],'text':e}}),l['emit'](j+H(0x7a),{'action':I(0x84),'data':{'id':o['id'],'receiverId':g,'senderId':i,'mediaType':o[H(0xad)],'timestamp':o[I(0x9f)],'sender':o['sender'],'groupId':o[I(0x89)],'receiver':o[I(0x85)],'text':e}}),d[I(0x76)](0xc9)[I(0x79)]({'mensagem':o});}catch(q){return'BTgDN'!==H(0x70)?(f[I(0x83)](g),h['status'](0x1f4)[H(0x79)]({'error':I(0xa9)})):(console[I(0x83)](q),d[I(0x76)](0x1f4)['json']({'error':H(0x8d)}));}};exports[C(0x7b)]=criarMensagem;function a(){const P=['listarMensagens','mediaName','params','emit','mimetype','3249093hNGOEx',':mensagem-chat-interno','RuKfv','Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens\x20nÃ£o\x20lidas.','getTime','2576150Mgurwt','117230YLeFGJ','mediaType','5251141JZsDLt','rnCSv','length','../utils/logger','9224600vXfZFw','BTgDN','map','files','__importDefault','all','listCountUnreadMessage','status','../services/InternalMessage/MessageService','mediaUrl','json',':mensagem-chat-interno-notificacao','criarMensagem','Ocorreu\x20um\x20erro\x20ao\x20listar\x20as\x20mensagens.','defineProperty','YxRFt','../models/InternalMessage','__esModule','mxXtL','marcarMensagemNaoLida','error','update','receiver','../models/User','default','nTgqN','groupId','128AJLpPW','WvbUs','GKWsB','Ocorreu\x20um\x20erro\x20ao\x20criar\x20a\x20mensagem.','../libs/socket','Mensagems\x20marcadas\x20como\x20lida.','user','receiverId','split','getIO','logger','substr','298737BgXGAo','../services/InternalMessage/ListCountUnreadMessage','filename','RHfzA','sender','6oNhZSL','GUaTL','7384012ccwolO','indexOf','timestamp','true'];a=function(){return P;};return a();}const marcarMensagemNaoLida=async(c,d)=>{const L=E,M=E;try{const {contactId:e}=c[L(0xa3)],{id:f,tenantId:g}=c[M(0x90)],{isGroup:h}=c['body'],i=(0x0,socket_1[L(0x93)])();return await(0x0,ReadMessageService_1[M(0x87)])({'userId':f,'senderId':e,'isGroup':h}),i[M(0xa4)](g+':unread-mensagem-chat-interno',{'action':M(0x84),'data':{'receiverId':f,'isGroup':h,'senderId':Number(e)}}),d[M(0x76)](0xc8)[M(0x79)]({'message':M(0x8f)});}catch(j){return console[L(0x83)](j),d['status'](0x1f4)[M(0x79)]({'error':'Ocorreu\x20um\x20erro\x20ao\x20marcar\x20a\x20mensagens\x20como\x20lida.'});}};exports[E(0x82)]=marcarMensagemNaoLida;const listCountUnreadMessage=async(c,d)=>{const N=E,O=C;try{const {id:e}=c[N(0x90)],f=await(0x0,ListCountUnreadMessage_1[N(0x87)])(e);return d[O(0x76)](0xc8)['json']({'count':f});}catch(g){return console[N(0x83)](g),d[N(0x76)](0x1f4)['json']({'error':O(0xa9)});}};function b(c,d){const e=a();return b=function(f,g){f=f-0x6e;let h=e[f];return h;},b(c,d);}exports['listCountUnreadMessage']=listCountUnreadMessage;