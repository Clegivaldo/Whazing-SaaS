'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x171))/0x1+parseInt(H(0x127))/0x2+-parseInt(H(0x16b))/0x3+parseInt(G(0x175))/0x4+-parseInt(G(0x15a))/0x5*(-parseInt(G(0x15f))/0x6)+parseInt(G(0x176))/0x7+-parseInt(H(0x147))/0x8*(parseInt(H(0x123))/0x9);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x771e1));function b(c,d){const e=a();return b=function(f,g){f=f-0x119;let h=e[f];return h;},b(c,d);}var __createBinding=this&&this[I(0x15d)]||(Object[I(0x163)]?function(c,d,e,f){const K=J,L=J;if(f===undefined)f=e;var g=Object['getOwnPropertyDescriptor'](d,e);if(!g||(K(0x130)in g?!d['__esModule']:g[K(0x17e)]||g[K(0x155)])){if('msfwo'!==K(0x172))g={'enumerable':!![],'get':function(){const M=K,N=K;return M(0x174)!==N(0x131)?d[e]:e['status'](0xc8)[N(0x132)](f);}};else return e[f];}Object['defineProperty'](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this[I(0x13b)]||(Object['create']?function(c,d){const O=I,P=J;Object[O(0x12c)](c,P(0x148),{'enumerable':!![],'value':d});}:function(c,d){c['default']=d;}),__importStar=this&&this['__importStar']||function(c){const Q=I,R=I;if(c&&c[Q(0x11d)])return c;var d={};if(c!=null){for(var e in c)if(e!==R(0x148)&&Object['prototype'][R(0x14b)][Q(0x154)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this['__importDefault']||function(c){const S=J;return c&&c[S(0x11d)]?c:{'default':c};};Object[I(0x12c)](exports,J(0x11d),{'value':!![]}),exports[J(0x152)]=exports[I(0x143)]=exports['updateContactWallet']=exports[I(0x161)]=exports[J(0x177)]=exports[J(0x153)]=exports['show']=exports[I(0x12a)]=exports['sync']=exports[J(0x15c)]=void 0x0;const Yup=__importStar(require('yup')),lodash_1=require(I(0x14e)),xlsx_1=__importDefault(require('xlsx')),path_1=__importDefault(require('path')),uuid_1=require(J(0x139)),fs_1=__importDefault(require('fs')),ListContactsService_1=__importDefault(require(J(0x13f))),CreateContactService_1=__importDefault(require(I(0x17f))),ShowContactService_1=__importDefault(require(J(0x17b))),UpdateContactService_1=__importDefault(require(J(0x135))),DeleteContactService_1=__importDefault(require('../services/ContactServices/DeleteContactService')),UpdateContactTagsService_1=__importDefault(require('../services/ContactServices/UpdateContactTagsService')),GetProfilePicUrl_1=__importDefault(require(J(0x11c))),AppError_1=__importDefault(require(J(0x119))),UpdateContactWalletsService_1=__importDefault(require(I(0x124))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),ImportFileContactsService_1=require(J(0x13a)),Contact_1=__importDefault(require(I(0x133))),wbot_baileys_1=require(I(0x166)),CheckSettings_1=__importDefault(require(I(0x138))),ImportContactsService_1=__importDefault(require('../services/WbotServices/ImportContactsService')),index=async(c,d)=>{const T=I,U=J,{tenantId:e,id:f,profile:g}=c['user'],{searchParam:h,pageNumber:i}=c[T(0x14c)],j=await(0x0,CheckSettings_1[U(0x148)])('userContactWallet');if(g===U(0x121)||j===T(0x11a)){const {contacts:k,count:l,hasMore:m}=await(0x0,ListContactsService_1[T(0x148)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[U(0x132)]({'contacts':k,'count':l,'hasMore':m});}else{const {contacts:n,count:o,hasMore:p}=await(0x0,ListContactsService_1['default'])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[U(0x132)]({'contacts':n,'count':o,'hasMore':p});}};exports[I(0x15c)]=index;const sync=async(c,d)=>{const V=I,W=I;let {tenantId:e}=c[V(0x16f)];const {whatsappId:f}=c[V(0x173)];return await(0x0,ImportContactsService_1[V(0x148)])(Number(e),f),d[W(0x14d)](0xc8)[V(0x132)]({'message':W(0x17a)});};exports[J(0x126)]=sync;const store=async(c,d)=>{const X=J,Y=I,{tenantId:e}=c[X(0x16f)],f=c[Y(0x173)];f[X(0x12e)]=f[X(0x12e)]['replace']('-','')[Y(0x145)]('\x20','')[Y(0x145)]('+',''),console['log']('contact\x20number',f);const g=Yup[Y(0x13c)]()[Y(0x17d)]({'name':Yup[X(0x134)]()[Y(0x128)](),'number':Yup[X(0x134)]()[X(0x128)]()[Y(0x120)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await g[X(0x151)](f);}catch(o){throw new AppError_1[(X(0x148))](o[Y(0x150)]);}const h=await Whatsapp_1['default'][Y(0x15e)]({'where':{'status':Y(0x16e),'tenantId':e,'type':X(0x129)}});if(!h){if('MHwTY'==='FsOaB')e['default']['mkdirSync'](f,{'recursive':!![]});else throw new AppError_1[(Y(0x148))](X(0x178),0x194);}const i=(0x0,wbot_baileys_1['getWbot'])(h['id']),j=f[Y(0x12e)]+Y(0x12b),k=await i[X(0x164)](j);if(k[0x0][X(0x140)]==![])throw new AppError_1[(X(0x148))](Y(0x149),0x194);f[X(0x12e)]=k[0x0][Y(0x16c)][Y(0x12d)]('@')[0x0];const l=await Contact_1['default'][Y(0x15e)]({'where':{'number':f[X(0x12e)]}});if(l){if(Y(0x179)==='WRdDo')return d[X(0x14d)](0xc8)['json'](l);else e['default']=f;}const m=await(0x0,GetProfilePicUrl_1[Y(0x148)])(f[X(0x12e)],e),n=await(0x0,CreateContactService_1[X(0x148)])({...f,'number':f['number'],'profilePicUrl':m,'tenantId':e});return d[X(0x14d)](0xc8)[Y(0x132)](n);};function a(){const af=['create','onWhatsApp','public','../libs/wbot-baileys','error','updateContactWallet','tNdeW','name','78339cedOrY','jid','ASC','CONNECTED','user','book_new','203551zIZyLm','abBwk','body','ixFgG','2941984eZXCii','1284647gEQFoR','remove','NOT_FOUND_WHATSAPP_CONNECTED','WRdDo','contacts\x20imported','../services/ContactServices/ShowContactService','show','shape','writable','../services/ContactServices/CreateContactService','YLAgm','../errors/AppError','disabled','writeFile','../services/WbotServices/GetProfilePicUrl','__esModule','send','join','matches','admin','GmmPE','4077MWWGVQ','../services/ContactServices/UpdateContactWalletsService','downloads','sync','826110tCOZUm','required','whatsapp','store','@$s.whatsapp.net','defineProperty','split','number','/public/downloads/','get','uMDsL','json','../models/Contact','string','../services/ContactServices/UpdateContactService','extraInfo','xlsx','../helpers/CheckSettings','uuid','../services/WbotServices/ImportFileContactsService','__setModuleDefault','object','mkdirSync','write','../services/ContactServices/ListContactsService','exists','utils','IhFtn','upload','ImportFileContactsService','replace','ZuALs','20464YSRbJy','default','CONTACT_NOT_FOUND','rjsWi','hasOwnProperty','query','status','lodash','existsSync','message','validate','exportContacts','update','call','configurable','buffer','params','env','filter','228615BefFAj','findAll','index','__createBinding','findOne','18wUxOhu','json_to_sheet','updateContactTags','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.'];a=function(){return af;};return a();}exports[I(0x12a)]=store;const show=async(c,d)=>{const Z=I,a0=J,{contactId:e}=c['params'],{tenantId:f}=c[Z(0x16f)],g=await(0x0,ShowContactService_1['default'])({'id':e,'tenantId':f});return d[a0(0x14d)](0xc8)['json'](g);};exports[J(0x17c)]=show;const update=async(c,d)=>{const a1=I,a2=I;let e=c[a1(0x173)];const {tenantId:f}=c[a1(0x16f)],g=Yup[a2(0x13c)]()[a1(0x17d)]({'name':Yup['string'](),'number':Yup[a1(0x134)]()[a1(0x120)](/^\d+$/,a1(0x162))});try{if('COQyf'!==a1(0x14a))await g[a2(0x151)](e);else throw new d[(a2(0x148))](a2(0x178),0x194);}catch(k){throw new AppError_1[(a1(0x148))](k['message']);}const {contactId:h}=c['params'];e['extraInfo']=e[a2(0x136)][a1(0x159)](l=>l[a2(0x16a)]&&l['value']);const i=await(0x0,UpdateContactService_1[a1(0x148)])({'contactData':e,'contactId':h,'tenantId':f});return d[a2(0x14d)](0xc8)[a2(0x132)](i);};exports['update']=update;const remove=async(c,d)=>{const a3=J,a4=J,{contactId:e}=c[a3(0x157)],{tenantId:f}=c[a3(0x16f)];return await(0x0,DeleteContactService_1[a3(0x148)])({'id':e,'tenantId':f}),d[a3(0x14d)](0xc8)[a3(0x132)]({'message':'Contact\x20deleted'});};exports[I(0x177)]=remove;const updateContactTags=async(c,d)=>{const a5=I,a6=I,{tags:e}=c[a5(0x173)],{contactId:f}=c[a5(0x157)],{tenantId:g}=c[a6(0x16f)],h=await(0x0,UpdateContactTagsService_1['default'])({'tags':e,'contactId':f,'tenantId':g});return d[a5(0x14d)](0xc8)[a5(0x132)](h);};exports[J(0x161)]=updateContactTags;const updateContactWallet=async(c,d)=>{const a7=J,a8=I,{wallets:e}=c[a7(0x173)],{contactId:f}=c[a7(0x157)],{tenantId:g}=c['user'],h=await(0x0,UpdateContactWalletsService_1[a7(0x148)])({'wallets':e,'contactId':f,'tenantId':g});return d[a8(0x14d)](0xc8)[a7(0x132)](h);};exports[J(0x168)]=updateContactWallet;const upload=async(c,d)=>{const a9=J,aa=I,e=c['files'],f=(0x0,lodash_1['head'])(e),{tenantId:g}=c[a9(0x16f)];let {tags:h,wallets:i}=c[aa(0x173)];h&&(a9(0x122)===aa(0x180)?f={'enumerable':!![],'get':function(){return i[j];}}:h=h['split'](','));i&&(i=i['split']());const j=await(0x0,ImportFileContactsService_1[a9(0x144)])(+g,f,h,i);return d['status'](0xc8)[aa(0x132)](j);};exports['upload']=upload;const exportContacts=async(c,d)=>{const ab=J,ac=J,{tenantId:e}=c['user'],f=await Contact_1[ab(0x148)][ac(0x15b)]({'where':{'tenantId':e},'attributes':['id',ab(0x16a),'number','email'],'order':[['name',ac(0x16d)]],'raw':!![]}),g=xlsx_1['default'][ac(0x141)][ac(0x170)](),h=xlsx_1['default']['utils'][ac(0x160)](f);xlsx_1[ac(0x148)][ac(0x141)]['book_append_sheet'](g,h,'Contatos');const i=xlsx_1[ac(0x148)][ab(0x13e)](g,{'bookType':ac(0x137),'type':ac(0x156)}),j=(0x0,uuid_1['v4'])()+'_contatos.xlsx',k=path_1[ac(0x148)][ac(0x11f)](__dirname,'..','..',ac(0x165),ac(0x125)),l=path_1[ab(0x148)][ab(0x11f)](k,j);!fs_1[ac(0x148)][ac(0x14f)](k)&&(ac(0x169)!=='vxpSZ'?fs_1[ab(0x148)][ab(0x13d)](k,{'recursive':!![]}):f[ac(0x12c)](g,ab(0x148),{'enumerable':!![],'value':h})),fs_1[ac(0x148)][ac(0x11b)](l,i,n=>{const ad=ab,ae=ac;if(ad(0x142)!==ad(0x146)){if(n)return console[ad(0x167)]('Erro\x20ao\x20salvar\x20arquivo:',n),d[ad(0x14d)](0x1f4)[ad(0x11e)]('Erro\x20ao\x20exportar\x20contatos');const {BACKEND_URL:o}=process[ad(0x158)],p=o+':'+process[ad(0x158)]['PROXY_PORT']+ad(0x12f)+j;d[ae(0x11e)]({'downloadLink':p});}else{if(k===l)m=n;o[p]=q[r];}});};exports['exportContacts']=exportContacts;