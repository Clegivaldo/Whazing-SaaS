'use strict';const I=b,L=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x20b))/0x1*(-parseInt(H(0x1fd))/0x2)+parseInt(H(0x217))/0x3+parseInt(G(0x20a))/0x4*(-parseInt(H(0x233))/0x5)+-parseInt(H(0x242))/0x6+-parseInt(G(0x219))/0x7*(parseInt(H(0x21b))/0x8)+parseInt(G(0x20c))/0x9*(-parseInt(H(0x1e5))/0xa)+-parseInt(H(0x247))/0xb*(-parseInt(G(0x1df))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x74eae));var __createBinding=this&&this[I(0x1e9)]||(Object['create']?function(c,d,e,f){const J=I,K=I;if(f===undefined)f=e;var g=Object[J(0x21a)](d,e);if(!g||(J(0x1f8)in g?!d[J(0x237)]:g[J(0x24c)]||g[J(0x1ec)])){if('KUNZO'!==J(0x1e0))throw new e[(J(0x20e))](f['message']);else g={'enumerable':!![],'get':function(){return d[e];}};}Object[K(0x22a)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this[L(0x22c)]||(Object[L(0x212)]?function(c,d){const M=L,N=I;Object[M(0x22a)](c,N(0x20e),{'enumerable':!![],'value':d});}:function(c,d){const O=L;c[O(0x20e)]=d;}),__importStar=this&&this['__importStar']||function(c){const P=L,Q=L;if(c&&c[P(0x237)])return c;var d={};if(c!=null){for(var e in c)if(e!==P(0x20e)&&Object[P(0x1ed)]['hasOwnProperty'][P(0x1fc)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[L(0x21e)]||function(c){const R=I;return c&&c[R(0x237)]?c:{'default':c};};Object[L(0x22a)](exports,I(0x237),{'value':!![]}),exports[L(0x23a)]=exports[L(0x1f7)]=exports[L(0x207)]=exports[I(0x249)]=exports[I(0x24a)]=exports[I(0x22e)]=exports['show']=exports['store']=exports[L(0x229)]=exports[L(0x241)]=void 0x0;const Yup=__importStar(require(I(0x1e1))),lodash_1=require(L(0x211)),xlsx_1=__importDefault(require(L(0x1fe))),path_1=__importDefault(require(I(0x209))),uuid_1=require(L(0x222)),fs_1=__importDefault(require('fs')),ListContactsService_1=__importDefault(require(I(0x204))),CreateContactService_1=__importDefault(require(I(0x238))),ShowContactService_1=__importDefault(require(I(0x221))),UpdateContactService_1=__importDefault(require(L(0x21f))),DeleteContactService_1=__importDefault(require(L(0x236))),UpdateContactTagsService_1=__importDefault(require(I(0x1eb))),GetProfilePicUrl_1=__importDefault(require(L(0x23e))),AppError_1=__importDefault(require('../errors/AppError')),UpdateContactWalletsService_1=__importDefault(require(I(0x203))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),ImportFileContactsService_1=require(L(0x1f0)),Contact_1=__importDefault(require(L(0x224))),wbot_baileys_1=require(I(0x239)),CheckSettings_1=__importDefault(require('../helpers/CheckSettings')),ImportContactsService_1=__importDefault(require(L(0x1ff))),index=async(c,d)=>{const S=L,T=L,{tenantId:e,id:f,profile:g}=c[S(0x1f6)],{searchParam:h,pageNumber:i}=c[S(0x234)],j=await(0x0,CheckSettings_1['default'])(T(0x232));if(g===S(0x200)||j===T(0x225)){const {contacts:k,count:l,hasMore:m}=await(0x0,ListContactsService_1[S(0x20e)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[T(0x214)]({'contacts':k,'count':l,'hasMore':m});}else{if(T(0x201)===S(0x201)){const {contacts:n,count:o,hasMore:p}=await(0x0,ListContactsService_1[S(0x20e)])({'searchParam':h,'pageNumber':i,'tenantId':e,'profile':g,'userId':f});return d[T(0x214)]({'contacts':n,'count':o,'hasMore':p});}else e[T(0x20e)]['mkdirSync'](f,{'recursive':!![]});}};exports[I(0x241)]=index;const sync=async(c,d)=>{const U=I,V=L;let {tenantId:e}=c[U(0x1f6)];const {whatsappId:f}=c[U(0x1f5)];return await(0x0,ImportContactsService_1[U(0x20e)])(Number(e),f),d[U(0x22f)](0xc8)[V(0x214)]({'message':U(0x206)});};exports[L(0x229)]=sync;const store=async(c,d)=>{const W=I,X=I,{tenantId:e}=c[W(0x1f6)],f=c[W(0x1f5)];f['number']=f[W(0x1dc)][X(0x1e7)]('-','')['replace']('\x20','')[W(0x1e7)]('+',''),console['log']('contact\x20number',f);const g=Yup[W(0x1ef)]()[W(0x20f)]({'name':Yup[X(0x1e4)]()[W(0x248)](),'number':Yup[W(0x1e4)]()[W(0x248)]()[W(0x1e8)](/^\d+$/,X(0x205))});try{X(0x1fb)!==X(0x240)?await g[X(0x210)](f):f={'enumerable':!![],'get':function(){return i[j];}};}catch(p){throw new AppError_1[(X(0x20e))](p[X(0x208)]);}const h=await Whatsapp_1[X(0x20e)][X(0x227)]({'where':{'status':W(0x23f),'tenantId':e,'type':W(0x220)}});if(!h)throw new AppError_1[(X(0x20e))](W(0x215),0x194);const i=(0x0,wbot_baileys_1[X(0x22b)])(h['id']),j=f[X(0x1dc)]+X(0x218),k=await i['onWhatsApp'](j);if(k[0x0][X(0x230)]==![])throw new AppError_1[(X(0x20e))](W(0x235),0x194);f[W(0x1dc)]=k[0x0][X(0x228)]['split']('@')[0x0];const l=await Contact_1[X(0x20e)][W(0x227)]({'where':{'number':f[X(0x1dc)]}});if(l)return d[W(0x22f)](0xc8)[W(0x214)](l);const m=await(0x0,GetProfilePicUrl_1[W(0x20e)])(f[W(0x1dc)],e),n=await(0x0,CreateContactService_1[X(0x20e)])({...f,'number':f[X(0x1dc)],'profilePicUrl':m,'tenantId':e});return d['status'](0xc8)[X(0x214)](n);};exports['store']=store;function b(c,d){const e=a();return b=function(f,g){f=f-0x1dc;let h=e[f];return h;},b(c,d);}const show=async(c,d)=>{const Y=I,Z=I,{contactId:e}=c[Y(0x246)],{tenantId:f}=c[Z(0x1f6)],g=await(0x0,ShowContactService_1['default'])({'id':e,'tenantId':f});return d[Z(0x22f)](0xc8)[Z(0x214)](g);};exports[L(0x1f9)]=show;const update=async(c,d)=>{const a0=I,a1=I;let e=c[a0(0x1f5)];const {tenantId:f}=c[a0(0x1f6)],g=Yup['object']()['shape']({'name':Yup[a1(0x1e4)](),'number':Yup[a0(0x1e4)]()[a1(0x1e8)](/^\d+$/,a0(0x205))});try{await g[a1(0x210)](e);}catch(j){throw new AppError_1[(a1(0x20e))](j[a1(0x208)]);}const {contactId:h}=c[a1(0x246)];e['extraInfo']=e[a1(0x23b)][a1(0x1e3)](k=>k[a1(0x22d)]&&k[a1(0x21c)]);const i=await(0x0,UpdateContactService_1[a1(0x20e)])({'contactData':e,'contactId':h,'tenantId':f});return d['status'](0xc8)['json'](i);};function a(){const ae=['string','7613510pnQZvJ','email','replace','matches','__createBinding','write','../services/ContactServices/UpdateContactTagsService','configurable','prototype','OKkTS','object','../services/WbotServices/ImportFileContactsService','cJvil','mkdirSync','book_new','Contact\x20deleted','body','user','upload','get','show','head','Lfzod','call','156850kLwlrf','xlsx','../services/WbotServices/ImportContactsService','admin','RUpRL','ASC','../services/ContactServices/UpdateContactWalletsService','../services/ContactServices/ListContactsService','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','contacts\x20imported','updateContactWallet','message','path','132YEwVMJ','2CgHmoE','9rehzJC','Erro\x20ao\x20exportar\x20contatos','default','shape','validate','lodash','create','buffer','json','NOT_FOUND_WHATSAPP_CONNECTED','_contatos.xlsx','2324754PbGpIT','@$s.whatsapp.net','779170OFeHDL','getOwnPropertyDescriptor','48ieAklt','value','MNxIA','__importDefault','../services/ContactServices/UpdateContactService','whatsapp','../services/ContactServices/ShowContactService','uuid','Contatos','../models/Contact','disabled','public','findOne','jid','sync','defineProperty','getWbot','__setModuleDefault','name','update','status','exists','split','userContactWallet','66145TUkjkF','query','CONTACT_NOT_FOUND','../services/ContactServices/DeleteContactService','__esModule','../services/ContactServices/CreateContactService','../libs/wbot-baileys','exportContacts','extraInfo','utils','send','../services/WbotServices/GetProfilePicUrl','CONNECTED','RQbhR','index','744438ncwFQr','env','findAll','downloads','params','429OGJWdq','required','updateContactTags','remove','PROXY_PORT','writable','number','writeFile','ImportFileContactsService','569436pNOcYG','KUNZO','yup','existsSync','filter'];a=function(){return ae;};return a();}exports[L(0x22e)]=update;const remove=async(c,d)=>{const a2=I,a3=L,{contactId:e}=c[a2(0x246)],{tenantId:f}=c['user'];return await(0x0,DeleteContactService_1[a3(0x20e)])({'id':e,'tenantId':f}),d['status'](0xc8)[a2(0x214)]({'message':a2(0x1f4)});};exports[I(0x24a)]=remove;const updateContactTags=async(c,d)=>{const a4=I,a5=I,{tags:e}=c[a4(0x1f5)],{contactId:f}=c['params'],{tenantId:g}=c[a4(0x1f6)],h=await(0x0,UpdateContactTagsService_1[a4(0x20e)])({'tags':e,'contactId':f,'tenantId':g});return d['status'](0xc8)['json'](h);};exports['updateContactTags']=updateContactTags;const updateContactWallet=async(c,d)=>{const a6=L,a7=I,{wallets:e}=c[a6(0x1f5)],{contactId:f}=c[a7(0x246)],{tenantId:g}=c['user'],h=await(0x0,UpdateContactWalletsService_1['default'])({'wallets':e,'contactId':f,'tenantId':g});return d[a7(0x22f)](0xc8)[a7(0x214)](h);};exports[L(0x207)]=updateContactWallet;const upload=async(c,d)=>{const a8=I,a9=I,e=c['files'],f=(0x0,lodash_1[a8(0x1fa)])(e),{tenantId:g}=c['user'];let {tags:h,wallets:i}=c[a9(0x1f5)];h&&(h=h['split'](','));i&&(a8(0x1ee)!=='OKkTS'?e=f[a9(0x231)](','):i=i[a9(0x231)]());const j=await(0x0,ImportFileContactsService_1[a9(0x1de)])(+g,f,h,i);return d['status'](0xc8)[a8(0x214)](j);};exports[L(0x1f7)]=upload;const exportContacts=async(c,d)=>{const aa=L,ab=I,{tenantId:e}=c[aa(0x1f6)],f=await Contact_1[ab(0x20e)][ab(0x244)]({'where':{'tenantId':e},'attributes':['id',ab(0x22d),ab(0x1dc),ab(0x1e6)],'order':[[ab(0x22d),ab(0x202)]],'raw':!![]}),g=xlsx_1[ab(0x20e)][aa(0x23c)][aa(0x1f3)](),h=xlsx_1[ab(0x20e)][aa(0x23c)]['json_to_sheet'](f);xlsx_1[aa(0x20e)][ab(0x23c)]['book_append_sheet'](g,h,aa(0x223));const i=xlsx_1[aa(0x20e)][ab(0x1ea)](g,{'bookType':aa(0x1fe),'type':ab(0x213)}),j=(0x0,uuid_1['v4'])()+ab(0x216),k=path_1['default']['join'](__dirname,'..','..',ab(0x226),ab(0x245)),l=path_1[ab(0x20e)]['join'](k,j);!fs_1[aa(0x20e)][ab(0x1e2)](k)&&fs_1[ab(0x20e)][ab(0x1f2)](k,{'recursive':!![]}),fs_1['default'][aa(0x1dd)](l,i,m=>{const ac=ab,ad=ab;if(ac(0x21d)!=='MNxIA')e['default']=f;else{if(m){if(ac(0x1f1)!=='cJvil'){if(n&&o[ac(0x237)])return p;var r={};if(q!=null){for(var s in r)if(s!==ac(0x20e)&&s[ac(0x1ed)]['hasOwnProperty'][ac(0x1fc)](t,s))u(r,v,s);}return w(r,x),r;}else return console['error']('Erro\x20ao\x20salvar\x20arquivo:',m),d[ad(0x22f)](0x1f4)['send'](ac(0x20d));}const {BACKEND_URL:o}=process[ad(0x243)],p=o+':'+process[ad(0x243)][ad(0x24b)]+'/public/downloads/'+j;d[ad(0x23d)]({'downloadLink':p});}});};exports[I(0x23a)]=exportContacts;