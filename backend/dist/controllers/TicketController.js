'use strict';const v=b,x=b;(function(c,d){const t=b,u=b,e=c();while(!![]){try{const f=-parseInt(t(0x98))/0x1*(parseInt(u(0xd5))/0x2)+parseInt(u(0xb0))/0x3+-parseInt(t(0xa3))/0x4+parseInt(u(0xc9))/0x5+-parseInt(u(0xd4))/0x6*(parseInt(t(0xad))/0x7)+-parseInt(t(0xcf))/0x8+parseInt(u(0x9b))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x8f713));var __importDefault=this&&this[v(0xcc)]||function(c){const w=v;return c&&c[w(0xc7)]?c:{'default':c};};Object[v(0xb1)](exports,x(0xc7),{'value':!![]}),exports[x(0xce)]=exports[x(0xa0)]=exports[x(0x9f)]=exports[v(0xd0)]=exports[v(0xc0)]=exports['index']=void 0x0;const sequelize_1=require(v(0xa5)),socket_1=require(x(0xbe)),Message_1=__importDefault(require(x(0xcb))),CreateLogTicketService_1=__importDefault(require('../services/TicketServices/CreateLogTicketService')),CreateTicketService_1=__importDefault(require(x(0xb6))),DeleteTicketService_1=__importDefault(require(v(0xca))),ListTicketsService_1=__importDefault(require('../services/TicketServices/ListTicketsService')),ShowLogTicketService_1=__importDefault(require(x(0xc6))),ShowTicketService_1=__importDefault(require(v(0xd6))),UpdateTicketService_1=__importDefault(require(v(0xab))),Whatsapp_1=__importDefault(require('../models/Whatsapp')),AppError_1=__importDefault(require('../errors/AppError')),CreateMessageSystemService_1=__importDefault(require(x(0xa1))),pupa_1=require(v(0xc5)),Ticket_1=__importDefault(require(v(0xd1))),ListSettingsService_1=__importDefault(require(x(0xae))),index=async(c,d)=>{const y=x,z=v,{tenantId:e,profile:f}=c[y(0xa2)],{searchParam:g,pageNumber:h,status:i,date:j,showAll:k,withUnreadMessages:l,queuesIds:m,isNotAssignedUser:n,includeNotQueueDefined:o}=c[y(0xc4)],p=c[z(0xa2)]['id'],{tickets:q,count:r,hasMore:s}=await(0x0,ListTicketsService_1[z(0xd3)])({'searchParam':g,'pageNumber':h,'status':i,'date':j,'showAll':k,'userId':p,'withUnreadMessages':l,'queuesIds':m,'isNotAssignedUser':n,'includeNotQueueDefined':o,'tenantId':e,'profile':f});return d[z(0xa8)](0xc8)[y(0xb5)]({'tickets':q,'count':r,'hasMore':s});};function a(){const M=['8343784JvfruK','show','../models/Ticket','body','default','6BUkEhj','361892YQBPve','../services/TicketServices/ShowTicketService','access','enabled','2spaGXg','protocol','Ticket\x20j치\x20atribuido\x20para\x20outro\x20usu치rio','14328891ZipmSQ','closed','vLQEm','pending','update','remove','../services/MessageServices/CreateMessageSystemService','user','3669544ztgkqw','NotViewAssignedTickets','sequelize','scheduledMessages','not','status',':ticket','params','../services/TicketServices/UpdateTicketService','qJLuG','265748QAwQAJ','../services/SettingServices/ListSettingsService','EpbxA','2844063YYpBzJ','defineProperty','setDataValue','findOne','getIO','json','../services/TicketServices/CreateTicketService','farewellMessage','whatsappId','key','contactId','open','delete','create','../libs/socket','emit','store',':notification','userId','eDqKn','query','../utils/pupa','../services/TicketServices/ShowLogTicketService','__esModule','bot','2038170oMUQYk','../services/TicketServices/DeleteTicketService','../models/Message','__importDefault','find','showLogsTicket'];a=function(){return M;};return a();}exports['index']=index;const store=async(c,d)=>{const A=v,B=v,{tenantId:e}=c[A(0xa2)],{contactId:f,status:g,userId:h,channel:i,channelId:j}=c[B(0xd2)],k=await Ticket_1[A(0xd3)][A(0xb3)]({'where':{'contactId':f,[sequelize_1['Op']['or']]:[{'status':B(0xbb)},{'status':B(0x9e)}],'tenantId':e,'channel':i}}),l=await(0x0,ListSettingsService_1[B(0xd3)])(e),m=l?.[B(0xcd)](o=>{const C=B,D=A;return'kdIKP'===C(0xaf)?g&&h[D(0xc7)]?i:{'default':j}:o[D(0xb9)]===D(0xa4);})?.['value']===A(0x97)?'S':'N';if(k&&!!k[B(0xc2)]&&k[A(0xc2)]!=h&&m=='S'){if(A(0xc3)==='AojZs'){const p=(0x0,h[A(0xb4)])();p['to'](i+':'+j['status'])[A(0xbf)](k+A(0xa9),{'action':'create','ticket':l});}else throw new AppError_1[(B(0xd3))]('Ticket\x20j치\x20atribuido\x20para\x20outro\x20usu치rio');}if(k)return'fTVUb'!=='ItHhR'?d[B(0xa8)](0xc8)['json'](k):d[A(0xb9)]===A(0xa4);const n=await(0x0,CreateTicketService_1[A(0xd3)])({'contactId':f,'status':g,'userId':h,'tenantId':e,'channel':i,'channelId':j});if(!h){if(A(0xac)==='Uaazz')throw new d[(B(0xd3))](B(0x9a));else{const r=(0x0,socket_1[A(0xb4)])();r['to'](e+':'+n[B(0xa8)])[A(0xbf)](e+B(0xa9),{'action':B(0xbd),'ticket':n});}}return d[B(0xa8)](0xc8)['json'](n);};exports[v(0xc0)]=store;function b(c,d){const e=a();return b=function(f,g){f=f-0x96;let h=e[f];return h;},b(c,d);}const show=async(c,d)=>{const E=x,F=x,{ticketId:e}=c[E(0xaa)],{tenantId:f}=c[E(0xa2)],g=c[F(0xa2)]['id'],h=await(0x0,ShowTicketService_1[E(0xd3)])({'id':e,'tenantId':f}),i={'contactId':h[F(0xba)],'scheduleDate':{[sequelize_1['Op'][E(0xa7)]]:null},'status':'pending'},j=await Message_1[E(0xd3)]['findAll']({'where':i});return h[E(0xb2)](F(0xa6),j),await(0x0,CreateLogTicketService_1[E(0xd3)])({'userId':g,'ticketId':e,'type':F(0x96)}),d['status'](0xc8)[E(0xb5)](h);};exports['show']=show;const update=async(c,d)=>{const G=x,H=x,{ticketId:e}=c[G(0xaa)],{tenantId:f}=c['user'],g=c['user']['id'],{isTransference:h}=c[H(0xd2)],i={...c['body'],'tenantId':f},{ticket:j}=await(0x0,UpdateTicketService_1[G(0xd3)])({'ticketData':i,'ticketId':e,'isTransference':h,'userIdRequest':g});if(i[G(0xa8)]===H(0x9c)){if(H(0x9d)!=='vLQEm')return e[H(0xa8)](0xc8)['json'](f);else{const l=await Whatsapp_1[H(0xd3)][H(0xb3)]({'where':{'id':j[H(0xb8)],'tenantId':f}});if(l?.['farewellMessage']){const m=(0x0,pupa_1['pupa'])(l[H(0xb7)]||'',{'protocol':j[H(0x99)],'name':j['contact']['name']}),n={'msg':{'body':m,'fromMe':!![],'read':!![]},'tenantId':f,'ticket':j,'userId':c[G(0xa2)]['id'],'sendType':H(0xc8),'status':G(0x9e),'isTransfer':![],'note':![]};await(0x0,CreateMessageSystemService_1[G(0xd3)])(n),await j[H(0x9f)]({'isFarewellMessage':!![]});}}}return d[G(0xa8)](0xc8)[G(0xb5)](j);};exports[v(0x9f)]=update;const remove=async(c,d)=>{const I=v,J=v,{ticketId:e}=c['params'],{tenantId:f}=c['user'],g=c[I(0xa2)]['id'],h=await(0x0,DeleteTicketService_1[I(0xd3)])({'id':e,'tenantId':f,'userId':g}),i=(0x0,socket_1[J(0xb4)])();return i['to'](f+':'+h['status'])['to'](f+':'+e)['to'](f+I(0xc1))[I(0xbf)](f+J(0xa9),{'action':I(0xbc),'ticketId':+e}),d[I(0xa8)](0xc8)['json']({'message':'ticket\x20deleted'});};exports[v(0xa0)]=remove;const showLogsTicket=async(c,d)=>{const K=x,L=v,{ticketId:e}=c[K(0xaa)],f=await(0x0,ShowLogTicketService_1[L(0xd3)])({'ticketId':e});return d[K(0xa8)](0xc8)[K(0xb5)](f);};exports[v(0xce)]=showLogsTicket;