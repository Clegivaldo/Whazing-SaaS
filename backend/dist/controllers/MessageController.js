'use strict';const t=b,u=b;(function(c,d){const q=b,r=b,e=c();while(!![]){try{const f=parseInt(q(0xd4))/0x1*(parseInt(q(0xf2))/0x2)+-parseInt(r(0xc6))/0x3+-parseInt(q(0xf0))/0x4*(parseInt(q(0xda))/0x5)+parseInt(q(0xcc))/0x6*(-parseInt(r(0xd8))/0x7)+-parseInt(r(0x103))/0x8+parseInt(q(0x100))/0x9*(-parseInt(r(0xce))/0xa)+parseInt(r(0xf9))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x29096));function b(c,d){const e=a();return b=function(f,g){f=f-0xc6;let h=e[f];return h;},b(c,d);}function a(){const J=['user','error','../services/MessageServices/CreateForwardMessageService','tenantId','../helpers/DeleteMessageSystem','716AWElVa','NKSdL','604PJXIaX','ListCountMensagens','XCrsG','MwFoW','json','../errors/AppError','ticketId','10991585ooAzNb','__esModule','log','default','ERR_EDITING_WAPP_MSG','files','kzFYv','423189zybIXh','remove','messages','2400856IfxmVh','dcleS','RTxTJ','586689NGpbSt','SetTicketMessagesAsRead','../utils/logger','query','../models/Message','scheduleDate','5016mZYFap','sendType','20HsRJAq','forEach','body','isArray','Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens.','../services/WbotServices/EditWhatsAppMessage','886nhVfhZ','count','logger','ERR_DELETE_SYSTEM_MSG','2429msJOxw','params','6115STOOMu','../services/MessageServices/ListMessagesService','../services/TicketServices/ShowTicketService','try\x20CreateMessageSystemService','../services/MessageServices/CreateMessageSystemService','defineProperty','message','pending','index','send','idFront','store','ERR_DELETE_SYSTEM_MSG:\x20','status','chat','fersz','contact'];a=function(){return J;};return a();}var __importDefault=this&&this['__importDefault']||function(c){const s=b;return c&&c[s(0xfa)]?c:{'default':c};};Object[t(0xdf)](exports,t(0xfa),{'value':!![]}),exports['forward']=exports[u(0x101)]=exports['edit']=exports['store']=exports[u(0xf3)]=exports[t(0xe2)]=void 0x0;const AppError_1=__importDefault(require(t(0xf7))),DeleteMessageSystem_1=__importDefault(require(u(0xef))),SetTicketMessagesAsRead_1=__importDefault(require('../helpers/SetTicketMessagesAsRead')),Message_1=__importDefault(require(t(0xca))),CreateForwardMessageService_1=__importDefault(require(u(0xed))),CreateMessageSystemService_1=__importDefault(require(t(0xde))),ListMessagesService_1=__importDefault(require(u(0xdb))),ShowTicketService_1=__importDefault(require(t(0xdc))),logger_1=require(u(0xc8)),EditWhatsAppMessage_1=__importDefault(require(t(0xd3))),index=async(c,d)=>{const v=u,w=t,{ticketId:e}=c[v(0xd9)],{pageNumber:f}=c[w(0xc9)],{tenantId:g}=c['user'],{count:h,messages:i,messagesOffLine:j,ticket:k,hasMore:l}=await(0x0,ListMessagesService_1[w(0xfc)])({'pageNumber':f,'ticketId':e,'tenantId':g});return(0x0,SetTicketMessagesAsRead_1[w(0xfc)])(k),d[v(0xf6)]({'count':h,'messages':i,'messagesOffLine':j,'ticket':k,'hasMore':l});};exports[u(0xe2)]=index;const ListCountMensagens=async(c,d)=>{const x=u,y=u;try{if(x(0xf4)===y(0xf4)){const e=await Message_1[x(0xfc)][x(0xd5)]();return d[y(0xf6)]({'count':e});}else{f['logger'][y(0xec)](y(0xe6)+g);throw new h[(x(0xfc))](y(0xd7));}}catch(g){if(y(0x104)!=='EcFOX')return d['status'](0x1f4)['json']({'error':y(0xd2)});else e[x(0xfb)](x(0xdd),f);}};exports[t(0xf3)]=ListCountMensagens;const store=async(c,d)=>{const z=u,A=u,{ticketId:e}=c[z(0xd9)],{tenantId:f,id:g}=c[z(0xeb)],h=c[z(0xd0)],i=c[z(0xfe)],j=await(0x0,ShowTicketService_1[A(0xfc)])({'id':e,'tenantId':f});try{await(0x0,SetTicketMessagesAsRead_1[A(0xfc)])(j);}catch(k){console[A(0xfb)](A(0xc7),k);}try{if(i){if('YHXZo'!==z(0xff))i[z(0xcf)](async(l,m)=>{const B=z,C=A,n={'fromMe':h['fromMe'],'body':Array[B(0xd1)](h[C(0xd0)])?h[C(0xd0)][m]:h['body'],'idFront':Array[B(0xd1)](h[C(0xe4)])?h[B(0xe4)][m]:h['idFront'],'read':![]};await(0x0,CreateMessageSystemService_1[C(0xfc)])({'msg':n,'tenantId':f,'medias':[l],'ticket':j,'userId':g,'scheduleDate':h['scheduleDate']?new Date(Array[B(0xd1)](h[C(0xcb)])?h['scheduleDate'][m]:h[C(0xcb)]):undefined,'sendType':h[B(0xcd)]||C(0xe8),'status':B(0xe1),'idFront':Array['isArray'](h[C(0xe4)])?h[B(0xe4)][m]:h[B(0xe4)]});});else return e[z(0xe7)](0x190)[z(0xf6)]({'error':f[z(0xe0)]});}else{if('fersz'===A(0xe9))await(0x0,CreateMessageSystemService_1[z(0xfc)])({'msg':h,'tenantId':f,'medias':i,'ticket':j,'userId':g,'scheduleDate':h['scheduleDate'],'sendType':h[z(0xcd)]||z(0xe8),'status':'pending','idFront':h[z(0xe4)]});else return d[z(0xe7)](0x1f4)[z(0xf6)]({'error':z(0xd2)});}}catch(n){if('WvcUz'!==z(0x105))console[z(0xfb)](A(0xdd),n);else return g&&h[z(0xfa)]?i:{'default':j};}return d[z(0xe3)]();};exports[u(0xe5)]=store;const edit=async(c,d)=>{const D=t,E=u,{messageId:e}=c['params'],{tenantId:f}=c[D(0xeb)],g=+f,{body:h}=c[E(0xd0)];try{if(D(0xf5)!==E(0xf5)){if(i instanceof j['default']&&k[D(0xe0)]===E(0xfd))return o[D(0xe7)](0x190)[E(0xf6)]({'error':p['message']});throw n;}else{const {ticketId:j,message:k}=await(0x0,EditWhatsAppMessage_1[E(0xfc)])({'messageId':e,'tenantId':g,'body':h});}}catch(l){if(l instanceof AppError_1['default']&&l[E(0xe0)]===D(0xfd))return d['status'](0x190)[D(0xf6)]({'error':l['message']});throw l;}return d[E(0xe3)]();};exports['edit']=edit;const remove=async(c,d)=>{const F=u,G=t,{messageId:e}=c['params'],{tenantId:f}=c[F(0xeb)];try{F(0xf1)===G(0xf1)?await(0x0,DeleteMessageSystem_1[F(0xfc)])(c['body']['id'],e,f):e[G(0xfb)](G(0xc7),f);}catch(h){logger_1[F(0xd6)]['error'](G(0xe6)+h);throw new AppError_1[(G(0xfc))](F(0xd7));}return d[G(0xe3)]();};exports[t(0x101)]=remove;const forward=async(c,d)=>{const H=t,I=u,e=c[H(0xd0)],{user:f}=c;for(const g of e[H(0x102)]){await(0x0,CreateForwardMessageService_1['default'])({'userId':f['id'],'tenantId':f[H(0xee)],'message':g,'contact':e[H(0xea)],'ticketIdOrigin':g[H(0xf8)]});}return d[H(0xe3)]();};exports['forward']=forward;