'use strict';const s=b,u=b;(function(c,d){const q=b,r=b,e=c();while(!![]){try{const f=parseInt(q(0x140))/0x1+-parseInt(q(0x15c))/0x2*(parseInt(q(0x16c))/0x3)+-parseInt(q(0x169))/0x4+parseInt(q(0x155))/0x5+-parseInt(q(0x13f))/0x6*(-parseInt(q(0x15e))/0x7)+-parseInt(r(0x175))/0x8*(parseInt(r(0x17a))/0x9)+parseInt(r(0x167))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd5f76));var __importDefault=this&&this[s(0x166)]||function(c){const t=s;return c&&c[t(0x171)]?c:{'default':c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['forward']=exports[s(0x177)]=exports[u(0x16a)]=exports[s(0x153)]=exports['ListCountMensagens']=exports['index']=void 0x0;const AppError_1=__importDefault(require(u(0x15a))),DeleteMessageSystem_1=__importDefault(require(s(0x170))),SetTicketMessagesAsRead_1=__importDefault(require(u(0x143))),Message_1=__importDefault(require(u(0x14c))),CreateForwardMessageService_1=__importDefault(require('../services/MessageServices/CreateForwardMessageService')),CreateMessageSystemService_1=__importDefault(require(u(0x147))),ListMessagesService_1=__importDefault(require(u(0x179))),ShowTicketService_1=__importDefault(require(s(0x162))),logger_1=require('../utils/logger'),EditWhatsAppMessage_1=__importDefault(require(u(0x163))),index=async(c,d)=>{const v=s,w=s,{ticketId:e}=c['params'],{pageNumber:f}=c[v(0x168)],{tenantId:g}=c[w(0x148)],{count:h,messages:i,messagesOffLine:j,ticket:k,hasMore:l}=await(0x0,ListMessagesService_1[w(0x16d)])({'pageNumber':f,'ticketId':e,'tenantId':g});return(0x0,SetTicketMessagesAsRead_1[v(0x16d)])(k),d[v(0x15d)]({'count':h,'messages':i,'messagesOffLine':j,'ticket':k,'hasMore':l});};function b(c,d){const e=a();return b=function(f,g){f=f-0x13e;let h=e[f];return h;},b(c,d);}exports[u(0x16e)]=index;const ListCountMensagens=async(c,d)=>{const x=u,y=s;try{const e=await Message_1[x(0x16d)][y(0x159)]();return d['json']({'count':e});}catch(f){if(x(0x176)!==y(0x176))e[x(0x150)](x(0x172),f);else return d[y(0x154)](0x1f4)['json']({'error':x(0x157)});}};exports[u(0x152)]=ListCountMensagens;function a(){const J=['35TDiRal','logger','try\x20CreateMessageSystemService','isArray','../services/TicketServices/ShowTicketService','../services/WbotServices/EditWhatsAppMessage','files','tenantId','__importDefault','10096320pmYPCQ','query','1154836iJFAep','edit','send','12gDgskg','default','index','pending','../helpers/DeleteMessageSystem','__esModule','SetTicketMessagesAsRead','BqCmg','fromMe','52272tGoTya','tTnur','remove','params','../services/MessageServices/ListMessagesService','1593Onhfdd','contact','messages','1339230zirbkF','232078ChNZaY','scheduleDate','body','../helpers/SetTicketMessagesAsRead','error','ERR_EDITING_WAPP_MSG','idFront','../services/MessageServices/CreateMessageSystemService','user','sendType','forEach','lqvds','../models/Message','cDIgM','ERR_DELETE_SYSTEM_MSG','message','log','ERR_DELETE_SYSTEM_MSG:\x20','ListCountMensagens','store','status','4715050YWZLQK','ticketId','Ocorreu\x20um\x20erro\x20ao\x20contar\x20as\x20mensagens.','forward','count','../errors/AppError','chat','489556TSJvga','json'];a=function(){return J;};return a();}const store=async(c,d)=>{const z=s,A=s,{ticketId:e}=c[z(0x178)],{tenantId:f,id:g}=c[z(0x148)],h=c[z(0x142)],i=c[z(0x164)],j=await(0x0,ShowTicketService_1[A(0x16d)])({'id':e,'tenantId':f});try{if('TgLgy'===A(0x14b)){f[z(0x15f)]['error'](A(0x151)+g);throw new h['default']('ERR_DELETE_SYSTEM_MSG');}else await(0x0,SetTicketMessagesAsRead_1[A(0x16d)])(j);}catch(l){if('edPZg'!=='edPZg')return g&&h[A(0x171)]?i:{'default':j};else console[A(0x150)]('SetTicketMessagesAsRead',l);}try{'beeKv'!=='obAZz'?i?i[z(0x14a)](async(n,o)=>{const B=A,C=A,p={'fromMe':h[B(0x174)],'body':Array['isArray'](h[B(0x142)])?h['body'][o]:h[B(0x142)],'idFront':Array[C(0x161)](h[B(0x146)])?h[C(0x146)][o]:h['idFront'],'read':![]};await(0x0,CreateMessageSystemService_1[B(0x16d)])({'msg':p,'tenantId':f,'medias':[n],'ticket':j,'userId':g,'scheduleDate':h[B(0x141)]?new Date(Array[B(0x161)](h[B(0x141)])?h[B(0x141)][o]:h[B(0x141)]):undefined,'sendType':h[B(0x149)]||B(0x15b),'status':B(0x16f),'idFront':Array[C(0x161)](h['idFront'])?h[B(0x146)][o]:h[B(0x146)]});}):await(0x0,CreateMessageSystemService_1[A(0x16d)])({'msg':h,'tenantId':f,'medias':i,'ticket':j,'userId':g,'scheduleDate':h[A(0x141)],'sendType':h[A(0x149)]||z(0x15b),'status':'pending','idFront':h[A(0x146)]}):e['log'](A(0x160),f);}catch(o){console[z(0x150)](A(0x160),o);}return d[z(0x16b)]();};exports[u(0x153)]=store;const edit=async(c,d)=>{const D=u,E=s,{messageId:e}=c[D(0x178)],{tenantId:f}=c[E(0x148)],g=+f,{body:h}=c[D(0x142)];try{if(D(0x14d)==='cDIgM'){const {ticketId:i,message:j}=await(0x0,EditWhatsAppMessage_1[E(0x16d)])({'messageId':e,'tenantId':g,'body':h});}else return e[D(0x154)](0x190)[E(0x15d)]({'error':f['message']});}catch(l){if(E(0x173)===E(0x173)){if(l instanceof AppError_1[D(0x16d)]&&l[D(0x14f)]==='ERR_EDITING_WAPP_MSG')return d[D(0x154)](0x190)[D(0x15d)]({'error':l['message']});throw l;}else{if(i instanceof j['default']&&k['message']===D(0x145))return o[E(0x154)](0x190)[D(0x15d)]({'error':p[E(0x14f)]});throw n;}}return d[D(0x16b)]();};exports[u(0x16a)]=edit;const remove=async(c,d)=>{const F=s,G=u,{messageId:e}=c[F(0x178)],{tenantId:f}=c[F(0x148)];try{await(0x0,DeleteMessageSystem_1[G(0x16d)])(c[F(0x142)]['id'],e,f);}catch(g){logger_1['logger'][G(0x144)]('ERR_DELETE_SYSTEM_MSG:\x20'+g);throw new AppError_1[(G(0x16d))](G(0x14e));}return d[F(0x16b)]();};exports[s(0x177)]=remove;const forward=async(c,d)=>{const H=s,I=s,e=c[H(0x142)],{user:f}=c;for(const g of e[H(0x13e)]){await(0x0,CreateForwardMessageService_1[H(0x16d)])({'userId':f['id'],'tenantId':f[I(0x165)],'message':g,'contact':e[I(0x17b)],'ticketIdOrigin':g[H(0x156)]});}return d['send']();};exports[s(0x158)]=forward;