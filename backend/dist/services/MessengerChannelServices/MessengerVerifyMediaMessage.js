'use strict';function a(){const O=['message_id','attachments','public','parameters','update','4395981QlazSD','map','tenantId','14SizNDT','finish','ZxFis','2lVUWjV','../MessageServices/CreateMessageService','7839znQBLi','payload','headers','__esModule','join','5538210zIxAfB','fromMe','error','2707836zdGSyM','text','118579xgtaJO','url','filename','3416MeiiSD','received','mid','pipe','type','content-type','message','defineProperty','ERROR\x20DONWLOAD','getTime','default','24542580eSBFbf','stream','6352732wsJPyT','content-disposition','GET'];a=function(){return O;};return a();}const A=b,B=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=parseInt(x(0x135))/0x1*(parseInt(y(0x129))/0x2)+parseInt(x(0x14d))/0x3+parseInt(y(0x145))/0x4+-parseInt(x(0x130))/0x5+parseInt(y(0x133))/0x6*(parseInt(x(0x126))/0x7)+parseInt(y(0x138))/0x8*(parseInt(x(0x12b))/0x9)+-parseInt(y(0x143))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xd7fee));function b(c,d){const e=a();return b=function(f,g){f=f-0x124;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this['__importDefault']||function(c){const z=b;return c&&c[z(0x12e)]?c:{'default':c};};Object[A(0x13f)](exports,A(0x12e),{'value':!![]});const path_1=require('path'),axios_1=__importDefault(require('axios')),fs_1=require('fs'),content_disposition_1=__importDefault(require(A(0x146))),CreateMessageService_1=__importDefault(require(A(0x12a))),getQuotedForMessageId_1=__importDefault(require('../../helpers/getQuotedForMessageId')),downloadFile=async(c,d)=>{const C=A,D=A,e=await(0x0,axios_1[C(0x142)])({'url':c,'method':C(0x147),'responseType':D(0x144)}),f=e[C(0x12d)][D(0x146)]?content_disposition_1[C(0x142)]['parse'](e['headers']['content-disposition']||''):{'parameters':{}};let g='';const h=f?.[C(0x14b)]?.[D(0x137)];if(h){const j=f[C(0x14b)][D(0x137)];g=new Date()[D(0x141)]()+'-'+j;}else{if('QWqvO'===C(0x128))k['data'][C(0x13b)]((0x0,l['createWriteStream'])(m))['on']('finish',async()=>s(t))['on'](C(0x132),w=>{const E=C,F=D;s[E(0x132)](E(0x140),w),t(new u(w));});else{const l=e[D(0x12d)][C(0x13d)],m=l['split']('/')[0x1];g=d+'-'+new Date()['getTime']()+'.'+m;}}const i=(0x0,path_1[C(0x12f)])(__dirname,'..','..','..',D(0x14a),g);return await new Promise((n,o)=>{const G=C,H=D;e['data'][G(0x13b)]((0x0,fs_1['createWriteStream'])(i))['on'](G(0x127),async()=>n(g))['on']('error',p=>{const I=G,J=H;console[I(0x132)](J(0x140),p),o(new Error(p));});}),g;},MessengerVerifyMediaMessage=async(c,d,e,f)=>{const K=B,L=A;let g;await Promise['all'](d[K(0x13e)][K(0x149)][K(0x124)](async(h,i)=>{const M=L,N=K,j=e['id']+'_'+d['message_id'];g=await downloadFile(h[M(0x12c)][N(0x136)],j);let k;if(d?.[M(0x13e)]?.['reply_to']?.[M(0x13a)]){const m=await(0x0,getQuotedForMessageId_1[N(0x142)])(d[N(0x13e)]['reply_to'][M(0x13a)],e[M(0x125)]);k=m?.['id']||undefined;}const l={'messageId':i>0x0?d[N(0x148)]+'__'+i:d[M(0x148)]||'','ticketId':e['id'],'contactId':f['id'],'body':d[M(0x13e)]?.[N(0x134)]||'','fromMe':d[M(0x131)],'read':![],'mediaUrl':g,'mediaType':d[N(0x13c)],'quotedMsgId':k,'timestamp':+d['timestamp'],'status':M(0x139)};await e[N(0x14c)]({'lastMessage':d[N(0x13e)]?.[M(0x134)]||g||'','lastMessageAt':new Date()[N(0x141)](),'answered':![]}),await(0x0,CreateMessageService_1[M(0x142)])({'messageData':l,'tenantId':e[M(0x125)]});}));};exports[A(0x142)]=MessengerVerifyMediaMessage;