'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x1b2;let h=e[f];return h;},b(c,d);}function a(){const s=['2410uFVkTe','22834SBUjlz','map','../../helpers/socketEmit','lte','1410OsnUpn','1960563EoOuNx','all','sequelize','defineProperty','5348008MEgSGu','817713tbxDRj','__esModule','../../models/Contact','../../models/Message','../../models/Ticket','__importDefault','findAll','messageId','default','update','read','timestamp','chat:ack','dataValues','92348geGYKE','145qLULok','1362404cQattO','80361KszIRf'];a=function(){return s;};return a();}const m=b,n=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=parseInt(k(0x1bb))/0x1+-parseInt(k(0x1cb))/0x2+parseInt(k(0x1b6))/0x3+parseInt(l(0x1c9))/0x4*(-parseInt(k(0x1ca))/0x5)+parseInt(k(0x1b5))/0x6*(-parseInt(l(0x1ce))/0x7)+-parseInt(k(0x1ba))/0x8+parseInt(k(0x1cc))/0x9*(parseInt(k(0x1cd))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xcc6cf));var __importDefault=this&&this[m(0x1c0)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[n(0x1b9)](exports,n(0x1bc),{'value':!![]});const sequelize_1=require(m(0x1b8)),socketEmit_1=__importDefault(require(m(0x1b3))),Contact_1=__importDefault(require(m(0x1bd))),Message_1=__importDefault(require(m(0x1be))),Ticket_1=__importDefault(require(n(0x1bf))),MessengerMarkRead=async(c,d)=>{const o=m,p=n,e=await Message_1['default'][o(0x1c1)]({'where':{'tenantId':d,'createdAt':{[sequelize_1['Op'][o(0x1b4)]]:new Date(c[o(0x1c5)]['watermark'])},'fromMe':!![],'ack':{[sequelize_1['Op']['in']]:[0x1,0x2]}},'include':[{'model':Ticket_1[o(0x1c3)],'where':{'tenantId':d},'include':[{'model':Contact_1[o(0x1c3)],'where':{'tenantId':d,'messengerId':c['sender']['id']}}]}]});await Promise[p(0x1b7)](e[o(0x1b2)](async f=>{const q=p,r=o;await f[q(0x1c4)]({'ack':0x3}),(0x0,socketEmit_1['default'])({'tenantId':d,'type':q(0x1c7),'payload':{...f[r(0x1c8)],'mediaUrl':f['mediaUrl'],'id':f['id'],'timestamp':f[q(0x1c6)],'messageId':f[r(0x1c2)],'status':'sended','ack':0x3}});}));};exports['default']=MessengerMarkRead;