'use strict';const r=b,t=b;(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=parseInt(p(0x113))/0x1*(-parseInt(p(0x118))/0x2)+parseInt(p(0x135))/0x3*(-parseInt(q(0x12f))/0x4)+parseInt(q(0x126))/0x5*(parseInt(p(0x11d))/0x6)+parseInt(q(0x124))/0x7*(parseInt(q(0x114))/0x8)+-parseInt(p(0x11e))/0x9*(parseInt(q(0x130))/0xa)+-parseInt(q(0x128))/0xb*(parseInt(q(0x11b))/0xc)+parseInt(q(0x117))/0xd;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x65a10));function b(c,d){const e=a();return b=function(f,g){f=f-0x10d;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[r(0x121)]||function(c){const s=r;return c&&c[s(0x12c)]?c:{'default':c};};function a(){const y=['file','../../libs/messengerBot','14338688gVWYuq','520CGwfFM','./MessengerVerifyMessage','message','60EtJLnz','../TicketServices/FindOrCreateTicketService','6XXMjYc','801DaCcrt','video','isFarewellMessage','__importDefault','UVDtn','audio','7hwszDH','logger','2184265atvkKE','image','720489KurzJX','../ChatFlowServices/VerifyStepsChatFlowTicket','defineProperty','./MessengerShowChannel','__esModule','shift','page','416552PnJqXg','20210UjHXqO','./MessengerVerifyMediaMessage','tenantId','mid','sender','15FNGmCu','fallback','location','text','length','../WbotServices/helpers/VerifyBusinessHours','timestamp','type','default','isCampaignMessage','701OzGWrR','694056qmzQGr'];a=function(){return y;};return a();}Object[r(0x12a)](exports,t(0x12c),{'value':!![]});const logger_1=require('../../utils/logger'),FindOrCreateTicketService_1=__importDefault(require(t(0x11c))),messengerBot_1=require(t(0x116)),MessengerVerifyContact_1=__importDefault(require('./MessengerVerifyContact')),MessengerVerifyMessage_1=__importDefault(require(t(0x119))),MessengerVerifyMediaMessage_1=__importDefault(require(t(0x131))),VerifyStepsChatFlowTicket_1=__importDefault(require(r(0x129))),MessengerMarkRead_1=__importDefault(require('./MessengerMarkRead')),MessengerShowChannel_1=__importDefault(require(r(0x12b))),VerifyBusinessHours_1=__importDefault(require(r(0x10e))),getMessageType=c=>{const u=t,v=t,{attachments:d}=c,e=d&&d[u(0x10d)]>0x0;if(c[u(0x138)]&&!e)return u(0x138);if(e&&d[0x0][v(0x110)]===u(0x127))return u(0x127);if(e&&d[0x0][v(0x110)]===v(0x123))return'audio';if(e&&d[0x0][v(0x110)]===u(0x11f))return v(0x11f);if(e&&d[0x0][v(0x110)]==='location')return u(0x137);if(e&&d[0x0][v(0x110)]===u(0x115))return u(0x115);if(e&&d[0x0][v(0x110)]===u(0x136))return'fallback';},MessengerHandleMessage=async c=>{return new Promise((d,e)=>{((async()=>{const w=b,x=b;let f,g;const h=0x1;try{if(c['object']!==w(0x12e))return;const i=c['entry'][x(0x12d)](),j=i?.['messaging']['shift']();f=await(0x0,MessengerShowChannel_1[x(0x111)])({'fbPageId':i['id']});if(!f)return;const k=await(0x0,messengerBot_1['getMessengerBot'])(f['id']);if(!j?.['message']&&j['read']){(0x0,MessengerMarkRead_1['default'])(j,f[x(0x132)]);return;}g=await(0x0,MessengerVerifyContact_1[w(0x111)])(j[w(0x134)],k,f[x(0x132)]);const l={...j,'type':getMessageType(j['message']),'fromMe':![],'body':j?.['message']?.['text']||'','timestamp':j[x(0x10f)],'message_id':j[w(0x11a)][w(0x133)]},m=await(0x0,FindOrCreateTicketService_1[w(0x111)])({'contact':g,'whatsappId':f['id'],'unreadMessages':h,'tenantId':f[w(0x132)],'msg':l,'channel':'messenger'});if(m?.[w(0x112)]){d();return;}if(m?.[x(0x120)]){d();return;}l[x(0x110)]!==w(0x138)?await(0x0,MessengerVerifyMediaMessage_1[w(0x111)])(f,l,m,g):await(0x0,MessengerVerifyMessage_1['default'])(l,m,g),await(0x0,VerifyStepsChatFlowTicket_1[w(0x111)])(l,m),await(0x0,VerifyBusinessHours_1[x(0x111)])(l,m),d();}catch(n){if('DzLNy'===x(0x122))return g&&h[w(0x12c)]?i:{'default':j};else logger_1[x(0x125)]['error'](n),e(n);}})());});};exports['default']=MessengerHandleMessage;