'use strict';const u=b,w=b;function a(){const B=['default','wbzjm','../WbotServices/helpers/VerifyBusinessHours','395820BgypLw','text','./MessengerShowChannel','read','isFarewellMessage','__esModule','audio','../../libs/messengerBot','fKPJU','giZSS','logger','type','8siQkRj','naTbw','58775yoIetc','../ChatFlowServices/VerifyStepsChatFlowTicket','video','./MessengerVerifyContact','../../utils/logger','isCampaignMessage','1991626pjEwZK','fallback','263910ysmegb','page','150jyfQZw','shift','message','../TicketServices/FindOrCreateTicketService','tenantId','getMessengerBot','__importDefault','463830HEQskE','error','file','image','messenger','kVPvR','./MessengerMarkRead','1515016IUJZBn','timestamp','4787883URGRNP','sender','jqVJX','messaging','location'];a=function(){return B;};return a();}(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=parseInt(s(0xeb))/0x1+-parseInt(s(0xd5))/0x2+-parseInt(s(0xf4))/0x3+parseInt(s(0xcb))/0x4+-parseInt(s(0xe3))/0x5*(-parseInt(s(0xed))/0x6)+parseInt(t(0xe9))/0x7+-parseInt(t(0xe1))/0x8*(parseInt(s(0xcd))/0x9);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x522a6));function b(c,d){const e=a();return b=function(f,g){f=f-0xc8;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[u(0xf3)]||function(c){const v=u;return c&&c[v(0xda)]?c:{'default':c};};Object['defineProperty'](exports,w(0xda),{'value':!![]});const logger_1=require(u(0xe7)),FindOrCreateTicketService_1=__importDefault(require(u(0xf0))),messengerBot_1=require(w(0xdc)),MessengerVerifyContact_1=__importDefault(require(u(0xe6))),MessengerVerifyMessage_1=__importDefault(require('./MessengerVerifyMessage')),MessengerVerifyMediaMessage_1=__importDefault(require('./MessengerVerifyMediaMessage')),VerifyStepsChatFlowTicket_1=__importDefault(require(u(0xe4))),MessengerMarkRead_1=__importDefault(require(w(0xca))),MessengerShowChannel_1=__importDefault(require(u(0xd7))),VerifyBusinessHours_1=__importDefault(require(u(0xd4))),getMessageType=c=>{const x=w,y=u,{attachments:d}=c,e=d&&d['length']>0x0;if(c[x(0xd6)]&&!e)return'text';if(e&&d[0x0][y(0xe0)]===x(0xf7))return y(0xf7);if(e&&d[0x0][y(0xe0)]==='audio')return y(0xdb);if(e&&d[0x0]['type']===y(0xe5))return y(0xe5);if(e&&d[0x0][y(0xe0)]===y(0xd1))return y(0xd1);if(e&&d[0x0]['type']===x(0xf6))return x(0xf6);if(e&&d[0x0][y(0xe0)]==='fallback')return x(0xea);},MessengerHandleMessage=async c=>{return new Promise((d,e)=>{((async()=>{const z=b,A=b;let f,g;const h=0x1;try{if(z(0xdd)!==z(0xde)){if(c['object']!==A(0xec))return;const i=c['entry'][z(0xee)](),j=i?.[A(0xd0)][A(0xee)]();f=await(0x0,MessengerShowChannel_1[A(0xd2)])({'fbPageId':i['id']});if(!f)return;const k=await(0x0,messengerBot_1[A(0xf2)])(f['id']);if(!j?.[z(0xef)]&&j[A(0xd8)]){if(z(0xe2)!==A(0xc9)){(0x0,MessengerMarkRead_1['default'])(j,f[z(0xf1)]);return;}else{d();return;}}g=await(0x0,MessengerVerifyContact_1[A(0xd2)])(j[z(0xce)],k,f[z(0xf1)]);const l={...j,'type':getMessageType(j[A(0xef)]),'fromMe':![],'body':j?.[A(0xef)]?.[z(0xd6)]||'','timestamp':j[z(0xcc)],'message_id':j['message']['mid']},m=await(0x0,FindOrCreateTicketService_1['default'])({'contact':g,'whatsappId':f['id'],'unreadMessages':h,'tenantId':f[z(0xf1)],'msg':l,'channel':A(0xc8)});if(m?.[A(0xe8)]){if(z(0xcf)!==z(0xd3)){d();return;}else return g&&h['__esModule']?i:{'default':j};}if(m?.[z(0xd9)]){d();return;}if(l[A(0xe0)]!==A(0xd6)){if('rSPSx'!=='oBznC')await(0x0,MessengerVerifyMediaMessage_1['default'])(f,l,m,g);else{d();return;}}else await(0x0,MessengerVerifyMessage_1[z(0xd2)])(l,m,g);await(0x0,VerifyStepsChatFlowTicket_1[z(0xd2)])(l,m),await(0x0,VerifyBusinessHours_1[z(0xd2)])(l,m),d();}else{(0x0,f[z(0xd2)])(g,h[A(0xf1)]);return;}}catch(r){logger_1[A(0xdf)][z(0xf5)](r),e(r);}})());});};exports[u(0xd2)]=MessengerHandleMessage;