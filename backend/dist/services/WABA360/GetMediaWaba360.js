'use strict';const x=b,y=b;function a(){const I=['axios','../../errors/AppError','path','error','360_NOT_DOWNLOAD_MEDIA:\x20','pipe','ERROR\x20DONWLOAD','75440GAVSPI','audio','mime_type','tokenAPI','14CBKbBx','createWriteStream','5wxQaRv','8kpMQfK','1742876TfzsEW','mkial','1104GaxmXD','3QDUlVV','length','13328199vngENV','17147380quMVdz','default','image','finish','__esModule','305558mQqdur','split','logger','video','../../utils/logger','env','document','QUyNU','filename','850404ARMrDw','YYuuy','__importDefault','9529261UXTgWG','voice'];a=function(){return I;};return a();}(function(c,d){const v=b,w=b,e=c();while(!![]){try{const f=-parseInt(v(0x107))/0x1*(-parseInt(v(0x10b))/0x2)+-parseInt(w(0x112))/0x3*(parseInt(w(0x10f))/0x4)+-parseInt(w(0x10d))/0x5*(parseInt(v(0xfb))/0x6)+-parseInt(w(0xfe))/0x7+-parseInt(w(0x10e))/0x8*(-parseInt(v(0x114))/0x9)+-parseInt(v(0x115))/0xa+parseInt(v(0x11a))/0xb*(parseInt(w(0x111))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xde6cd));var __importDefault=this&&this[x(0xfd)]||function(c){return c&&c['__esModule']?c:{'default':c};};function b(c,d){const e=a();return b=function(f,g){f=f-0xf5;let h=e[f];return h;},b(c,d);}Object['defineProperty'](exports,y(0x119),{'value':!![]});const axios_1=__importDefault(require(y(0x100))),fs_1=require('fs'),path_1=require(x(0x102)),AppError_1=__importDefault(require(x(0x101))),logger_1=require(x(0xf6)),downloadFile=async(c,d,e)=>{const z=x,A=x,f=process[z(0xf7)]['API_URL_360']+'/v1/media/'+d,g=(0x0,path_1['join'])(__dirname,'..','..','public',e),h=await(0x0,axios_1[A(0x116)])({'url':f,'method':'GET','responseType':'stream','headers':{'D360-API-KEY':c}});await new Promise((i,j)=>{const B=A,C=z;if('YYuuy'!==B(0xfc))return g&&h['__esModule']?i:{'default':j};else h['data'][C(0x105)]((0x0,fs_1[C(0x10c)])(g))['on'](C(0x118),async()=>i(!![]))['on'](B(0x103),l=>{const D=B,E=C;console[D(0x103)](E(0x106),l),j(new Error(l));});});},GetMediaWaba360=async({channel:c,msg:d,ticket:e})=>{const F=x,G=x;try{let f='',g,h;d?.[F(0xf8)]&&(F(0xf9)!==F(0x110)?(f=d[G(0xf8)]['id']||'',g=d[F(0xf8)][G(0xfa)],h=d[F(0xf8)][G(0x109)]):j['data'][F(0x105)]((0x0,k[G(0x10c)])(l))['on']('finish',async()=>q(!![]))['on']('error',u=>{const H=G;q[H(0x103)]('ERROR\x20DONWLOAD',u),r(new s(u));}));d?.[F(0x117)]&&(f=d[F(0x117)]['id']||'',h=d[G(0x117)][G(0x109)]);d?.[G(0xf5)]&&(f=d['video']['id']||'',h=d[F(0xf5)][F(0x109)]);if(d?.['voice']){f=d[G(0xff)]['id']||'';const m=d['voice'][F(0x109)]||'',n=m['split'](';');h=n[F(0x113)]>0x1?n[0x0]:d[F(0xff)][G(0x109)];}d?.[F(0x108)]&&(f=d[F(0x108)]['id']||'',h=d[F(0x108)][G(0x109)]);const i=h?.[F(0x11b)]('/')[0x1]['split'](';')[0x0],j=new Date()['getTime'](),k=g?g+'_'+e['id']+'_'+f+'_'+j+'.'+i:e['id']+'_'+f+'_'+j+'.'+i;return await downloadFile(c[G(0x10a)],f,k),k;}catch(o){logger_1[G(0x11c)][F(0x103)](o);throw new AppError_1[(G(0x116))](G(0x104)+o);}};exports[y(0x116)]=GetMediaWaba360;