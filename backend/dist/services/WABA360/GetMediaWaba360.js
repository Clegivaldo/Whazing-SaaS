'use strict';const w=b,y=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x18b;let h=e[f];return h;},b(c,d);}(function(c,d){const u=b,v=b,e=c();while(!![]){try{const f=-parseInt(u(0x196))/0x1+-parseInt(v(0x194))/0x2+-parseInt(u(0x18d))/0x3*(-parseInt(u(0x18b))/0x4)+-parseInt(u(0x19d))/0x5*(parseInt(u(0x1ae))/0x6)+-parseInt(u(0x1a6))/0x7*(-parseInt(v(0x193))/0x8)+-parseInt(v(0x18c))/0x9+parseInt(u(0x1a4))/0xa*(parseInt(u(0x190))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x794a4));function a(){const H=['audio','__esModule','tokenAPI','defineProperty','12VtmPJi','axios','2746136ntCAMy','3893418QxdUlo','3fgWuJV','API_URL_360','ERROR\x20DONWLOAD','11049511RbtZoI','default','image','4457944vkHzUR','1140838VPUHht','mime_type','413229XXNNnJ','join','filename','360_NOT_DOWNLOAD_MEDIA:\x20','document','pipe','tzkDU','838060GQHeHo','stream','video','logger','error','../../errors/AppError','voice','10XsfZwP','split','7lvKyFe','finish','__importDefault','length'];a=function(){return H;};return a();}var __importDefault=this&&this[w(0x1a8)]||function(c){const x=w;return c&&c[x(0x1ab)]?c:{'default':c};};Object[w(0x1ad)](exports,y(0x1ab),{'value':!![]});const axios_1=__importDefault(require(w(0x1af))),fs_1=require('fs'),path_1=require('path'),AppError_1=__importDefault(require(w(0x1a2))),logger_1=require('../../utils/logger'),downloadFile=async(c,d,e)=>{const z=w,A=y,f=process['env'][z(0x18e)]+'/v1/media/'+d,g=(0x0,path_1[z(0x197)])(__dirname,'..','..','public',e),h=await(0x0,axios_1[z(0x191)])({'url':f,'method':'GET','responseType':A(0x19e),'headers':{'D360-API-KEY':c}});await new Promise((i,j)=>{const B=A,C=z;h['data'][B(0x19b)]((0x0,fs_1['createWriteStream'])(g))['on'](B(0x1a7),async()=>i(!![]))['on']('error',k=>{const D=B,E=B;console[D(0x1a1)](E(0x18f),k),j(new Error(k));});});},GetMediaWaba360=async({channel:c,msg:d,ticket:e})=>{const F=w,G=y;try{let f='',g,h;d?.[F(0x19a)]&&(f=d[G(0x19a)]['id']||'',g=d[F(0x19a)][F(0x198)],h=d[F(0x19a)]['mime_type']);d?.['image']&&(f=d[G(0x192)]['id']||'',h=d[F(0x192)][F(0x195)]);d?.[F(0x19f)]&&(f=d[G(0x19f)]['id']||'',h=d[G(0x19f)][G(0x195)]);if(d?.['voice']){f=d[F(0x1a3)]['id']||'';const l=d[G(0x1a3)]['mime_type']||'',m=l[G(0x1a5)](';');h=m[G(0x1a9)]>0x1?m[0x0]:d['voice'][G(0x195)];}d?.[F(0x1aa)]&&(G(0x19c)!==G(0x19c)?(h[F(0x1a1)]('ERROR\x20DONWLOAD',i),j(new k(l))):(f=d[G(0x1aa)]['id']||'',h=d[G(0x1aa)]['mime_type']));const i=h?.['split']('/')[0x1][F(0x1a5)](';')[0x0],j=new Date()['getTime'](),k=g?g+'_'+e['id']+'_'+f+'_'+j+'.'+i:e['id']+'_'+f+'_'+j+'.'+i;return await downloadFile(c[G(0x1ac)],f,k),k;}catch(o){logger_1[F(0x1a0)][F(0x1a1)](o);throw new AppError_1[(F(0x191))](G(0x199)+o);}};exports[w(0x191)]=GetMediaWaba360;