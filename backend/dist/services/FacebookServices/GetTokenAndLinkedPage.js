'use strict';const o=b,p=b;(function(c,d){const m=b,n=b,e=c();while(!![]){try{const f=parseInt(m(0xc2))/0x1*(parseInt(n(0xae))/0x2)+-parseInt(m(0xbf))/0x3+parseInt(m(0xbe))/0x4*(parseInt(n(0xb6))/0x5)+-parseInt(n(0xb0))/0x6+parseInt(m(0xc0))/0x7*(-parseInt(n(0xca))/0x8)+-parseInt(m(0xc1))/0x9*(parseInt(m(0xb7))/0xa)+-parseInt(n(0xb3))/0xb*(-parseInt(n(0xbd))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xb85e3));function b(c,d){const e=a();return b=function(f,g){f=f-0xa9;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[o(0xb4)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[o(0xcb)](exports,p(0xab),{'value':!![]});const axios_1=__importDefault(require(p(0xb1))),AppError_1=__importDefault(require(p(0xb9))),Whatsapp_1=__importDefault(require(p(0xbc))),SetLogoutLinkedPage_1=__importDefault(require(p(0xbb))),socket_1=require('../../libs/socket'),logger_1=require(p(0xb8)),api_version=o(0xc4),baseUrl='https://graph.facebook.com/'+api_version,app_id=process[o(0xb5)][p(0xcc)],app_secret=process[p(0xb5)]['FACEBOOK_APP_SECRET_KEY'],getLongLivedAccessToken=async c=>{const q=o,r=o,{data:d}=await axios_1[q(0xc6)][q(0xc8)](baseUrl+r(0xc5)+app_id+'&client_secret='+app_secret+r(0xaf)+c);return d[q(0xba)];},getPermanentPageAccessToken=async(c,d)=>{const s=o,t=o,{data:{data:e}}=await axios_1[s(0xc6)][t(0xc8)](baseUrl+'/'+d+s(0xc9)+c);return e['length']&&e[0x0];},getPageInfo=async(c,d)=>{const u=o,v=p,e=baseUrl+'/'+c+u(0xc3)+d,{data:{data:f}}=await(0x0,axios_1[v(0xc6)])({'method':u(0xcd),'url':e});return f;},GetTokenAndLinkedPage=async({whatsapp:c,accountId:d,userToken:e,tenantId:f})=>{const w=o,x=p;try{const g=(0x0,socket_1[w(0xad)])(),h=await getPageInfo(d,e);if(h['length']>0x1)throw new AppError_1[(w(0xc6))](x(0xac),0x190);if(h[x(0xa9)]===0x0){await(0x0,SetLogoutLinkedPage_1['default'])({'whatsapp':c,'tenantId':f});return;}const i=await getLongLivedAccessToken(e),j=await getPermanentPageAccessToken(i,d),k={'status':w(0xc7),'fbPageId':j['id'],'fbObject':{...j,'accountId':d,'long_lived_access_token':i},'tokenAPI':j[w(0xba)]};Whatsapp_1[w(0xc6)][w(0xb2)](k,{'where':{'id':c['id'],'tenantId':f}}),g[w(0xaa)](f+':whatsappSession',{'action':x(0xb2),'session':{...c,...k}});}catch(l){logger_1[w(0xce)]['error'](l);throw new AppError_1[(w(0xc6))](l,0x190);}};function a(){const y=['Escolha\x20apenas\x201\x20página.\x20Refaça\x20o\x20processo\x20e\x20selecione\x20apenas\x201\x20página.','getIO','2XNxPOt','&fb_exchange_token=','1641180CiNzcQ','axios','update','11eLbkXy','__importDefault','env','2355bzGDGy','10vIFlVb','../../utils/logger','../../errors/AppError','access_token','./SetLogoutLinkedPage','../../models/Whatsapp','31609308dRUREC','136HnWmnf','1652703qwWxKo','820925UdTbyd','1881585JhlKDw','545844cpgVvp','/accounts?limit=25&access_token=','v16.0','/oauth/access_token?grant_type=fb_exchange_token&client_id=','default','CONNECTED','get','/accounts?access_token=','96BtrZIO','defineProperty','FACEBOOK_APP_ID','GET','logger','length','emit','__esModule'];a=function(){return y;};return a();}exports[o(0xc6)]=GetTokenAndLinkedPage;