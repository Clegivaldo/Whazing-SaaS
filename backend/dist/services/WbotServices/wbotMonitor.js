'use strict';const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0xf0))/0x1*(-parseInt(G(0xe5))/0x2)+-parseInt(H(0xf4))/0x3*(parseInt(G(0xf3))/0x4)+parseInt(H(0xf9))/0x5+-parseInt(G(0x10e))/0x6+parseInt(G(0x10d))/0x7*(-parseInt(H(0x103))/0x8)+parseInt(G(0x10b))/0x9+parseInt(G(0x100))/0xa*(parseInt(G(0xf2))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xcc995));function a(){const X=['CB:call','__esModule','hasOwnProperty','5020614ZKysCL','@sentry/node','885808bGoYWu','5906166Qdfmto','enabled','attrs','../BaileysServices/CreateOrUpdateBaileysService','uqrFL','YaYcc','callRejectMessage','../TicketServices/FindOrCreateTicketService','writable','value','key','error','defineProperty','__importDefault','logger','2WurvqD','captureException','VFQvF','contacts.upsert','content','getMinutes','tag','default','replace','findOne','from','1373539bdEhTs','sendMessage','44TJLqbF','4UdtxOm','2918796mPmuLo','bPDQR','__importStar','../../models/Message','create','5024875QAxndy','../../models/Setting','rejectCalls','call','As\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.','prototype','getOwnPropertyDescriptor','9046000rKHstu','rejectCall','update','64UEPJLL','../../utils/logger','terminate','__createBinding','getHours'];a=function(){return X;};return a();}var __createBinding=this&&this[I(0x106)]||(Object[J(0xf8)]?function(c,d,e,f){const K=J,L=J;if(f===undefined)f=e;var g=Object[K(0xff)](d,e);(!g||('get'in g?!d[K(0x109)]:g[K(0x116)]||g['configurable']))&&(K(0xf5)===L(0x112)?e[L(0xec)]=f:g={'enumerable':!![],'get':function(){const M=K,N=K;if(M(0xe7)===M(0xe7))return d[e];else{if(n&&c[N(0x109)])return p;var j={};if(q!=null){for(var l in r)if(l!==N(0xec)&&s[N(0xfe)][M(0x10a)][M(0xfc)](t,l))u(j,v,l);}return w(j,x),j;}}}),Object['defineProperty'](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[J(0xf8)]?function(c,d){const O=J,P=J;Object[O(0xe2)](c,P(0xec),{'enumerable':!![],'value':d});}:function(c,d){c['default']=d;}),__importStar=this&&this[I(0xf6)]||function(c){const Q=I,R=J;if(c&&c[Q(0x109)])return c;var d={};if(c!=null){for(var e in c)if(e!=='default'&&Object[Q(0xfe)][R(0x10a)][Q(0xfc)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[J(0xe3)]||function(c){const S=J;return c&&c[S(0x109)]?c:{'default':c};};Object[I(0xe2)](exports,'__esModule',{'value':!![]});const Sentry=__importStar(require(I(0x10c))),Contact_1=__importDefault(require('../../models/Contact')),Setting_1=__importDefault(require(I(0xfa))),logger_1=require(J(0x104)),CreateOrUpdateBaileysService_1=__importDefault(require(J(0x111))),FindOrCreateTicketService_1=__importDefault(require(I(0x115))),Message_1=__importDefault(require(I(0xf7))),wbotMonitor=async(c,d,e)=>{const T=J,W=I;try{'godpp'==='godpp'?(c['ws']['on'](T(0x108),async f=>{const U=T,V=T,g=f[U(0xe9)][0x0];if(g[V(0xeb)]==='offer'){if(U(0x113)!==U(0x113)){if(k===l)m=n;o[p]=q[r];}else{const i=await Setting_1[U(0xec)][V(0xee)]({'where':{'key':'rejectCalls','tenantId':e}});i['value']===U(0x10f)&&c[U(0x101)](g[V(0x110)]['call-id'],g[V(0x110)]['call-creator']);}}if(g['tag']===U(0x105)){const j=await Setting_1['default'][V(0xee)]({'where':{'key':V(0xfb),'tenantId':e}});if(j['value']===V(0x10f)){const k=U(0xfd),l=await Setting_1['default'][V(0xee)]({'where':{'key':U(0x114),'tenantId':e}}),m=await c[V(0xf1)](f['attrs'][U(0xef)],{'text':l[U(0x117)]||k}),n=f[V(0x110)][U(0xef)][U(0xed)](/\D/g,''),o=await Contact_1[U(0xec)][U(0xee)]({'where':{'tenantId':e,'number':n}}),p=await(0x0,FindOrCreateTicketService_1[V(0xec)])({'contact':o,'whatsappId':c['id'],'unreadMessages':0x1,'tenantId':e,'channel':'whatsapp'}),q=new Date(),r=q[U(0x107)](),s=q[U(0xea)](),t='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+r+':'+s,u={'messageId':m[V(0xe0)]['id'],'ticketId':p['id'],'contactId':o['id'],'body':t,'dataJson':m+'','fromMe':![],'mediaType':'call','read':!![],'quotedMsgId':null,'ack':0x1};await p[V(0x102)]({'lastMessage':t}),await Message_1[U(0xec)][U(0xf8)]({...u,'tenantId':e});}}}),c['ev']['on'](W(0xe8),async f=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':d['id'],'contacts':f});})):(g[T(0xe6)](h),i[T(0xe4)][T(0xe1)](j));}catch(g){Sentry[T(0xe6)](g),logger_1[T(0xe4)][T(0xe1)](g);}};function b(c,d){const e=a();return b=function(f,g){f=f-0xe0;let h=e[f];return h;},b(c,d);}exports['default']=wbotMonitor;