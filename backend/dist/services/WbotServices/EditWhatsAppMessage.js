'use strict';function a(){const z=['ticket','edited','369600NWZzLe','zlNMN','1567647PApdHU','key','1228320MqMsHP','aLXeu','default','dataJson','../../helpers/socketEmit','__importDefault','231903iEXXfz','249vJiQkj','675095tOKTyt','10zNBXGD','../../models/Message','../../models/Ticket','../../helpers/GetTicketWbotBaileys','contact','chat:update','134757cuPbjk','sendMessage','getTime','No\x20message\x20found\x20with\x20this\x20ID.','createdAt','6ogbvlk','ERR_EDITING_WAPP_MSG','622zcdmvC','quotedMsg','../../errors/AppError','__esModule','XMaJq'];a=function(){return z;};return a();}const u=b,w=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x1bd;let h=e[f];return h;},b(c,d);}(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=parseInt(s(0x1d9))/0x1+parseInt(s(0x1c8))/0x2*(parseInt(t(0x1da))/0x3)+parseInt(s(0x1cf))/0x4+parseInt(s(0x1db))/0x5*(-parseInt(t(0x1c6))/0x6)+parseInt(s(0x1c1))/0x7+-parseInt(t(0x1d3))/0x8+-parseInt(s(0x1d1))/0x9*(-parseInt(s(0x1dc))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x3e40f));var __importDefault=this&&this[u(0x1d8)]||function(c){const v=u;return c&&c[v(0x1cb)]?c:{'default':c};};Object['defineProperty'](exports,u(0x1cb),{'value':!![]});const AppError_1=__importDefault(require(u(0x1ca))),GetTicketWbotBaileys_1=__importDefault(require(u(0x1be))),Message_1=__importDefault(require(w(0x1dd))),Ticket_1=__importDefault(require(u(0x1bd))),socketEmit_1=__importDefault(require(w(0x1d7))),EditWhatsAppMessage=async({messageId:c,tenantId:d,body:e})=>{const x=w,y=u;let f;try{f=await Message_1[x(0x1d5)]['findOne']({'where':{'messageId':c,'tenantId':d},'include':[{'model':Ticket_1[y(0x1d5)],'as':y(0x1cd),'include':[y(0x1bf)]}]});if(!f){if('TKgKD'!=='bDaow')throw new AppError_1[(y(0x1d5))](x(0x1c4));else throw new d[(x(0x1d5))]('ERR_EDITING_WAPP_MSG');}}catch(l){throw new AppError_1[(x(0x1d5))]('ERR_FINDING_MSG');}const {ticket:g}=f,h=await(0x0,GetTicketWbotBaileys_1[y(0x1d5)])(g),i=JSON['parse'](f[y(0x1d6)]),j=i[x(0x1d2)]['remoteJid'];try{await h[y(0x1c2)](j,{'text':e,'edit':i[y(0x1d2)]},{});const m=(new Date()[x(0x1c3)]()-new Date(f[x(0x1c5)])[x(0x1c3)]())/0xea60;if(m>0xa){if(x(0x1d4)!==x(0x1d4))throw new d[(y(0x1d5))](y(0x1c7));else throw new AppError_1[(x(0x1d5))]('ERR_EDITING_WAPP_MSG');}if(f[y(0x1ce)]!==null)throw new AppError_1['default'](y(0x1c7));await f['update']({'edited':e});const {ticket:n}=f;(0x0,socketEmit_1[x(0x1d5)])({'tenantId':n['tenantId'],'type':y(0x1c0),'payload':f});const o=await Message_1['default']['findOne']({'where':{'messageId':c,'tenantId':d},'include':[{'model':Ticket_1['default'],'as':'ticket','include':['contact']},{'model':Message_1['default'],'as':y(0x1c9),'include':[y(0x1bf)],'where':{'tenantId':d},'required':![]}]});return{'ticketId':o['ticketId'],'message':o};}catch(q){if(y(0x1cc)!==x(0x1d0))throw new AppError_1[(y(0x1d5))](y(0x1c7));else return g&&h[x(0x1cb)]?i:{'default':j};}};exports[w(0x1d5)]=EditWhatsAppMessage;