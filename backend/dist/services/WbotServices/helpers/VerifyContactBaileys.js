'use strict';const aB=b,aD=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x89;let h=e[f];return h;},b(c,d);}(function(c,d){const az=b,aA=b,e=c();while(!![]){try{const f=parseInt(az(0x97))/0x1+-parseInt(aA(0xcd))/0x2+parseInt(aA(0xe2))/0x3+-parseInt(az(0xa9))/0x4+parseInt(az(0x8e))/0x5*(parseInt(aA(0x115))/0x6)+parseInt(az(0x95))/0x7*(-parseInt(az(0x116))/0x8)+parseInt(aA(0xf9))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x7ce89));function a(){const aW=['find','jIiPm','NFD','document','replace','data','trim','11434401nfFCYw','jpegThumbnail','extractMessageContent','imageMessage','dckmg','filename','fromMe','pushName','contextInfo','log','VTvfI','YCnpH','getTime','protocolMessage','application','viewOnceMessage','PWHPb','VerifyContactBaileys','Chegou\x20Aqui','sections','gdyFq','message','videoMessage','WZKhw','util','buttonsMessage','ncbaB','RCQiG','6EbxGwN','16QFKKIh','verifyQuotedMessage','title','text','concat','__importDefault','pop','Não\x20encontrou\x20o\x20tipo\x20em\x20getBodyMessage:\x20','ephemeralMessage','normalize','4112835FbyIIx','contentText','getContentType','rows','VerifyMediaMessageBaileys','fourRowTemplate','video','3390842LgjamO','Tentativa\x20','235419GzKQqz','\x20|\x20https://maps.google.com/maps?q=','liveLocationMessage','\x20-\x20','join','templateMessage','listMessage','getBodyMessage','MQQqm','oHKsP','listResponseMessage','keys','key','error','downloadContentFromMessage','__esModule','templateButtonReplyMessage','toString','766048vJHdTE','\x20de\x20baixar\x20o\x20arquivo','mimetype','data:image/png;base64,\x20','buttons','>>>>\x20erro\x20','subject','hydratedFourRowTemplate','stickerMessage','reactionMessage','default','conversation','MUoJj','PlpId','documentMessage','defineProperty','buttonText','Get\x20Type\x20Message\x20->\x20','KzUiy','displayText','&z=17&hl=pt-BR|','values','../../MessageServices/CreateMessageService','../../../utils/logger','warn','editedMessage','audioMessage','qzoJS','../../../models/Message','public','description','KVxAE','image','sHivB','getQuotedMessageId','contactMessage','2028008kVtGHp','stringify','sticker','documentWithCaptionMessage','VerifyMessageBaileys','value','iWMRi','split','base64','MktmO','degreesLatitude','logger','fileName','bNzpz','Áudio','selectedId','EzMvI','extendedTextMessage','from','path','ERR_WAPP_DOWNLOAD_MEDIA','1072434yDYWkY','degreesLongitude','header','kkTvk','%2C','TpojG','caption','MHzCx','buttonsResponseMessage','quotedMessage','participant','Get\x20Body\x20Message\x20-->\x20','xPTIN','xjDXi','locationMessage','vcard'];a=function(){return aW;};return a();}var __importDefault=this&&this[aB(0x89)]||function(c){const aC=aB;return c&&c[aC(0xa6)]?c:{'default':c};};Object[aB(0xb8)](exports,aB(0xa6),{'value':!![]}),exports['getQuotedMessageId']=exports[aB(0x9e)]=exports[aB(0x117)]=exports['VerifyMediaMessageBaileys']=exports[aB(0xd1)]=exports['VerifyContactBaileys']=void 0x0;const CreateOrUpdateContactService_1=__importDefault(require('../../ContactServices/CreateOrUpdateContactService')),baileys_1=require('@whiskeysockets/baileys'),CreateMessageService_1=__importDefault(require(aB(0xbf))),util_1=require(aB(0x111)),fs_1=require('fs'),path_1=require(aB(0xe0)),logger_1=require(aB(0xc0)),Message_1=__importDefault(require(aD(0xc5))),writeFileAsync=(0x0,util_1['promisify'])(fs_1['writeFile']),VerifyContactBaileys=async(c,d,e,f=![],g=undefined)=>{const aE=aB,aF=aD;let h='',i='',j='';if(f)h=g[aE(0xaf)],j=g[aE(0xaf)],i=g['id'][aF(0xd4)]('@')[0x0];else{if(c[aE(0xa3)]['participant']){if('VTvfI'!==aE(0x103)){h='*'+i?.[aF(0x10e)]?.[aF(0x112)]?.['contentText']+'*';for(const n of m['message']?.[aE(0x112)]?.[aF(0xad)]){o+='\x0a\x0a'+n[aE(0xb9)][aF(0xbc)];}return l;}else i=c[aE(0xa3)][aF(0xec)]?.['split']('@')[0x0];}else i=c['key']['remoteJid']?.[aE(0xd4)]('@')[0x0];c[aF(0xa3)][aE(0xff)]?aF(0xe5)!=='kkTvk'?e[aF(0xd8)][aF(0xa4)](f):(h=i,j=i):(h=c[aE(0x100)],j=c[aE(0x100)]);}const k={'name':h,'number':i,'profilePicUrl':e,'tenantId':Number(d),'pushname':j,'isUser':![],'isWAContact':![],'isGroup':f},l=await(0x0,CreateOrUpdateContactService_1[aE(0xb3)])(k);return l;};exports[aB(0x10a)]=VerifyContactBaileys;const VerifyMessageBaileys=async(c,d,e,f)=>{const aG=aD,aH=aD,g=await(0x0,exports[aG(0x117)])(c),h=await(0x0,exports[aG(0x9e)])(c),i={'messageId':String(c[aG(0xa3)]['id']),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':String(h),'fromMe':d,'read':d,'mediaType':getTypeMessage(c),'quotedMsgId':g?.['id'],'timestamp':new Date()[aG(0x105)](),'status':'received','dataJson':JSON[aH(0xce)](c)};await e['update']({'lastMessage':String(h),'lastMessageAt':new Date()[aG(0x105)](),'answered':d||![]}),await(0x0,CreateMessageService_1[aH(0xb3)])({'messageData':i,'tenantId':e['tenantId']});};exports['VerifyMessageBaileys']=VerifyMessageBaileys;const VerifyMediaMessageBaileys=async(c,d,e)=>{const aI=aD,aJ=aD,f=await(0x0,exports[aI(0x117)])(c);try{const g=await downloadMedia(c);if(g[aJ(0xf7)]===aJ(0xa4)){if(aJ(0xca)!=='sHivB')k?.[aJ(0x10e)]?.['viewOnceMessage']?.[aJ(0x10e)]?.[aI(0x9d)]&&(s=aJ(0x9d)),m?.[aI(0x10e)]?.['viewOnceMessage']?.[aI(0x10e)]?.['buttonsMessage']&&(t=aJ(0x112)),o?.[aJ(0x10e)]?.[aJ(0x108)]?.['message']&&(u=(0x0,v[aJ(0x90)])(w?.[aI(0x10e)]?.[aI(0x108)]?.['message']));else throw new Error(aI(0xe1));}if(!g)throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');if(!g[aI(0xfe)]){const k=g[aJ(0xab)][aJ(0xd4)]('/')[0x1][aJ(0xd4)](';')[0x0];g[aJ(0xfe)]=new Date()[aJ(0x105)]()+'.'+k;}else{const l=g['filename'][aI(0xd4)]('.')[aJ(0x8a)](),m=g[aI(0xfe)]['split']('.')['slice'](0x0,-0x1)[aI(0x9b)]('.')['replace'](/\s/g,'_')[aI(0x8d)](aI(0xf4))['replace'](/[\u0300-\u036f]/g,'');g['filename']=m[aI(0xf8)]()+'_'+new Date()[aJ(0x105)]()+'.'+l;}try{await writeFileAsync((0x0,path_1['join'])(__dirname,'..','..','..','..',aJ(0xc6),g['filename']),g['data'],aJ(0xd5));}catch(n){logger_1[aI(0xd8)][aI(0xa4)](n);}const h=await(0x0,exports[aJ(0x9e)])(c),i={'messageId':String(c[aI(0xa3)]['id']),'ticketId':d['id'],'contactId':c[aJ(0xa3)][aJ(0xff)]?undefined:e['id'],'body':h||g['filename'],'fromMe':!!c['key'][aI(0xff)],'read':!!c[aJ(0xa3)][aJ(0xff)],'quotedMsgId':f?.['id'],'ack':c['status'],'mediaUrl':g[aI(0xfe)],'dataJson':JSON[aI(0xce)](c),'mediaType':g['mimetype'][aJ(0xd4)]('/')[0x0]};await d['update']({'lastMessage':h||g[aJ(0xfe)]}),await(0x0,CreateMessageService_1[aI(0xb3)])({'messageData':i,'tenantId':d['tenantId']});}catch(o){if(aI(0x110)!==aI(0x110))return{'data':aI(0xa4),'mimetype':'','filename':''};else logger_1[aJ(0xd8)][aJ(0xa4)](o);}};exports[aD(0x92)]=VerifyMediaMessageBaileys;const verifyQuotedMessage=async c=>{if(!c)return null;const d=(0x0,exports['getQuotedMessageId'])(c);if(!d)return null;const e=await Message_1['default']['findOne']({'where':{'messageId':d}});if(!e)return null;return e;};exports[aB(0x117)]=verifyQuotedMessage;const downloadMedia=async c=>{const aK=aD,aL=aB,d=c[aK(0x10e)]?.['imageMessage']||c[aK(0x10e)]?.[aK(0xc3)]||c[aK(0x10e)]?.[aL(0x10f)]||c[aL(0x10e)]?.[aK(0xb1)]||c[aK(0x10e)]?.[aK(0xb7)]||c[aK(0x10e)]?.['documentWithCaptionMessage']?.[aK(0x10e)]?.[aL(0xb7)]||c['message']?.['extendedTextMessage']?.[aL(0x101)]?.['quotedMessage']?.['imageMessage']||c[aL(0x10e)]?.['extendedTextMessage']?.[aL(0x101)]?.[aL(0xeb)]?.[aL(0x10f)];let e=d[aL(0xab)]['split']('/')[0x0]['replace'](aL(0x107),aK(0xf5))?d['mimetype'][aL(0xd4)]('/')[0x0][aL(0xf6)](aL(0x107),aL(0xf5)):d[aL(0xab)][aL(0xd4)]('/')[0x0],f,g=0x0;(c['message']?.[aL(0xb7)]||c[aL(0x10e)]?.['documentWithCaptionMessage'])&&(aK(0xef)!==aK(0xef)?e+='\x0a\x0a'+f[aK(0x118)]:e=aK(0xf5));while(g<0xa&&!f){try{aL(0xe7)!==aL(0xd3)?(g>0x1?logger_1[aK(0xd8)][aL(0xc1)](aL(0x96)+g+aL(0xaa)):'',f=await(0x0,baileys_1[aK(0xa5)])(c[aK(0x10e)]?.[aL(0xc3)]||c[aK(0x10e)]?.[aK(0x10f)]||c[aK(0x10e)]?.[aK(0xb7)]||c[aL(0x10e)]?.['documentWithCaptionMessage']?.[aK(0x10e)]?.[aK(0xb7)]||c[aK(0x10e)]?.[aL(0xfc)]||c[aL(0x10e)]?.['stickerMessage']||c['message']?.[aL(0xde)]?.[aK(0x101)]['quotedMessage']?.[aK(0xfc)]||c[aL(0x10e)]?.['extendedTextMessage']?.[aL(0x101)][aK(0xeb)]?.['videoMessage']||c['message']?.[aK(0x112)]?.[aL(0xfc)]||c['message']?.[aK(0x9c)]?.[aL(0x93)]?.[aK(0xfc)]||c['message']?.['templateMessage']?.['hydratedTemplate']?.[aL(0xfc)]||c['message']?.[aK(0x9c)]?.[aK(0xb0)]?.[aL(0xfc)]||c[aL(0x10e)]?.['interactiveMessage']?.[aK(0xe4)]?.[aL(0xfc)],e)):d=aL(0xcc);}catch(m){g++,await new Promise(n=>setTimeout(n,0x3e8*g*0x2)),logger_1[aL(0xd8)]['warn'](aL(0xae)+g+aL(0xaa));}}let h=Buffer[aL(0xdf)]([]);try{if('MHzCx'!==aL(0xe9))d=aL(0x10f);else for await(const o of f){h=Buffer[aK(0x11a)]([h,o]);}}catch(p){return{'data':aK(0xa4),'mimetype':'','filename':''};}if(!h)throw new Error(aL(0xe1));let i=c['message']?.[aK(0xb7)]?.[aK(0xd9)]||'';if(!i){if(aL(0xc8)===aL(0xb6))g[aL(0xd8)][aL(0xc1)](aL(0x8b)+h+'\x20-\x20'+i[aL(0xce)](j?.['message']));else{const r=d[aL(0xab)][aL(0xd4)]('/')[0x1]['split'](';')[0x0];i=new Date()[aL(0x105)]()+'.'+r;}}else{if(aL(0x10d)===aL(0xa0)){const t=f['mimetype']['split']('/')[0x1]['split'](';')[0x0];g[aK(0xfe)]=new h()[aK(0x105)]()+'.'+t;}else i=new Date()['getTime']()+'_'+i;}const j={'data':h,'mimetype':d[aK(0xab)],'filename':i};return j;},msgLocation=(c,d,e)=>{const aM=aD,aN=aB;if(c){var f=Buffer['from'](c)[aM(0xa8)](aN(0xd5));let g=aN(0xac)+f+aN(0x98)+d+aM(0xe6)+e+'&z=17&hl=pt-BR|'+d+',\x20'+e+'\x20';return g;}},getBodyMessage=async c=>{const aO=aB,aP=aB;let d;try{if(c?.[aO(0x10e)]?.[aP(0x112)]?.[aP(0x8f)]){d='*'+c?.[aO(0x10e)]?.[aO(0x112)]?.[aP(0x8f)]+'*';for(const e of c[aO(0x10e)]?.[aO(0x112)]?.[aP(0xad)]){d+='\x0a\x0a'+e['buttonText']['displayText'];}return d;}else{if(c?.[aO(0x10e)]?.[aO(0x9d)]){d='*'+c?.[aP(0x10e)]?.[aP(0x9d)]?.[aP(0xc7)]+'*';for(const f of c[aO(0x10e)]?.[aP(0x9d)]?.[aO(0x10c)][0x0]?.['rows']){if('xPTIN'===aP(0xee))d+='\x0a\x0a'+f[aO(0x118)];else{h='*'+i?.['message']?.[aO(0x9d)]?.[aO(0xc7)]+'*';for(const h of m['message']?.['listMessage']?.[aO(0x10c)][0x0]?.[aO(0x91)]){o+='\x0a\x0a'+h[aO(0x118)];}return l;}}return d;}}if(c[aP(0x10e)]?.['viewOnceMessage']?.['message']?.[aP(0x9d)]){if(aO(0xdd)!==aP(0x9f)){let h=c[aP(0x10e)]?.[aP(0x108)]?.['message']['listMessage'];d='*'+h[aO(0xc7)]+'*';for(const i of h?.['sections'][0x0]?.[aO(0x91)]){d+='\x0a\x0a'+i[aP(0x118)];}return d;}else return d?.['message']?.[aO(0xc2)]?.[aO(0x10e)]?.['protocolMessage']?.[aP(0xc2)]?.[aP(0xde)]?.[aP(0x119)];}if(c[aP(0x10e)]?.[aP(0x108)]?.[aP(0x10e)]?.[aO(0x112)]){let k=c[aO(0x10e)]?.[aP(0x108)]?.[aP(0x10e)][aO(0x112)];d='*'+k[aP(0x8f)]+'*';for(const l of k?.[aP(0xad)]){if(aO(0xda)===aP(0xf3)){if(j){var n=q[aP(0xdf)](r)[aP(0xa8)](aO(0xd5));let o='data:image/png;base64,\x20'+n+aO(0x98)+s+aO(0xe6)+t+aP(0xbd)+u+',\x20'+v+'\x20';return o;}}else d+='\x0a\x0a'+l[aO(0xb9)][aO(0xbc)];}return d;}}catch(n){logger_1[aO(0xd8)][aO(0xa4)](n);}try{if(aP(0x113)==='ncbaB'){const o=getTypeMessage(c);if(!o){if(aP(0xb5)===aO(0xb5))return;else d=aO(0xb1);}const p={'conversation':c['message'][aO(0xb4)],'imageMessage':c['message'][aP(0xfc)]?.['caption']||aO(0xc9),'videoMessage':c['message'][aP(0x10f)]?.[aP(0xe8)]||aP(0x94),'extendedTextMessage':d||c[aP(0x10e)][aO(0xde)]?.['text']||c['message']?.[aO(0x9d)]?.[aP(0xc7)],'buttonsResponseMessage':c['message'][aO(0xea)]?.['selectedDisplayText'],'listResponseMessage':c?.[aO(0x10e)]?.[aO(0xa1)]?.[aP(0x118)]||aP(0x10b),'templateButtonReplyMessage':c[aP(0x10e)]?.[aO(0xa7)]?.[aP(0xdc)],'messageContextInfo':c[aO(0x10e)][aP(0xea)]?.['selectedButtonId']||c['message'][aP(0xa1)]?.['title'],'buttonsMessage':d||c[aO(0x10e)]['listResponseMessage']?.[aO(0x118)],'stickerMessage':aP(0xcf),'contactMessage':c[aP(0x10e)][aP(0xcc)]?.[aP(0xf1)],'contactsArrayMessage':'varios\x20contatos','locationMessage':msgLocation(c[aP(0x10e)]?.[aO(0xf0)]?.[aP(0xfa)],c[aO(0x10e)]?.['locationMessage']?.[aO(0xd7)],c[aP(0x10e)]?.[aP(0xf0)]?.[aO(0xe3)]),'liveLocationMessage':msgLocation(c['message']?.[aP(0x99)]?.[aO(0xfa)],c[aO(0x10e)]?.[aO(0x99)]?.[aO(0xd7)],c[aO(0x10e)]?.[aP(0x99)]?.[aO(0xe3)]),'documentMessage':c[aO(0x10e)][aP(0xb7)]?.[aO(0x118)],'audioMessage':aP(0xdb),'reactionMessage':c[aP(0x10e)]?.['reactionMessage']?.[aP(0x119)],'ephemeralMessage':c[aP(0x10e)]?.[aO(0x8c)]?.[aP(0x10e)]?.[aO(0xde)]?.['text'],'protocolMessage':c[aP(0x10e)]?.[aP(0x106)]?.['type']||c[aO(0x10e)]?.['ephemeralMessage']?.[aO(0x10e)]?.[aO(0x106)]?.['type'],'listMessage':d||c[aP(0x10e)]?.[aP(0x9d)]?.[aO(0xc7)],'viewOnceMessage':d,'documentWithCaptionMessage':c['message']?.[aP(0xd0)]?.['message']?.[aO(0xb7)]?.[aP(0xe8)],'editedMessage':extractEditedMessage(c)},q=Object['keys'](p)[aO(0xf2)](s=>s===o);if(!q)logger_1[aP(0xd8)][aP(0xc1)]('Não\x20encontrou\x20o\x20tipo\x20em\x20getBodyMessage:\x20'+o+aO(0x9a)+JSON['stringify'](c?.[aP(0x10e)]));else{}return p[o];}else e['logger'][aP(0xa4)](f);}catch(t){console[aP(0x102)](aO(0xed)+t);}};exports[aB(0x9e)]=getBodyMessage;const extractEditedMessage=c=>{const aQ=aB,aR=aB;if(c?.[aQ(0x10e)]?.[aR(0xc2)]?.[aQ(0x10e)]?.['protocolMessage']?.[aQ(0xc2)]?.['conversation']){if(aR(0xd6)!==aR(0xfd))return c?.['message']?.['editedMessage']?.[aR(0x10e)]?.[aQ(0x106)]?.[aQ(0xc2)]?.[aQ(0xb4)];else d=aR(0xf5);}else{if(c?.[aQ(0x10e)]?.['editedMessage']?.[aR(0x10e)]?.[aQ(0x106)]?.['editedMessage']?.[aQ(0xde)]?.[aQ(0x119)])return c?.[aR(0x10e)]?.[aQ(0xc2)]?.['message']?.[aQ(0x106)]?.[aQ(0xc2)]?.[aQ(0xde)]?.[aR(0x119)];}return undefined;},getTypeMessage=c=>{const aS=aB,aT=aD;try{let d=(0x0,baileys_1[aS(0x90)])(c?.[aS(0x10e)]);d===aS(0x108)&&(c?.[aS(0x10e)]?.['viewOnceMessage']?.[aT(0x10e)]?.[aS(0x9d)]&&(d=aS(0x9d)),c?.[aT(0x10e)]?.[aS(0x108)]?.['message']?.[aS(0x112)]&&(d=aS(0x112)),c?.['message']?.[aT(0x108)]?.[aT(0x10e)]&&(d=(0x0,baileys_1[aT(0x90)])(c?.[aS(0x10e)]?.[aT(0x108)]?.[aS(0x10e)])));if(d===aT(0x8c)){c?.[aS(0x10e)]?.[aS(0x8c)]?.['message']?.[aT(0x9d)]&&(aS(0x114)==='aedqY'?e[aS(0x102)]('Get\x20Body\x20Message\x20-->\x20'+f):d='listMessage');c?.['message']?.[aS(0x8c)]?.['message']?.['buttonsMessage']&&('NkJIB'!==aS(0xbb)?d=aS(0x112):f=(0x0,g['getContentType'])(h?.['message']?.[aT(0x108)]?.[aS(0x10e)]));c?.[aS(0x10e)]?.[aS(0x8c)]?.[aT(0x10e)]?.[aS(0xfc)]&&(d=aS(0xfc));if(c?.[aT(0x10e)]?.[aS(0x8c)]?.['message']?.[aT(0xc3)]){if('YCnpH'!==aS(0x104))throw new d('ERR_WAPP_DOWNLOAD_MEDIA');else d=aS(0xc3);}c?.['message']?.[aS(0x8c)]?.[aS(0x10e)]?.[aT(0xc3)]&&(aS(0xc4)===aS(0xc4)?d=aS(0x10f):e['logger'][aS(0xa4)]('Get\x20Type\x20Message\x20->\x20'+f));c?.['message']?.['ephemeralMessage']?.[aS(0x10e)]?.['documentMessage']&&(d=aS(0xb7));if(c?.['message']?.['ephemeralMessage']?.[aT(0x10e)]?.[aS(0xb1)]){if(aS(0x109)===aS(0x109))d=aS(0xb1);else return g&&h[aT(0xa6)]?i:{'default':j};}c?.['message']?.['ephemeralMessage']?.['message']?.[aT(0xcc)]&&(d='contactMessage'),c?.['message']?.[aT(0x8c)]?.[aS(0x10e)]?.[aT(0xf0)]&&(d=aS(0xf0)),c?.['message']?.[aS(0x8c)]?.[aT(0x10e)]?.[aT(0x106)]&&(d='protocolMessage'),c?.[aS(0x10e)]?.[aS(0x8c)]?.['message']?.[aS(0x108)]&&(d=(0x0,baileys_1['getContentType'])(c?.[aS(0x10e)]?.[aT(0x8c)]?.[aS(0x10e)]?.['viewOnceMessage']?.['message']));}return d;}catch(j){logger_1[aT(0xd8)][aS(0xa4)](aT(0xba)+j);}},getQuotedMessageId=c=>{const aU=aD,aV=aB,d=(0x0,baileys_1[aU(0xfb)])(c[aV(0x10e)])[Object[aV(0xa2)](c?.[aU(0x10e)])[aU(0xbe)]()['next']()[aU(0xd2)]];let e=c?.[aU(0x10e)]?.[aV(0xb2)]?c?.[aU(0x10e)]?.[aV(0xb2)]?.[aU(0xa3)]?.['id']:'';return e?e:d?.[aU(0x101)]?.['stanzaId'];};exports[aB(0xcb)]=getQuotedMessageId;