'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x137;let h=e[f];return h;},b(c,d);}const I=b,J=b;(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=parseInt(G(0x15e))/0x1*(-parseInt(G(0x144))/0x2)+-parseInt(H(0x16f))/0x3*(parseInt(G(0x15f))/0x4)+-parseInt(H(0x189))/0x5*(parseInt(G(0x167))/0x6)+parseInt(G(0x16a))/0x7*(parseInt(H(0x14d))/0x8)+parseInt(G(0x165))/0x9+-parseInt(H(0x187))/0xa+parseInt(H(0x140))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x4698b));var __createBinding=this&&this[I(0x15c)]||(Object[J(0x17d)]?function(c,d,e,f){const K=J,L=I;if(f===undefined)f=e;var g=Object[K(0x188)](d,e);(!g||('get'in g?!d[K(0x13b)]:g['writable']||g[L(0x18a)]))&&(g={'enumerable':!![],'get':function(){const M=K,N=K;return M(0x14f)!==M(0x14f)?e[f]:d[e];}}),Object[L(0x13d)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[J(0x17d)]?function(c,d){const O=J,P=J;Object[O(0x13d)](c,P(0x163),{'enumerable':!![],'value':d});}:function(c,d){const Q=I;c[Q(0x163)]=d;}),__importStar=this&&this['__importStar']||function(c){const R=I,S=I;if(c&&c[R(0x13b)])return c;var d={};if(c!=null){for(var e in c)if(e!==S(0x163)&&Object['prototype'][S(0x177)][R(0x155)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[I(0x156)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[I(0x13d)](exports,J(0x13b),{'value':!![]}),exports[J(0x17c)]=void 0x0;const path_1=__importStar(require(J(0x164))),sequelize_1=require(J(0x162)),Message_1=__importDefault(require(J(0x17a))),Ticket_1=__importDefault(require(J(0x173))),logger_1=require(I(0x154)),fs_1=__importDefault(require('fs')),mime_types_1=__importDefault(require(J(0x170))),child_process_1=require(J(0x16b)),ffmpeg_1=__importDefault(require('@ffmpeg-installer/ffmpeg')),SetTicketMessagesAsRead_1=__importDefault(require(I(0x168))),publicFolder=path_1[J(0x163)][J(0x166)](__dirname,'..','..','..',I(0x182)),SendMessagesSystemWbotBaileys=async(c,d,e=undefined)=>{const T=J,U=J;let f;if(!e){const h={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':'pending',[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][T(0x158)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]};f=await Message_1['default'][U(0x159)]({'where':h,'include':[{'model':Ticket_1[T(0x163)],'as':U(0x137),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:U(0x16c)},'isFarewellMessage':!![]},'channel':T(0x143),'whatsappId':c['id']},'include':['contact']}],'order':[['createdAt',U(0x18b)]]});}else f=e;let g;await f['forEach'](async i=>{const V=T,W=T;let j={};const {ticket:k}=i,l=k[V(0x160)][V(0x151)],m=k?.[W(0x145)]?W(0x172):V(0x15a),n=l+'@'+m;if(i['quotedMsgId']){const o=await Message_1[V(0x163)][V(0x13f)]({'where':{'id':i['quotedMsgId']}});j=o;}try{if(V(0x176)!=='VCshA')(0x0,j['exec'])(k['default'][W(0x164)]+V(0x181)+l+V(0x13c)+m+'\x20-y',(w,x,y)=>{if(w)q(w);r(s);});else{if(i[W(0x157)]!=='chat'&&i[W(0x142)]){if(V(0x17e)!=='dhqNR')i={'image':j[W(0x163)]['readFileSync'](k),'caption':l?m:n};else{const s=await(0x0,path_1[V(0x147)])(__dirname,'..','..','..',W(0x182)),t=(0x0,path_1[W(0x147)])(s,i[W(0x142)]),u=await(0x0,exports['getMessageOptions'])(i[V(0x142)],t);if(u){if(W(0x14c)!==W(0x14c)){if(h)i(j);k(l);}else g=await c['sendMessage'](n,{...u});}logger_1['logger'][W(0x175)]('sendMessage\x20media');}}else{if(j['id']){if(V(0x148)!==W(0x148))return g&&h[W(0x13b)]?i:{'default':j};else{let x={'quoted':{'key':{'remoteJid':n,'id':j[V(0x178)]},'message':{'extendedTextMessage':{'text':j[V(0x180)]}}}};g=await c['sendMessage'](n,{'text':i[W(0x180)]},{...x});}}else g=await c['sendMessage'](n,{'text':i[W(0x180)]});}const q={'messageId':g[V(0x14e)]['id'],'status':V(0x150)};await Message_1[V(0x163)][V(0x13e)]({...q},{'where':{'id':i['id']}}),await(0x0,SetTicketMessagesAsRead_1['default'])(k);}}catch(y){const z=i['id'],A=i[W(0x137)]['id'];y[W(0x14a)]===W(0x15d)&&(W(0x169)===W(0x169)?await Message_1[W(0x163)][V(0x179)]({'where':{'id':i['id']}}):f['defineProperty'](g,W(0x163),{'enumerable':!![],'value':h})),logger_1['logger']['error']('Error\x20message\x20is\x20(tenant:\x20'+d+V(0x149)+A+')'),logger_1[W(0x184)][V(0x152)]('Error\x20send\x20message\x20(id:\x20'+z+W(0x161)+y);}});},getMessageOptions=async(c,d,f)=>{const X=J,Y=J,g=mime_types_1[X(0x163)]['lookup'](d),h=String(g)[X(0x153)]('/')[0x0];try{if(!g)throw new Error(Y(0x186));let i;if(h===X(0x16e)){if(Y(0x17f)!==Y(0x141))i={'video':fs_1[X(0x163)][X(0x13a)](d),'caption':f?f:c,'fileName':c};else return e['logger'][Y(0x152)](f),null;}else{if(h===X(0x138)){const k=c[X(0x174)](X(0x17b)),l=await processAudio(d);if(k)i={'audio':fs_1[X(0x163)][X(0x13a)](l),'mimetype':k?Y(0x14b):g,'ptt':!![]};else{if(Y(0x16d)===X(0x146)){if(p===q)r=s;var n=t[Y(0x188)](u,v);(!n||('get'in n?!w[Y(0x13b)]:n['writable']||n[X(0x18a)]))&&(n={'enumerable':!![],'get':function(){return n[F];}}),z['defineProperty'](A,B,n);}else i={'audio':fs_1[Y(0x163)][Y(0x13a)](l),'mimetype':k?'audio/mp4':g,'ptt':!![]};}}else{if(h===Y(0x183))i={'document':fs_1[Y(0x163)][Y(0x13a)](d),'caption':f?f:c,'fileName':c,'mimetype':g};else h==='application'?i={'document':fs_1[Y(0x163)]['readFileSync'](d),'caption':f?f:c,'fileName':c,'mimetype':g}:i={'image':fs_1[Y(0x163)][X(0x13a)](d),'caption':f?f:c};}}return i;}catch(n){return logger_1['logger'][X(0x152)](n),null;}};exports[J(0x17c)]=getMessageOptions;function a(){const a3=['mime-types','.mp3','g.us','../../models/Ticket','includes','info','VCshA','hasOwnProperty','messageId','destroy','../../models/Message','audio-record-site','getMessageOptions','create','dhqNR','PjAko','body','\x20-i\x20','public','document','logger','DmKCE','Invalid\x20mimetype','5472810KYxRcT','getOwnPropertyDescriptor','615fhTNgL','configurable','ASC','ticket','audio','getTime','readFileSync','__esModule','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','defineProperty','update','findOne','12330813XdqTGl','VkIfj','mediaName','whatsapp','6oMhVqf','isGroup','nYXRY','join','URffm','\x20|\x20Ticket:\x20','code','audio/mp4','QKAnz','72184ZOTXmP','key','Qnxlk','sended','number','error','split','../../utils/logger','call','__importDefault','mediaType','lte','findAll','s.whatsapp.net','exec','__createBinding','ENOENT','26583JtewBv','933564tBtZfE','contact',')::','sequelize','default','path','803610iOjyST','resolve','19686bwbDyp','../../helpers/SetTicketMessagesAsRead','LjEuZ','266UVpabq','child_process','closed','mlqOR','video','3VWzGgb'];a=function(){return a3;};return a();}const processAudio=async c=>{const Z=J,a0=I,d=publicFolder+'/'+new Date()[Z(0x139)]()+Z(0x171);return new Promise((e,f)=>{const a1=Z,a2=a0;'DmKCE'===a1(0x185)?(0x0,child_process_1[a1(0x15b)])(ffmpeg_1[a1(0x163)][a2(0x164)]+a1(0x181)+c+a2(0x13c)+d+'\x20-y',(g,h,i)=>{if(g)f(g);e(d);}):h={'audio':i['default'][a1(0x13a)](j),'mimetype':k?a1(0x14b):l,'ptt':!![]};});};exports[I(0x163)]=SendMessagesSystemWbotBaileys;