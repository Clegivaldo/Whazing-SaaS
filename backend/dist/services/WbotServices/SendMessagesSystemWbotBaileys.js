'use strict';const I=b,L=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x159;let h=e[f];return h;},b(c,d);}(function(c,d){const G=b,H=b,e=c();while(!![]){try{const f=-parseInt(G(0x17f))/0x1+parseInt(G(0x197))/0x2+-parseInt(G(0x172))/0x3*(parseInt(G(0x161))/0x4)+parseInt(H(0x179))/0x5*(-parseInt(H(0x18d))/0x6)+parseInt(G(0x18c))/0x7+-parseInt(H(0x196))/0x8*(parseInt(G(0x15d))/0x9)+parseInt(H(0x1ab))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x231b8));function a(){const a0=['OZzyy','createdAt','ASC','body','__esModule','VYLbY','hasOwnProperty','sendMessage','path','mediaName','default','sendMessage\x20media','DLZye','get','number','7050800ILVMLt','ENOENT','contact','quotedMsgId','\x20-y','includes','SZeGC','@ffmpeg-installer/ffmpeg','create','defineProperty','g.us','342YElNCV','../../models/Message','prototype','sequelize','1492oeWAuR','code','writable','getMessageOptions','chat','getTime',')::','__importStar','../../models/Ticket','configurable','pevpw','__setModuleDefault','getOwnPropertyDescriptor','\x20-i\x20','split','messageId','s.whatsapp.net','2154AtRZMh','isGroup','Yolaz','resolve','tixwq','video','sended','780RIUeaN','dStoG','call','../../utils/logger','.mp3','exec','164870UhCdGy','OdyOh','closed','whatsapp','readFileSync','JigRu','QCwBg','logger','public','update','audio','lookup','bvGZG','193130PjHZly','156Syvhmp','error','audio/mp4','audio-record-site','info','ticket','join','__importDefault','lte','44360CxscRA','117160ZPIyJI','pending','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','BdvAp','Error\x20message\x20is\x20(tenant:\x20'];a=function(){return a0;};return a();}var __createBinding=this&&this['__createBinding']||(Object[I(0x15a)]?function(c,d,e,f){const J=I,K=I;if(f===undefined)f=e;var g=Object[J(0x16d)](d,e);(!g||(J(0x1a9)in g?!d['__esModule']:g[K(0x163)]||g[J(0x16a)]))&&(g={'enumerable':!![],'get':function(){return d[e];}}),Object[J(0x15b)](c,f,g);}:function(c,d,e,f){if(f===undefined)f=e;c[f]=d[e];}),__setModuleDefault=this&&this[L(0x16c)]||(Object[L(0x15a)]?function(c,d){const M=L;Object[M(0x15b)](c,'default',{'enumerable':!![],'value':d});}:function(c,d){c['default']=d;}),__importStar=this&&this[L(0x168)]||function(c){const N=L,O=L;if(c&&c[N(0x1a0)])return c;var d={};if(c!=null){for(var e in c)if(e!==O(0x1a6)&&Object[O(0x15f)][N(0x1a2)][O(0x17b)](c,e))__createBinding(d,c,e);}return __setModuleDefault(d,c),d;},__importDefault=this&&this[I(0x194)]||function(c){const P=L;return c&&c[P(0x1a0)]?c:{'default':c};};Object[I(0x15b)](exports,I(0x1a0),{'value':!![]}),exports[I(0x164)]=void 0x0;const path_1=__importStar(require(I(0x1a4))),sequelize_1=require(I(0x160)),Message_1=__importDefault(require(I(0x15e))),Ticket_1=__importDefault(require(L(0x169))),logger_1=require(L(0x17c)),fs_1=__importDefault(require('fs')),mime_types_1=__importDefault(require('mime-types')),child_process_1=require('child_process'),ffmpeg_1=__importDefault(require(I(0x159))),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),publicFolder=path_1[L(0x1a6)][I(0x175)](__dirname,'..','..','..',I(0x187)),SendMessagesSystemWbotBaileys=async(c,d,e=undefined)=>{const Q=I,R=L;let f;if(!e){const h={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':Q(0x198),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][Q(0x195)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]};f=await Message_1[R(0x1a6)]['findAll']({'where':h,'include':[{'model':Ticket_1[Q(0x1a6)],'as':Q(0x192),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:R(0x181)},'isFarewellMessage':!![]},'channel':R(0x182),'whatsappId':c['id']},'include':[Q(0x1ad)]}],'order':[[Q(0x19d),R(0x19e)]]});}else f=e;let g;await f['forEach'](async i=>{const S=Q,T=Q;let j={};const {ticket:k}=i,l=k['contact'][S(0x1aa)],m=k?.[T(0x173)]?S(0x15c):T(0x171),n=l+'@'+m;if(i[S(0x1ae)]){const o=await Message_1['default']['findOne']({'where':{'id':i['quotedMsgId']}});j=o;}try{if(T(0x180)==='OdyOh'){if(i['mediaType']!==S(0x165)&&i[T(0x1a5)]){const q=await(0x0,path_1[S(0x193)])(__dirname,'..','..','..',S(0x187)),r=(0x0,path_1[T(0x193)])(q,i[T(0x1a5)]),s=await(0x0,exports[T(0x164)])(i[T(0x1a5)],r);s&&(S(0x19c)!==S(0x19c)?f={'enumerable':!![],'get':function(){return i[j];}}:g=await c[T(0x1a3)](n,{...s})),logger_1[S(0x186)][T(0x191)](T(0x1a7));}else{if(S(0x17a)===T(0x17a)){if(j['id']){if(T(0x1b1)!==S(0x1b1))return e[f];else{let v={'quoted':{'key':{'remoteJid':n,'id':j[S(0x170)]},'message':{'extendedTextMessage':{'text':j[S(0x19f)]}}}};g=await c[T(0x1a3)](n,{'text':i[S(0x19f)]},{...v});}}else g=await c[T(0x1a3)](n,{'text':i[S(0x19f)]});}else h={'audio':i[S(0x1a6)][T(0x183)](j),'mimetype':k?T(0x18f):l,'ptt':!![]};}const p={'messageId':g['key']['id'],'status':T(0x178)};await Message_1[S(0x1a6)][T(0x188)]({...p},{'where':{'id':i['id']}}),await(0x0,SetTicketMessagesAsRead_1[T(0x1a6)])(k);}else throw new d('Invalid\x20mimetype');}catch(y){if(S(0x184)===T(0x184)){const z=i['id'],A=i['ticket']['id'];if(y[T(0x162)]===T(0x1ac)){if('bZjaP'!=='bZjaP')return e['logger'][T(0x18e)](f),null;else await Message_1['default']['destroy']({'where':{'id':i['id']}});}logger_1[T(0x186)][S(0x18e)](T(0x19b)+d+'\x20|\x20Ticket:\x20'+A+')'),logger_1['logger']['error']('Error\x20send\x20message\x20(id:\x20'+z+S(0x167)+y);}else return g&&h[S(0x1a0)]?i:{'default':j};}});},getMessageOptions=async(c,d,f)=>{const U=I,V=L,g=mime_types_1[U(0x1a6)][U(0x18a)](d),h=String(g)[V(0x16f)]('/')[0x0];try{if(!g){if('qytBC'===V(0x1a8))e[V(0x1a6)]=f;else throw new Error('Invalid\x20mimetype');}let i;if(h===V(0x177))U(0x1a1)!==V(0x19a)?i={'video':fs_1[U(0x1a6)][U(0x183)](d),'caption':f?f:c,'fileName':c}:k={'document':l[V(0x1a6)][U(0x183)](m),'caption':n?o:p,'fileName':q,'mimetype':r};else{if(h===U(0x189)){if('Yolaz'===V(0x174)){const l=c[U(0x1b0)](V(0x190)),m=await processAudio(d);l?U(0x18b)===U(0x16b)?h={'audio':i[V(0x1a6)][U(0x183)](j),'mimetype':k?U(0x18f):l,'ptt':!![]}:i={'audio':fs_1['default'][V(0x183)](m),'mimetype':l?'audio/mp4':g,'ptt':!![]}:V(0x185)!=='QCwBg'?(0x0,j['exec'])(k[V(0x1a6)][V(0x1a4)]+V(0x16e)+l+V(0x199)+m+V(0x1af),(w,x,y)=>{if(w)q(w);r(s);}):i={'audio':fs_1[U(0x1a6)][V(0x183)](m),'mimetype':l?'audio/mp4':g,'ptt':!![]};}else{if(p===q)r=s;var q=t['getOwnPropertyDescriptor'](u,v);(!q||(U(0x1a9)in q?!w[V(0x1a0)]:q[V(0x163)]||q[U(0x16a)]))&&(q={'enumerable':!![],'get':function(){return q[F];}}),z[V(0x15b)](A,B,q);}}else{if(h==='document')i={'document':fs_1['default']['readFileSync'](d),'caption':f?f:c,'fileName':c,'mimetype':g};else h==='application'?i={'document':fs_1['default'][V(0x183)](d),'caption':f?f:c,'fileName':c,'mimetype':g}:i={'image':fs_1['default'][U(0x183)](d),'caption':f?f:c};}}return i;}catch(q){return logger_1[U(0x186)]['error'](q),null;}};exports[L(0x164)]=getMessageOptions;const processAudio=async c=>{const W=I,X=L,d=publicFolder+'/'+new Date()[W(0x166)]()+X(0x17d);return new Promise((e,f)=>{const Y=W,Z=X;'tixwq'===Y(0x176)?(0x0,child_process_1[Y(0x17e)])(ffmpeg_1[Z(0x1a6)]['path']+'\x20-i\x20'+c+Y(0x199)+d+Y(0x1af),(g,h,i)=>{if(g)f(g);e(d);}):k={'document':l[Y(0x1a6)]['readFileSync'](m),'caption':n?o:p,'fileName':q,'mimetype':r};});};exports[I(0x1a6)]=SendMessagesSystemWbotBaileys;