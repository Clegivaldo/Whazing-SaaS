'use strict';const B=b,D=b;(function(c,d){const z=b,A=b,e=c();while(!![]){try{const f=-parseInt(z(0x76))/0x1*(-parseInt(A(0x84))/0x2)+parseInt(z(0x6d))/0x3*(parseInt(A(0x8e))/0x4)+-parseInt(A(0x90))/0x5+parseInt(A(0x93))/0x6*(parseInt(z(0x9e))/0x7)+-parseInt(A(0x97))/0x8+-parseInt(z(0x67))/0x9*(parseInt(z(0x7c))/0xa)+parseInt(A(0x7b))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xbd664));var __importDefault=this&&this[B(0x8c)]||function(c){const C=B;return c&&c[C(0x68)]?c:{'default':c};};Object[D(0x79)](exports,D(0x68),{'value':!![]}),exports[B(0x7e)]=void 0x0;function b(c,d){const e=a();return b=function(f,g){f=f-0x67;let h=e[f];return h;},b(c,d);}function a(){const I=['2116671oxpKJn','number','tenantId','nome','setTags','head','numero','NOT_FOUND_WHATSAPP_CONNECTED','push','41mecDnx','CONNECTED','nudMG','defineProperty','sheet_to_json','4376229WzgqCy','10cdOQOP','E-mail','ImportFileContactsService','Número\x20não\x20é\x20uma\x20conta\x20válida\x20','Numero','Sheets','número','whatsapp','21444EyzDre','../../libs/wbot-baileys','kQNlS','Email','FdwGX','findOne','yMFJR','ZDpug','__importDefault','findOrCreate','8NmLJEZ','utils','4757820YeDAxJ','CONTACT_NOT_FOUND','lodash','6LYrewp','AiqgS','path','length','4201952MjcYIr','../../errors/AppError','has','default','xlsx','email','Número','369082rUYwuI','getWbot','onWhatsApp','readFile','438237tgXdlY','__esModule','Nome','replace','@$s.whatsapp.net','exists'];a=function(){return I;};return a();}const lodash_1=require(D(0x92)),xlsx_1=__importDefault(require(B(0x9b))),Contact_1=__importDefault(require('../../models/Contact')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),AppError_1=__importDefault(require(D(0x98))),wbot_baileys_1=require(D(0x85));async function ImportFileContactsService(c,d,e,f){const E=D,F=D,g=xlsx_1[E(0x9a)][E(0xa1)](d?.[E(0x95)]),h=(0x0,lodash_1[F(0x72)])(Object['values'](g[F(0x81)])),i=xlsx_1[F(0x9a)][F(0x8f)][F(0x7a)](h,{'header':0x0}),j=[];i['forEach'](l=>{const G=F,H=F;if(G(0x8a)==='elfdb')throw new d['default']('NOT_FOUND_WHATSAPP_CONNECTED',0x194);else{let n='',o='',p='';((0x0,lodash_1[G(0x99)])(l,'nome')||(0x0,lodash_1[H(0x99)])(l,G(0x69)))&&(n=l[G(0x70)]||l[G(0x69)]),((0x0,lodash_1[H(0x99)])(l,H(0x73))||(0x0,lodash_1[G(0x99)])(l,'número')||(0x0,lodash_1['has'])(l,H(0x80))||(0x0,lodash_1[H(0x99)])(l,H(0x9d)))&&(o=l[G(0x73)]||l[H(0x82)]||l['Numero']||l[H(0x9d)],o=(''+o)['replace'](/\D/g,'')),((0x0,lodash_1[G(0x99)])(l,H(0x9c))||(0x0,lodash_1[G(0x99)])(l,'e-mail')||(0x0,lodash_1[G(0x99)])(l,G(0x87))||(0x0,lodash_1[H(0x99)])(l,G(0x7d)))&&(p=l[G(0x9c)]||l['e-mail']||l['Email']||l[G(0x7d)]),n=n||o,n&&o&&o['length']>=0xa&&j[G(0x75)]({'name':n,'number':o,'email':p,'tenantId':c});}});const k=[];for(const l of j){if(F(0x8b)!==F(0x8b))throw new d[(E(0x9a))](E(0x91),0x194);else try{l['number']=l[F(0x6e)][F(0x6a)]('-','')[E(0x6a)]('\x20','')[E(0x6a)]('(','')[E(0x6a)](')','');const n=await Whatsapp_1[F(0x9a)][E(0x89)]({'where':{'status':E(0x77),'tenantId':c,'type':F(0x83)}});if(!n){if(F(0x94)!==E(0x94))e[E(0x75)](f);else throw new AppError_1[(E(0x9a))](F(0x74),0x194);}const o=(0x0,wbot_baileys_1[F(0x9f)])(n['id']),p=l[E(0x6e)]+F(0x6b),q=await o[E(0xa0)](p);if(q[0x0][F(0x6c)]==![]){if(F(0x78)===F(0x78))throw new AppError_1[(F(0x9a))]('CONTACT_NOT_FOUND',0x194);else f=g[E(0x70)]||h[F(0x69)];}l[E(0x6e)]=q[0x0]['jid']['split']('@')[0x0];const [r,s]=await Contact_1['default'][E(0x8d)]({'where':{'number':l[E(0x6e)],'tenantId':l[F(0x6f)]},'defaults':l}),t=r;s&&k['push'](r);if(e?.[E(0x96)]){if('kQNlS'===F(0x86))await t[F(0x71)](e,{'through':{'tenantId':c}});else return g&&h[F(0x68)]?i:{'default':j};}f?.['length']&&await t['setWallets'](f,{'through':{'tenantId':c}});}catch(x){'FdwGX'===F(0x88)?console['error'](F(0x7f)+l[F(0x6e)]):h['push']({'name':i,'number':j,'email':k,'tenantId':l});}}return k;}exports[D(0x7e)]=ImportFileContactsService;