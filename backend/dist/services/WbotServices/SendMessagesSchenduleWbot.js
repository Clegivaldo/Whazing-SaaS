'use strict';const u=b,v=b;(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=-parseInt(r(0x8a))/0x1*(parseInt(s(0x96))/0x2)+parseInt(r(0xa7))/0x3+parseInt(s(0xa5))/0x4+parseInt(s(0x7f))/0x5*(parseInt(s(0xa8))/0x6)+parseInt(r(0x97))/0x7*(-parseInt(r(0x88))/0x8)+-parseInt(r(0x9e))/0x9*(-parseInt(r(0xa4))/0xa)+-parseInt(r(0x80))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xda94f));function b(c,d){const e=a();return b=function(f,g){f=f-0x72;let h=e[f];return h;},b(c,d);}function a(){const A=['defineProperty','code','\x20|\x20Ticket:\x20','\x20|\x20Tenant:\x20','ticket','1557KPZTfk','error','MAX_SLEEP_INTERVAL','whatsapp','env','public','87630xIXWJX','4288420lpzadt','scheduleDate','812064dOvSib','3228DOUMoD','join','createdAt','../../libs/wbot-baileys','mediaType',')::','pending','../../utils/logger','sendMessage\x20Schendule','info','default','ASC','Message\x20Schendule\x20Queue:\x20','../../models/Ticket','sequelize','__esModule','path','getTime','forEach','11185nxkIlJ','7607578zAYVCm','Message\x20Update\x20Schendule','ENOENT','ticketId','update','mediaName','getMessageOptions','./SendMessagesSystemWbotBaileys','293512osKKmE','logger','295oLUPUo','getWbot','../../models/Message','body','number','sendMessage\x20text\x20Schendule','closed','chat','../../utils/sleepRandomTime','sendMessage','whatsappId','destroy','6584lhaUvh','287iKYozb','MIN_SLEEP_INTERVAL'];a=function(){return A;};return a();}var __importDefault=this&&this['__importDefault']||function(c){const t=b;return c&&c[t(0x7b)]?c:{'default':c};};Object[u(0x99)](exports,v(0x7b),{'value':!![]});const sequelize_1=require(v(0x7a)),Message_1=__importDefault(require(u(0x8c))),logger_1=require(u(0x73)),wbot_baileys_1=require(v(0xab)),path_1=require(u(0x7c)),SendMessagesSystemWbotBaileys_1=require(v(0x87)),sleepRandomTime_1=require(u(0x92)),Ticket_1=__importDefault(require(u(0x79))),SendMessagesSchenduleWbot=async()=>{const w=v,x=u,c={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':w(0x72)},d=await Message_1[x(0x76)]['findAll']({'where':c,'include':[{'model':Ticket_1[w(0x76)],'as':x(0x9d),'where':{[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:x(0x90)},'isFarewellMessage':!![]},'channel':x(0xa1)},'include':['contact']}],'order':[[w(0xaa),x(0x77)]]});let e;d[x(0x7e)](async f=>{const y=x,z=x;if(f[y(0xa6)]&&f[z(0xa6)][z(0x7d)]()<=new Date()[y(0x7d)]()){logger_1[y(0x89)][y(0x75)](y(0x78)+f['id']+y(0x9c)+f['tenantId']);const g=(0x0,wbot_baileys_1[z(0x8b)])(f[z(0x9d)][z(0x94)]),h=f[z(0x9d)]['contact'][z(0x8e)],i=f['ticket']['isGroup']?'g.us':'s.whatsapp.net',j=h+'@'+i;try{if(f[y(0xac)]!==y(0x91)&&f['mediaName']){const l=(0x0,path_1[z(0xa9)])(__dirname,'..','..','..',z(0xa3)),m=(0x0,path_1['join'])(l,f[y(0x85)]),n=await(0x0,SendMessagesSystemWbotBaileys_1[y(0x86)])(f[y(0x85)],m);n&&(e=await g[z(0x93)](j,{...n})),logger_1[z(0x89)][y(0x75)]('sendMessage\x20media\x20Schendule');}else e=await g[y(0x93)](j,{'text':f[z(0x8d)]}),logger_1[z(0x89)][y(0x75)](z(0x8f));const k={'messageId':e['key']['id'],'status':'sended'};await Message_1['default'][y(0x84)]({...k},{'where':{'id':f['id']}}),logger_1[z(0x89)][z(0x75)](y(0x81)),await(0x0,sleepRandomTime_1['sleepRandomTime'])({'minMilliseconds':Number(process[z(0xa2)][y(0x98)]||0x1f4),'maxMilliseconds':Number(process[y(0xa2)][y(0xa0)]||0x7d0)}),logger_1[y(0x89)][y(0x75)](y(0x74));}catch(o){const p=f['id'],q=f[y(0x83)];o[y(0x9a)]===z(0x82)&&await Message_1['default'][y(0x95)]({'where':{'id':f['id']}}),logger_1[y(0x89)][y(0x9f)]('Error\x20message\x20is\x20(tenant:\x20'+f['tenantId']+z(0x9b)+q+')'),logger_1[y(0x89)][z(0x9f)]('Error\x20send\x20message\x20(id:\x20'+p+y(0xad)+o);}}});};exports[u(0x76)]=SendMessagesSchenduleWbot;