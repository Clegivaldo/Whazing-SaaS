'use strict';const u=b,v=b;function a(){const A=['defineProperty','1302088ipkhXI','destroy','logger','647383qBVYHq','2980124adRpxq','130bJJZKa','__esModule','whatsapp','sendMessage','getMessageOptions','4822194eKbLBg','Error\x20send\x20message\x20(id:\x20','path','tenantId','getWbot','mediaType','ticket','../../utils/sleepRandomTime','whatsappId','error','sendMessage\x20Schendule','1653324AuSokF','findAll','mediaName','../../libs/wbot-baileys','s.whatsapp.net','contact','body','env','Error\x20message\x20is\x20(tenant:\x20',')::','getTime','Message\x20Update\x20Schendule','forEach','MIN_SLEEP_INTERVAL','number','ENOENT','5KTuGYv','9skZGDt','960672iJRQUJ','createdAt','12JfETQt','default','code','info','scheduleDate','sequelize','22627vQAxqe','sended','Message\x20Schendule\x20Queue:\x20','join','closed'];a=function(){return A;};return a();}(function(c,d){const r=b,s=b,e=c();while(!![]){try{const f=parseInt(r(0x158))/0x1+parseInt(r(0x16a))/0x2+-parseInt(r(0x17c))/0x3*(parseInt(s(0x17e))/0x4)+parseInt(s(0x17a))/0x5*(parseInt(s(0x15f))/0x6)+-parseInt(s(0x159))/0x7+-parseInt(r(0x155))/0x8*(parseInt(s(0x17b))/0x9)+parseInt(r(0x15a))/0xa*(parseInt(r(0x14f))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xb8678));var __importDefault=this&&this['__importDefault']||function(c){const t=b;return c&&c[t(0x15b)]?c:{'default':c};};Object[u(0x154)](exports,u(0x15b),{'value':!![]});function b(c,d){const e=a();return b=function(f,g){f=f-0x14d;let h=e[f];return h;},b(c,d);}const sequelize_1=require(u(0x14e)),Message_1=__importDefault(require('../../models/Message')),logger_1=require('../../utils/logger'),wbot_baileys_1=require(u(0x16d)),path_1=require(v(0x161)),SendMessagesSystemWbotBaileys_1=require('./SendMessagesSystemWbotBaileys'),sleepRandomTime_1=require(v(0x166)),Ticket_1=__importDefault(require('../../models/Ticket')),SendMessagesSchenduleWbot=async()=>{const w=v,x=v,c={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':'pending'},d=await Message_1[w(0x17f)][w(0x16b)]({'where':c,'include':[{'model':Ticket_1[w(0x17f)],'as':x(0x165),'where':{[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:w(0x153)},'isFarewellMessage':!![]},'channel':x(0x15c)},'include':[w(0x16f)]}],'order':[[w(0x17d),'ASC']]});let e;d[x(0x176)](async f=>{const y=x,z=x;if(f['scheduleDate']&&f[y(0x14d)][z(0x174)]()<=new Date()[y(0x174)]()){logger_1[z(0x157)][z(0x181)](y(0x151)+f['id']+'\x20|\x20Tenant:\x20'+f[y(0x162)]);const g=(0x0,wbot_baileys_1[y(0x163)])(f[z(0x165)][y(0x167)]),h=f[y(0x165)][z(0x16f)][z(0x178)],i=f[z(0x165)]['isGroup']?'g.us':z(0x16e),j=h+'@'+i;try{if(f[z(0x164)]!=='chat'&&f['mediaName']){const l=(0x0,path_1[z(0x152)])(__dirname,'..','..','..','public'),m=(0x0,path_1['join'])(l,f['mediaName']),n=await(0x0,SendMessagesSystemWbotBaileys_1[y(0x15e)])(f[y(0x16c)],m);n&&(e=await g[y(0x15d)](j,{...n})),logger_1['logger'][y(0x181)]('sendMessage\x20media\x20Schendule');}else e=await g[y(0x15d)](j,{'text':f[y(0x170)]}),logger_1[z(0x157)][z(0x181)]('sendMessage\x20text\x20Schendule');const k={'messageId':e['key']['id'],'status':z(0x150)};await Message_1[y(0x17f)]['update']({...k},{'where':{'id':f['id']}}),logger_1[y(0x157)][y(0x181)](z(0x175)),await(0x0,sleepRandomTime_1['sleepRandomTime'])({'minMilliseconds':Number(process[y(0x171)][z(0x177)]||0x1f4),'maxMilliseconds':Number(process[z(0x171)]['MAX_SLEEP_INTERVAL']||0x7d0)}),logger_1[y(0x157)]['info'](y(0x169));}catch(o){const p=f['id'],q=f['ticketId'];o[y(0x180)]===y(0x179)&&await Message_1[z(0x17f)][y(0x156)]({'where':{'id':f['id']}}),logger_1[z(0x157)]['error'](y(0x172)+f[z(0x162)]+'\x20|\x20Ticket:\x20'+q+')'),logger_1[z(0x157)][y(0x168)](y(0x160)+p+z(0x173)+o);}}});};exports[u(0x17f)]=SendMessagesSchenduleWbot;