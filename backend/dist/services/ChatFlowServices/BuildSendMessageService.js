'use strict';
function _0x4d5c() {
    const _0x3862a2 = [
        'substr',
        'essageServ',
        'ERR_CREATI',
        '56xYkZrz',
        'update',
        'pending',
        'ers/socket',
        'mediaUrl',
        'NG_MESSAGE',
        'bot',
        'message',
        'contact',
        '403404yCxCBD',
        'ZDMry',
        'chat:creat',
        '783BmiiqF',
        'create',
        'name',
        'include',
        'split',
        'chat',
        '335990HWouuP',
        '../../mode',
        'model',
        '462666snqgEO',
        'BuildSendM',
        'wgOmX',
        'error',
        'default',
        'getTime',
        'where',
        'RWNvC',
        '3279255OQIFCI',
        'drszL',
        'MediaField',
        'logger',
        'ice',
        '1408160WJfnRm',
        '677655qOMKYN',
        'defineProp',
        '_SYSTEM',
        'erty',
        'idation',
        'ticket',
        '1074906ImpQnC',
        'length',
        '../../help',
        'yyyuc',
        '4HySdZG',
        's/logger',
        '../../util',
        'body',
        '__esModule',
        'xCBhu',
        'pupa',
        'JRhzo',
        '__importDe',
        's/queueVal',
        'protocol',
        'quotedMsg',
        'contactId',
        'zozOs',
        'ls/Message',
        'type',
        'jumhn',
        'jSfXj',
        'Emit',
        'fault',
        'agplx',
        'data',
        's/pupa',
        'payload',
        'value',
        'tenantId',
        'findByPk',
        'EzJRo',
        'mediaType',
        'indexOf',
        'ls/Ticket',
        'whatsappId'
    ];
    _0x4d5c = function () {
        return _0x3862a2;
    };
    return _0x4d5c();
}
const _0x34e601 = _0x5cc6;
(function (_0x5704ed, _0x18eb21) {
    const _0x44170e = _0x5cc6, _0x30f139 = _0x5704ed();
    while (!![]) {
        try {
            const _0x1717bb = -parseInt(_0x44170e(0x217)) / (0xd6d * -0x1 + 0x1 * -0x122b + 0x1f99) + -parseInt(_0x44170e(0x21d)) / (0x1454 + 0x1377 + -0x27c9) + parseInt(_0x44170e(0x209)) / (0x1b0d + -0x83e + -0x12cc) + -parseInt(_0x44170e(0x221)) / (0x1 * 0xad6 + 0x1988 + -0x245a) * (parseInt(_0x44170e(0x211)) / (0x3a2 + -0x1 * 0x1f93 + -0x4a9 * -0x6)) + parseInt(_0x44170e(0x1fd)) / (0x162 * -0x6 + 0x909 + -0xb7) * (-parseInt(_0x44170e(0x1f4)) / (-0x10b1 + -0x492 * -0x6 + -0xab4)) + -parseInt(_0x44170e(0x216)) / (-0x22e1 * 0x1 + -0x1a * -0x15c + -0x6f) + -parseInt(_0x44170e(0x200)) / (0x1100 + 0x1e6d + -0x2f64) * (-parseInt(_0x44170e(0x206)) / (-0x4f2 * -0x3 + 0x5d4 + -0x14a0));
            if (_0x1717bb === _0x18eb21)
                break;
            else
                _0x30f139['push'](_0x30f139['shift']());
        } catch (_0x3f1460) {
            _0x30f139['push'](_0x30f139['shift']());
        }
    }
}(_0x4d5c, -0x35d8d * 0x1 + -0xa805b + 0x4 * 0x5586b));
var __importDefault = this && this[_0x34e601(0x229) + _0x34e601(0x1e4)] || function (_0x24f0d6) {
    const _0x4cc479 = _0x34e601;
    return _0x24f0d6 && _0x24f0d6[_0x4cc479(0x225)] ? _0x24f0d6 : { 'default': _0x24f0d6 };
};
const _0x3c79f7 = {};
function _0x5cc6(_0x3b18c9, _0x548691) {
    const _0x4bcbd5 = _0x4d5c();
    return _0x5cc6 = function (_0x194a8a, _0x1e0dba) {
        _0x194a8a = _0x194a8a - (0x2411 * -0x1 + 0x2623 + -0x3 * 0x11);
        let _0x3b059d = _0x4bcbd5[_0x194a8a];
        return _0x3b059d;
    }, _0x5cc6(_0x3b18c9, _0x548691);
}
_0x3c79f7[_0x34e601(0x1e9)] = !![], Object[_0x34e601(0x218) + _0x34e601(0x21a)](exports, _0x34e601(0x225), _0x3c79f7);
const pupa_1 = require(_0x34e601(0x223) + _0x34e601(0x1e7)), logger_1 = require(_0x34e601(0x223) + _0x34e601(0x222)), Ticket_1 = __importDefault(require(_0x34e601(0x207) + _0x34e601(0x1ef))), Message_1 = __importDefault(require(_0x34e601(0x207) + _0x34e601(0x1df))), socketEmit_1 = __importDefault(require(_0x34e601(0x21f) + _0x34e601(0x1f7) + _0x34e601(0x1e3))), queueValidation_1 = __importDefault(require(_0x34e601(0x223) + _0x34e601(0x22a) + _0x34e601(0x21b))), BuildSendMessageService = async ({
        msg: _0x19d493,
        tenantId: _0x10ba24,
        ticket: _0x29f40e,
        userId: _0x44128b
    }) => {
        const _0x99ec0a = _0x34e601, _0x549da6 = {};
        _0x549da6[_0x99ec0a(0x226)] = _0x99ec0a(0x205), _0x549da6[_0x99ec0a(0x1e5)] = _0x99ec0a(0x1fa), _0x549da6[_0x99ec0a(0x1e1)] = _0x99ec0a(0x1f6), _0x549da6[_0x99ec0a(0x1ec)] = function (_0x420f36, _0x58d9bf) {
            return _0x420f36 === _0x58d9bf;
        }, _0x549da6[_0x99ec0a(0x1e2)] = _0x99ec0a(0x213), _0x549da6[_0x99ec0a(0x210)] = function (_0x3ad06a, _0x17bf44) {
            return _0x3ad06a - _0x17bf44;
        }, _0x549da6[_0x99ec0a(0x228)] = _0x99ec0a(0x21c), _0x549da6[_0x99ec0a(0x1fe)] = _0x99ec0a(0x1fc), _0x549da6[_0x99ec0a(0x20b)] = _0x99ec0a(0x22c), _0x549da6[_0x99ec0a(0x22e)] = _0x99ec0a(0x1f3) + _0x99ec0a(0x1f9) + _0x99ec0a(0x219), _0x549da6[_0x99ec0a(0x220)] = _0x99ec0a(0x1ff) + 'e', _0x549da6[_0x99ec0a(0x212)] = _0x99ec0a(0x20a) + _0x99ec0a(0x1f2) + _0x99ec0a(0x215);
        const _0x1f4f55 = _0x549da6, _0x22eb3f = {
                'ticketId': _0x29f40e['id'],
                'body': '',
                'contactId': _0x29f40e[_0x99ec0a(0x22d)],
                'fromMe': !![],
                'read': !![],
                'mediaType': _0x1f4f55[_0x99ec0a(0x226)],
                'mediaUrl': undefined,
                'timestamp': new Date()[_0x99ec0a(0x20e)](),
                'quotedMsgId': undefined,
                'userId': _0x44128b,
                'scheduleDate': undefined,
                'sendType': _0x1f4f55[_0x99ec0a(0x1e5)],
                'status': _0x1f4f55[_0x99ec0a(0x1e1)],
                'tenantId': _0x10ba24
            };
        try {
            if (_0x1f4f55[_0x99ec0a(0x1ec)](_0x19d493[_0x99ec0a(0x1e0)], _0x1f4f55[_0x99ec0a(0x1e2)]) && _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1f8)]) {
                const _0x225861 = _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1f8)][_0x99ec0a(0x204)]('/'), _0x2dba43 = {
                        ..._0x22eb3f,
                        'body': _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x202)],
                        'mediaUrl': _0x225861[_0x1f4f55[_0x99ec0a(0x210)](_0x225861[_0x99ec0a(0x21e)], 0x206 + 0x157d + -0x3b * 0x66)],
                        'mediaType': _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1e0)] ? _0x19d493[_0x99ec0a(0x1e6)]?.[_0x99ec0a(0x1e0)][_0x99ec0a(0x1f1)](0x2120 + -0x21eb + 0xcb, _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1e0)][_0x99ec0a(0x1ee)]('/')) : _0x1f4f55[_0x99ec0a(0x226)]
                    }, _0x27ffa8 = await Message_1[_0x99ec0a(0x20d)][_0x99ec0a(0x201)](_0x2dba43), _0x46ebae = {};
                _0x46ebae[_0x99ec0a(0x1ea)] = _0x10ba24;
                const _0x3d298c = {};
                _0x3d298c[_0x99ec0a(0x208)] = Ticket_1[_0x99ec0a(0x20d)], _0x3d298c['as'] = _0x1f4f55[_0x99ec0a(0x228)], _0x3d298c[_0x99ec0a(0x20f)] = _0x46ebae, _0x3d298c[_0x99ec0a(0x203)] = [_0x1f4f55[_0x99ec0a(0x1fe)]];
                const _0x1b6f7d = await Message_1[_0x99ec0a(0x20d)][_0x99ec0a(0x1eb)](_0x27ffa8['id'], {
                    'include': [
                        _0x3d298c,
                        {
                            'model': Message_1[_0x99ec0a(0x20d)],
                            'as': _0x1f4f55[_0x99ec0a(0x20b)],
                            'include': [_0x1f4f55[_0x99ec0a(0x1fe)]]
                        }
                    ]
                });
                if (!_0x1b6f7d)
                    throw new Error(_0x1f4f55[_0x99ec0a(0x22e)]);
                await _0x29f40e[_0x99ec0a(0x1f5)]({
                    'lastMessage': _0x1b6f7d[_0x99ec0a(0x224)],
                    'lastMessageAt': new Date()[_0x99ec0a(0x20e)]()
                }), await (-0x1399 + -0x8 * -0x4ce + -0x12d7, queueValidation_1[_0x99ec0a(0x20d)])(_0x29f40e[_0x99ec0a(0x1f0)], _0x29f40e[_0x99ec0a(0x1ea)], [_0x1b6f7d]);
                const _0x2928e3 = {};
                _0x2928e3[_0x99ec0a(0x1ea)] = _0x10ba24, _0x2928e3[_0x99ec0a(0x1e0)] = _0x1f4f55[_0x99ec0a(0x220)], _0x2928e3[_0x99ec0a(0x1e8)] = _0x1b6f7d, (-0x1274 + -0x1db * 0x1 + 0x144f, socketEmit_1[_0x99ec0a(0x20d)])(_0x2928e3);
            } else {
                const _0x95fd78 = {};
                _0x95fd78[_0x99ec0a(0x22b)] = _0x29f40e[_0x99ec0a(0x22b)], _0x95fd78[_0x99ec0a(0x202)] = _0x29f40e[_0x99ec0a(0x1fc)][_0x99ec0a(0x202)], _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1fb)] = (-0x981 * 0x4 + 0x4b * -0x59 + 0x9 * 0x71f, pupa_1[_0x99ec0a(0x227)])(_0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1fb)] || '', _0x95fd78);
                const _0x1de852 = { ..._0x22eb3f };
                _0x1de852[_0x99ec0a(0x224)] = _0x19d493[_0x99ec0a(0x1e6)][_0x99ec0a(0x1fb)], _0x1de852[_0x99ec0a(0x1ed)] = _0x1f4f55[_0x99ec0a(0x226)];
                const _0x1131fb = await Message_1[_0x99ec0a(0x20d)][_0x99ec0a(0x201)](_0x1de852), _0x3f7796 = {};
                _0x3f7796[_0x99ec0a(0x1ea)] = _0x10ba24;
                const _0x54c581 = {};
                _0x54c581[_0x99ec0a(0x208)] = Ticket_1[_0x99ec0a(0x20d)], _0x54c581['as'] = _0x1f4f55[_0x99ec0a(0x228)], _0x54c581[_0x99ec0a(0x20f)] = _0x3f7796, _0x54c581[_0x99ec0a(0x203)] = [_0x1f4f55[_0x99ec0a(0x1fe)]];
                const _0x334a25 = await Message_1[_0x99ec0a(0x20d)][_0x99ec0a(0x1eb)](_0x1131fb['id'], {
                    'include': [
                        _0x54c581,
                        {
                            'model': Message_1[_0x99ec0a(0x20d)],
                            'as': _0x1f4f55[_0x99ec0a(0x20b)],
                            'include': [_0x1f4f55[_0x99ec0a(0x1fe)]]
                        }
                    ]
                });
                if (!_0x334a25)
                    throw new Error(_0x1f4f55[_0x99ec0a(0x22e)]);
                await _0x29f40e[_0x99ec0a(0x1f5)]({
                    'lastMessage': _0x334a25[_0x99ec0a(0x224)],
                    'lastMessageAt': new Date()[_0x99ec0a(0x20e)](),
                    'answered': !![]
                }), await (0x1c * -0xb7 + -0xaa6 * 0x2 + 0x2950, queueValidation_1[_0x99ec0a(0x20d)])(_0x29f40e[_0x99ec0a(0x1f0)], _0x29f40e[_0x99ec0a(0x1ea)], [_0x334a25]);
                const _0xf99dce = {};
                _0xf99dce[_0x99ec0a(0x1ea)] = _0x10ba24, _0xf99dce[_0x99ec0a(0x1e0)] = _0x1f4f55[_0x99ec0a(0x220)], _0xf99dce[_0x99ec0a(0x1e8)] = _0x334a25, (0xc67 + 0x2 * -0xe05 + 0xfa3, socketEmit_1[_0x99ec0a(0x20d)])(_0xf99dce);
            }
        } catch (_0x2a2618) {
            logger_1[_0x99ec0a(0x214)][_0x99ec0a(0x20c)](_0x1f4f55[_0x99ec0a(0x212)], _0x2a2618);
        }
    };
exports[_0x34e601(0x20d)] = BuildSendMessageService;