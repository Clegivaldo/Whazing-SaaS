'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x1bb;let h=e[f];return h;},b(c,d);}function a(){const w=['defineProperty','22CKPJRE','update','writeFile','ERR_NO_CHAT_FLOW_FOUND','__esModule','split','getTime','40pjkEWm','media','356133XBQBHv','reload','base64','6922134BdgHAd','type','3305512ypNnpq','__importDefault','data','isActive','flow','mediaUrl','name','node','MediaField','1395220yGoMhV','2682672RdcAYK','8981000DhgPqu','205359OzTjEY','public','util','default','join','celularTeste','userId'];a=function(){return w;};return a();}const r=b,t=b;(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=parseInt(p(0x1cd))/0x1+parseInt(p(0x1d5))/0x2*(-parseInt(q(0x1bc))/0x3)+-parseInt(q(0x1c1))/0x4+-parseInt(q(0x1ca))/0x5+parseInt(p(0x1cb))/0x6+-parseInt(q(0x1cc))/0x7+parseInt(q(0x1dc))/0x8*(parseInt(q(0x1bf))/0x9);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xc4412));var __importDefault=this&&this[r(0x1c2)]||function(c){const s=r;return c&&c[s(0x1d9)]?c:{'default':c};};Object[t(0x1d4)](exports,r(0x1d9),{'value':!![]});const util_1=require(t(0x1cf)),path_1=require('path'),fs_1=require('fs'),ChatFlow_1=__importDefault(require('../../models/ChatFlow')),AppError_1=__importDefault(require('../../errors/AppError')),writeFileAsync=(0x0,util_1['promisify'])(fs_1[t(0x1d7)]),UpdateChatFlowService=async({chatFlowData:c,chatFlowId:d,tenantId:e})=>{const u=r,v=t,{name:f,flow:g,userId:h,isActive:i,celularTeste:j}=c,k=await ChatFlow_1['default']['findOne']({'where':{'id':d,'tenantId':e},'attributes':['id',u(0x1c7),u(0x1c5),v(0x1d3),v(0x1c4),u(0x1d2)]});if(!k)throw new AppError_1[(v(0x1d0))](u(0x1d8),0x194);for await(const l of g[u(0x1c5)]['nodeList']){if(l[u(0x1c0)]===v(0x1c8))for await(const m of l['interactions']){if(m['type']===u(0x1c9)&&m['data'][v(0x1bb)]){const n=new Date()[v(0x1db)]()+'-'+m['data'][v(0x1c7)];await writeFileAsync((0x0,path_1[u(0x1d1)])(__dirname,'..','..','..',v(0x1ce),n),m[v(0x1c3)][u(0x1bb)]['split']('base64')[0x1],u(0x1be)),delete m['data'][u(0x1bb)],m[v(0x1c3)]['mediaUrl']=n;}if(m[v(0x1c0)]===u(0x1c9)&&m[v(0x1c3)][v(0x1c6)]){const o=m[v(0x1c3)]['mediaUrl'][u(0x1da)]('/');m['data'][v(0x1c6)]=o[o['length']-0x1];}}}return await k[v(0x1d6)]({'name':f,'flow':g[u(0x1c5)],'userId':h,'isActive':g['isActive'],'celularTeste':g['celularTeste']}),await k[u(0x1bd)]({'attributes':['id',u(0x1c7),u(0x1c5),v(0x1d3),'isActive',v(0x1d2)]}),k;};exports[r(0x1d0)]=UpdateChatFlowService;