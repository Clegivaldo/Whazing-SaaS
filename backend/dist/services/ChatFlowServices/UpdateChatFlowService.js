'use strict';const r=b,t=b;(function(c,d){const p=b,q=b,e=c();while(!![]){try{const f=parseInt(p(0x10d))/0x1+parseInt(q(0xf4))/0x2*(parseInt(q(0x107))/0x3)+parseInt(p(0x110))/0x4+parseInt(q(0xff))/0x5*(-parseInt(q(0xf1))/0x6)+-parseInt(q(0xf9))/0x7+parseInt(q(0xfd))/0x8+-parseInt(p(0xf0))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x3e957));function b(c,d){const e=a();return b=function(f,g){f=f-0xed;let h=e[f];return h;},b(c,d);}function a(){const w=['12LjWbrs','split','findOne','userId','ERR_NO_CHAT_FLOW_FOUND','1403486KlLYbj','__importDefault','type','flow','3975384tWprDm','node','965xzKpQa','path','getTime','length','isActive','mediaUrl','promisify','nodeList','77466pMlAnf','base64','default','MediaField','celularTeste','update','335806VoAIfn','writeFile','media','1194376vhzWxG','name','data','defineProperty','public','reload','5701671bvTbUt','6090QKRaEY','join','__esModule'];a=function(){return w;};return a();}var __importDefault=this&&this[r(0xfa)]||function(c){const s=r;return c&&c[s(0xf3)]?c:{'default':c};};Object[r(0xed)](exports,'__esModule',{'value':!![]});const util_1=require('util'),path_1=require(t(0x100)),fs_1=require('fs'),ChatFlow_1=__importDefault(require('../../models/ChatFlow')),AppError_1=__importDefault(require('../../errors/AppError')),writeFileAsync=(0x0,util_1[r(0x105)])(fs_1[r(0x10e)]),UpdateChatFlowService=async({chatFlowData:c,chatFlowId:d,tenantId:e})=>{const u=r,v=r,{name:f,flow:g,userId:h,isActive:i,celularTeste:j}=c,k=await ChatFlow_1[u(0x109)][v(0xf6)]({'where':{'id':d,'tenantId':e},'attributes':['id',v(0x111),u(0xfc),v(0xf7),u(0x103),u(0x10b)]});if(!k)throw new AppError_1[(v(0x109))](u(0xf8),0x194);for await(const l of g[u(0xfc)][u(0x106)]){if(l[v(0xfb)]===v(0xfe))for await(const m of l['interactions']){if(m['type']===v(0x10a)&&m[v(0x112)][u(0x10f)]){const n=new Date()[v(0x101)]()+'-'+m['data'][u(0x111)];await writeFileAsync((0x0,path_1[v(0xf2)])(__dirname,'..','..','..',u(0xee),n),m['data']['media']['split'](v(0x108))[0x1],v(0x108)),delete m[v(0x112)][v(0x10f)],m[u(0x112)][u(0x104)]=n;}if(m[v(0xfb)]===u(0x10a)&&m['data'][u(0x104)]){const o=m['data']['mediaUrl'][u(0xf5)]('/');m['data'][v(0x104)]=o[o[u(0x102)]-0x1];}}}return await k[u(0x10c)]({'name':f,'flow':g[u(0xfc)],'userId':h,'isActive':g['isActive'],'celularTeste':g[u(0x10b)]}),await k[u(0xef)]({'attributes':['id',v(0x111),v(0xfc),v(0xf7),u(0x103),u(0x10b)]}),k;};exports[t(0x109)]=UpdateChatFlowService;