'use strict';
const P = b, Q = b;
(function (c, d) {
    const N = b, O = b, e = c();
    while (!![]) {
        try {
            const f = -parseInt(N(0x1f6)) / (0x1 * -0x1c40 + -0x2461 + 0x40a2) * (-parseInt(N(0x214)) / (0x344 + 0xb45 * 0x1 + 0x1 * -0xe87)) + -parseInt(N(0x20a)) / (0x305 + 0x4ac + -0x1 * 0x7ae) + -parseInt(N(0x1c2)) / (0x2d1 * 0x3 + -0x1157 + 0x8e8) + -parseInt(O(0x1fa)) / (-0x87b * -0x1 + -0x15 * 0x103 + 0xcc9) + parseInt(N(0x1a0)) / (-0x1b76 + -0x1e1d + 0x3999) * (parseInt(N(0x1c9)) / (0x12d3 * -0x1 + -0x55d * -0x7 + -0x5 * 0x3bd)) + parseInt(N(0x1d1)) / (0xfed + 0x406 * 0x6 + 0x1 * -0x2809) * (-parseInt(O(0x215)) / (-0x507 + 0x13 * 0x1d2 + -0x1d86 * 0x1)) + parseInt(N(0x1b1)) / (-0x253f + 0xecf + 0x167a) * (parseInt(O(0x219)) / (0x2 * 0x6e8 + 0x160f * -0x1 + 0x84a));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, -0x26931 * -0x4 + 0x13 * -0x140cb + -0x1c28a3 * -0x1));
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (0x1 * -0x2239 + -0x4d9 * 0x5 + 0x3bd8);
        let h = e[f];
        return h;
    }, b(c, d);
}
function a() {
    const ac = [
        '__esModule',
        'zSvRu',
        'contactId',
        'public',
        'LuSmf',
        'iOeiv',
        'finish',
        'chat',
        'quotedMsg',
        'payload',
        'erty',
        'nuTmi',
        'indexOf',
        'LrRmX',
        'mediaType',
        'type',
        'Status',
        '__importDe',
        'rqedo',
        'authToken',
        'findByPk',
        'xpaRl',
        '_SYSTEM',
        'update',
        'hJMWw',
        'mwqxy',
        'logger',
        'daIjV',
        'hookMessag',
        'NNWEa',
        'zCZks',
        'GGxBf',
        'JlyRI',
        'sCNqO',
        'status',
        'xFVEf',
        'TWLHf',
        'gnLHI',
        '7416qRTseu',
        'filename',
        'extension',
        'scheduleDa',
        'createWrit',
        'QiOJo',
        'substr',
        'fWMOB',
        'vZsBl',
        'ls/Message',
        'urlMessage',
        'model',
        'hScBX',
        'rNAdG',
        'error',
        'JCyeu',
        'eStatus',
        '27550lXWvBY',
        'NnNGH',
        'body',
        'DClfS',
        'AAthQ',
        'add',
        'WebHooksAP',
        'REmcw',
        'media',
        'name',
        'ERR_CREATI',
        'ePGwc',
        'IwrLX',
        'fvHpB',
        'ers/socket',
        'gviTq',
        'value',
        '658420HINGkZ',
        'defineProp',
        '/Queue',
        'JoXoR',
        'chat:creat',
        'LOAD',
        'DVnhJ',
        '49ZnNCrD',
        's/queueVal',
        'bVVBJ',
        'message',
        'url',
        'create',
        'mimetype',
        'externalKe',
        '40pYOMvU',
        'content-ty',
        'OJofO',
        'response',
        'tGwIP',
        'NG_MESSAGE',
        'join',
        'WuBCy',
        'whatsappId',
        'mediaUrl',
        'rnvmZ',
        'getTime',
        'responseTy',
        'push',
        'kHBeb',
        'NBGri',
        'aUUyQ',
        'where',
        'ack',
        'iFuIc',
        'EEHPk',
        'rmdirSync',
        'FDIed',
        'pipe',
        'hxAtn',
        'gKbdg',
        'CrkWX',
        's/logger',
        'API',
        'gZWuU',
        'LAxKo',
        'recursive',
        'pupa',
        'path',
        'NGYUe',
        'ervice',
        'number',
        '19192iVqyCG',
        'stream',
        'tenantId',
        'bTBgt',
        '3746240SvcgpA',
        'headers',
        'ykBei',
        'ScgSr',
        '../../help',
        'MYfaG',
        'xDEQx',
        'fromMe',
        'LXaVC',
        'get',
        'ERROR\x20DONW',
        'hzlfo',
        'OImdq',
        'AnCgx',
        '../../libs',
        'split',
        '1967418CfEHwH',
        'default',
        'axios',
        'rWllr',
        'acCoq',
        'mime',
        '../../util',
        'data',
        's/pupa',
        '../../mode',
        '110bIJVjm',
        '186741TIVONM',
        'protocol',
        'Emit',
        'idation',
        '6094aeCYtB',
        'EYRil',
        'zTgCn',
        'ls/Ticket',
        'all',
        'originalna',
        'yvgUG',
        'include',
        'XXvjb',
        'CWUoa',
        'contact',
        'unCbJ',
        'map',
        'AXuDD',
        'messageId',
        'CreateMess',
        'ageSystemS',
        'fault',
        'kUuBc',
        'ticket',
        'mmKiF',
        'uuid',
        'apiConfig',
        'zRdod',
        'mRqqx',
        'PWfgi',
        'eStream'
    ];
    a = function () {
        return ac;
    };
    return a();
}
var __importDefault = this && this[P(0x18b) + Q(0x170)] || function (c) {
    const R = Q;
    return c && c[R(0x17a)] ? c : { 'default': c };
};
const J = {};
J[P(0x1c1)] = !![], Object[P(0x1c3) + P(0x184)](exports, P(0x17a), J);
const fs_1 = __importDefault(require('fs')), path_1 = require(Q(0x1f2)), axios_1 = __importDefault(require(P(0x20c))), mime_1 = __importDefault(require(P(0x20f))), uuid_1 = require(P(0x174)), logger_1 = require(P(0x210) + P(0x1ec)), Ticket_1 = __importDefault(require(P(0x213) + P(0x162))), Message_1 = __importDefault(require(P(0x213) + P(0x1a9))), socketEmit_1 = __importDefault(require(Q(0x1fe) + Q(0x1bf) + P(0x217))), Queue_1 = __importDefault(require(P(0x208) + Q(0x1c4))), pupa_1 = require(P(0x210) + P(0x212)), queueValidation_1 = __importDefault(require(P(0x210) + Q(0x1ca) + P(0x218))), downloadMedia = async g => {
        const S = Q, T = P, h = {
                'gKbdg': function (i, j) {
                    return i(j);
                },
                'ePGwc': S(0x1bb) + T(0x1d6) + T(0x190),
                'hzlfo': function (i, j) {
                    return i === j;
                },
                'xDEQx': T(0x196) + S(0x1b0),
                'CrkWX': S(0x1b7) + 'I',
                'sCNqO': S(0x1b2),
                'EEHPk': T(0x1df),
                'LrRmX': T(0x204) + T(0x1c7),
                'nuTmi': function (i, j) {
                    return i !== j;
                },
                'REmcw': T(0x16a),
                'bTBgt': T(0x180),
                'PWfgi': T(0x1ae),
                'mmKiF': T(0x1f7),
                'NBGri': T(0x1d2) + 'pe',
                'OJofO': S(0x17d),
                'CWUoa': function (i, j) {
                    return i === j;
                },
                'daIjV': T(0x198)
            };
        try {
            const i = {};
            i[S(0x1dd) + 'pe'] = h[S(0x173)];
            const j = await axios_1[T(0x20b)][S(0x203)](g[T(0x1da)], i), k = j[S(0x1fb)][h[T(0x1e0)]], l = mime_1[S(0x20b)], m = l[T(0x1a2)](k), n = (-0x1 * 0x7ff + -0x2295 + 0x2a94, uuid_1['v4'])(), o = (-0x1cd6 + -0x1658 + 0x332e, path_1[T(0x1d7)])(__dirname, '..', '..', '..', h[T(0x1d3)]), p = n + '.' + m, q = (-0x2 * -0x10a5 + 0x148d * -0x1 + -0xcbd, path_1[S(0x1d7)])(o, p), r = {};
            r[T(0x164) + 'me'] = p, r[T(0x1a1)] = p, r[T(0x188)] = m;
            const s = r;
            return await new Promise((t, u) => {
                const U = S, W = S, v = {
                        'TWLHf': h[U(0x1bc)],
                        'DClfS': function (w, z) {
                            const V = U;
                            return h[V(0x205)](w, z);
                        },
                        'JCyeu': h[U(0x200)],
                        'rNAdG': h[U(0x1eb)],
                        'gZWuU': function (w, z) {
                            const X = W;
                            return h[X(0x205)](w, z);
                        },
                        'mRqqx': h[U(0x19b)],
                        'NNWEa': h[W(0x1e5)],
                        'rqedo': h[U(0x187)],
                        'WuBCy': function (w, x) {
                            const Y = U;
                            return h[Y(0x1ea)](w, x);
                        }
                    };
                if (h[W(0x185)](h[U(0x1b8)], h[U(0x1b8)]))
                    throw new r(v[U(0x19e)]);
                else
                    j[W(0x211)][U(0x1e8)](fs_1[U(0x20b)][W(0x1a4) + W(0x179)](q))['on'](h[W(0x1f9)], async () => {
                        const Z = W;
                        h[Z(0x1ea)](t, s);
                    })['on'](h[W(0x178)], x => {
                        const a1 = W, a2 = W, y = {
                                'AnCgx': function (z, A) {
                                    const a0 = b;
                                    return v[a0(0x1b4)](z, A);
                                },
                                'JoXoR': v[a1(0x1af)],
                                'zRdod': v[a2(0x1ad)]
                            };
                        if (v[a1(0x1ee)](v[a1(0x177)], v[a1(0x197)])) {
                            if (y[a1(0x207)](n[a1(0x1d4)][a1(0x19c)], 0xb22 + 0x991 + -0x131f)) {
                                const A = {};
                                A[a2(0x1e3)] = -(0x2 * 0x3c5 + 0xa13 + -0x119c), A[a2(0x1b3)] = y[a2(0x1b3)], A[a1(0x16d)] = '', A[a1(0x1f5)] = z[a1(0x1f5)], A[a1(0x1d0) + 'y'] = A[a1(0x1d0) + 'y'], A[a2(0x1ae)] = B[a2(0x1cc)], A[a2(0x18d)] = C[a1(0x175)][a1(0x18d)], A[a2(0x189)] = y[a1(0x1c5)];
                                const B = A;
                                if (D?.[a2(0x175)]?.[a2(0x1aa) + a2(0x18a)]) {
                                    const C = {};
                                    C[a2(0x1cd)] = H[a2(0x175)][a1(0x1aa) + a1(0x18a)], C[a1(0x189)] = B[a1(0x189)], C[a1(0x183)] = B, G[a1(0x20b)][a2(0x1b6)](y[a1(0x176)], C);
                                }
                                return {};
                            }
                            throw new w(x);
                        } else {
                            console[a1(0x1ae)](v[a1(0x18c)], x);
                            const A = {};
                            A[a1(0x1f0)] = !![], fs_1[a2(0x20b)][a2(0x1e6)](q, A), v[a2(0x1d8)](u, new Error(x));
                        }
                    });
            }), s;
        } catch (t) {
            if (h[T(0x205)](t[S(0x1d4)][S(0x19c)], -0x683 + -0x1ff4 + 0xc9 * 0x33)) {
                const u = {};
                u[T(0x1e3)] = -(-0x7 * -0xb9 + -0x3 * -0xb07 + -0x2623), u[S(0x1b3)] = g[T(0x1b3)], u[S(0x16d)] = '', u[T(0x1f5)] = g[S(0x1f5)], u[S(0x1d0) + 'y'] = g[S(0x1d0) + 'y'], u[T(0x1ae)] = t[T(0x1cc)], u[T(0x18d)] = g[T(0x175)][T(0x18d)], u[T(0x189)] = h[T(0x200)];
                const v = u;
                if (g?.[T(0x175)]?.[S(0x1aa) + S(0x18a)]) {
                    if (h[S(0x168)](h[T(0x195)], h[T(0x195)])) {
                        const w = {};
                        w[T(0x1cd)] = g[T(0x175)][S(0x1aa) + S(0x18a)], w[T(0x189)] = v[T(0x189)], w[T(0x183)] = v, Queue_1[S(0x20b)][S(0x1b6)](h[S(0x1eb)], w);
                    } else
                        f = [], g[T(0x1de)](h[S(0x1b9)]);
                }
                return {};
            }
            throw new Error(t);
        }
    }, CreateMessageSystemService = async ({
        msg: h,
        tenantId: i,
        medias: j,
        ticket: k,
        userId: l,
        scheduleDate: m,
        sendType: n,
        status: o,
        idFront: p
    }) => {
        const a3 = Q, a4 = P, q = {
                'NGYUe': a3(0x1b7) + 'I',
                'AAthQ': function (s, t) {
                    return s(t);
                },
                'ykBei': a4(0x180),
                'zSvRu': a3(0x1ae),
                'xFVEf': a4(0x204) + a3(0x1c7),
                'LXaVC': function (s, t) {
                    return s(t);
                },
                'bVVBJ': function (s, t) {
                    return s !== t;
                },
                'JlyRI': a3(0x1a7),
                'iFuIc': function (s, t) {
                    return s === t;
                },
                'zTgCn': a4(0x171),
                'rWllr': a3(0x1e1),
                'tGwIP': function (s, t) {
                    return s === t;
                },
                'FDIed': a4(0x192),
                'EYRil': a3(0x206),
                'vZsBl': a3(0x172),
                'QiOJo': a3(0x169),
                'IwrLX': a4(0x182),
                'fvHpB': a3(0x1bb) + a4(0x1d6) + a3(0x190),
                'MYfaG': a3(0x1c6) + 'e',
                'hxAtn': a3(0x1ed),
                'GGxBf': a3(0x181),
                'rnvmZ': function (s, t) {
                    return s !== t;
                },
                'hScBX': a4(0x1c8),
                'yvgUG': a3(0x17f),
                'ScgSr': function (s, t) {
                    return s === t;
                },
                'xpaRl': function (s, t) {
                    return s === t;
                },
                'gviTq': a4(0x16c),
                'XXvjb': a4(0x193),
                'LAxKo': a3(0x16e) + a4(0x16f) + a3(0x1f4)
            }, r = {
                'ticketId': k['id'],
                'body': h[a3(0x1b3)],
                'contactId': h?.[a4(0x201)] ? null : k[a3(0x17c)],
                'fromMe': q[a3(0x1d5)](n, q[a3(0x1e9)]) ? !![] : h?.[a4(0x201)],
                'read': !![],
                'mediaType': q[a4(0x199)],
                'mediaUrl': undefined,
                'timestamp': new Date()[a4(0x1dc)](),
                'quotedMsgId': h?.[a3(0x182)]?.['id'],
                'userId': l,
                'scheduleDate': m,
                'sendType': n,
                'status': o,
                'tenantId': i,
                'idFront': p
            };
        try {
            if (q[a3(0x1db)](q[a4(0x1ac)], q[a3(0x165)])) {
                const s = {};
                s[a3(0x216)] = k[a3(0x216)], s[a3(0x1ba)] = k[a4(0x169)][a4(0x1ba)], r[a4(0x1b3)] = (0xbd6 + 0x275 * 0x1 + -0xe4b, pupa_1[a3(0x1f1)])(h[a4(0x1b3)] || '', s);
                if (q[a4(0x1e4)](n, q[a4(0x1e9)]) && h[a4(0x1da)]) {
                    j = [];
                    const t = await q[a3(0x1b5)](downloadMedia, h);
                    j[a4(0x1de)](t);
                }
                if (q[a4(0x1fd)](n, q[a4(0x1e9)]) && !h[a3(0x1da)] && h[a4(0x1b9)]) {
                    if (q[a3(0x18f)](q[a3(0x1c0)], q[a4(0x167)])) {
                        const v = {};
                        v[a3(0x1cd)] = h[a4(0x175)][a3(0x1aa) + a4(0x18a)], v[a3(0x189)] = i[a4(0x189)], v[a4(0x183)] = j, g[a4(0x20b)][a4(0x1b6)](q[a3(0x1f3)], v);
                    } else
                        j = [], j[a3(0x1de)](h[a4(0x1b9)]);
                }
                if (j)
                    await Promise[a4(0x163)](j[a4(0x16b)](async v => {
                        const a5 = a4, a7 = a4, w = {
                                'gnLHI': q[a5(0x19d)],
                                'LuSmf': function (x, y) {
                                    const a6 = a5;
                                    return q[a6(0x202)](x, y);
                                }
                            };
                        if (q[a7(0x1cb)](q[a7(0x19a)], q[a7(0x19a)]))
                            q[a5(0x1b5)](e, f);
                        else {
                            try {
                                if (q[a7(0x1e4)](q[a5(0x21b)], q[a5(0x21b)])) {
                                    if (!v[a5(0x1a1)]) {
                                        if (q[a7(0x1e4)](q[a7(0x20d)], q[a5(0x20d)])) {
                                            const E = v[a7(0x1cf)][a7(0x209)]('/')[0x1f4 * -0x1 + -0x16bd * -0x1 + -0x14c8][a5(0x209)](';')[0x11 * -0x87 + -0x2548 + 0x2e3f];
                                            v[a5(0x1a1)] = new Date()[a7(0x1dc)]() + '.' + E;
                                        } else {
                                            const G = {};
                                            return G[a7(0x20b)] = j, g && h[a7(0x17a)] ? i : G;
                                        }
                                    }
                                } else {
                                    const H = D[a5(0x1cf)][a5(0x209)]('/')[0x2 * 0x51b + -0xd74 + 0x33f][a7(0x209)](';')[-0xd3 * 0x1 + -0xf36 + 0x5 * 0x335];
                                    g[a7(0x1a1)] = new h()[a5(0x1dc)]() + '.' + H;
                                }
                            } catch (H) {
                                if (q[a5(0x1d5)](q[a5(0x1e7)], q[a5(0x21a)])) {
                                    const K = {
                                        'acCoq': function (L, M) {
                                            const a8 = a5;
                                            return q[a8(0x1b5)](L, M);
                                        }
                                    };
                                    m[a5(0x211)][a5(0x1e8)](n[a7(0x20b)][a5(0x1a4) + a5(0x179)](o))['on'](q[a7(0x1fc)], async () => {
                                        const a9 = a7;
                                        K[a9(0x20e)](w, x);
                                    })['on'](q[a5(0x17b)], L => {
                                        const aa = a5, ab = a5;
                                        w[aa(0x1ae)](w[ab(0x19f)], L);
                                        const M = {};
                                        M[aa(0x1f0)] = !![], x[aa(0x20b)][aa(0x1e6)](y, M), w[aa(0x17e)](z, new A(L));
                                    });
                                } else
                                    logger_1[a5(0x194)][a7(0x1ae)](H);
                            }
                            const y = {
                                    ...r,
                                    'body': v[a5(0x164) + 'me'],
                                    'mediaUrl': v[a7(0x1a1)],
                                    'mediaType': v[a7(0x188)] || v[a5(0x1cf)][a7(0x1a6)](-0x16a * 0x15 + 0x22f * -0x1 + 0x1fe1 * 0x1, v[a5(0x1cf)][a5(0x186)]('/'))
                                }, z = await Message_1[a5(0x20b)][a5(0x1ce)](y), A = {};
                            A[a7(0x1f8)] = i;
                            const B = {};
                            B[a7(0x1ab)] = Ticket_1[a5(0x20b)], B['as'] = q[a7(0x1a8)], B[a5(0x1e2)] = A, B[a5(0x166)] = [q[a7(0x1a5)]];
                            const C = await Message_1[a7(0x20b)][a5(0x18e)](z['id'], {
                                'include': [
                                    B,
                                    {
                                        'model': Message_1[a5(0x20b)],
                                        'as': q[a7(0x1bd)],
                                        'include': [q[a7(0x1a5)]]
                                    }
                                ]
                            });
                            if (!C)
                                throw new Error(q[a5(0x1be)]);
                            await k[a7(0x191)]({
                                'lastMessage': C[a7(0x1b3)],
                                'lastMessageAt': new Date()[a7(0x1dc)]()
                            });
                            const D = {};
                            return D[a7(0x1f8)] = i, D[a7(0x189)] = q[a7(0x1ff)], D[a5(0x183)] = C, (0x29d + -0x4 * 0xfd + 0x31 * 0x7, socketEmit_1[a7(0x20b)])(D), !C[a7(0x1a3) + 'te'] && await (-0x22a * 0x5 + -0xb * 0x195 + 0x1c39, queueValidation_1[a7(0x20b)])(k[a5(0x1d9)], i, [C]), C;
                        }
                    }));
                else {
                    const v = { ...r };
                    v[a3(0x188)] = q[a3(0x199)];
                    const w = await Message_1[a3(0x20b)][a3(0x1ce)](v), x = {};
                    x[a3(0x1f8)] = i;
                    const y = {};
                    y[a3(0x1ab)] = Ticket_1[a4(0x20b)], y['as'] = q[a3(0x1a8)], y[a4(0x1e2)] = x, y[a3(0x166)] = [q[a4(0x1a5)]];
                    const z = await Message_1[a3(0x20b)][a4(0x18e)](w['id'], {
                        'include': [
                            y,
                            {
                                'model': Message_1[a4(0x20b)],
                                'as': q[a3(0x1bd)],
                                'include': [q[a3(0x1a5)]]
                            }
                        ]
                    });
                    if (!z)
                        throw new Error(q[a4(0x1be)]);
                    await k[a3(0x191)]({
                        'lastMessage': z[a4(0x1b3)],
                        'lastMessageAt': new Date()[a3(0x1dc)](),
                        'answered': !![]
                    }), z[a3(0x172)] = k;
                    const A = {};
                    return A[a4(0x1f8)] = i, A[a4(0x189)] = q[a3(0x1ff)], A[a4(0x183)] = z, (0x8f9 * -0x3 + -0xf * -0x68 + -0x14d3 * -0x1, socketEmit_1[a3(0x20b)])(A), !z[a3(0x1a3) + 'te'] && await (0x1803 + -0x686 * 0x5 + -0x1 * -0x89b, queueValidation_1[a3(0x20b)])(k[a3(0x1d9)], i, [z]), z;
                }
            } else
                e[a3(0x194)][a3(0x1ae)](f);
        } catch (C) {
            logger_1[a3(0x194)][a4(0x1ae)](q[a4(0x1ef)], C);
        }
    };
exports[P(0x20b)] = CreateMessageSystemService;