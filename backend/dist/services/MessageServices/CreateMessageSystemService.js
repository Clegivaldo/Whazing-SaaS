'use strict';
const M = b, N = b;
(function (c, d) {
    const K = b, L = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(K(0x201)) / (0x18eb + -0xf94 + -0x956) * (-parseInt(L(0x1cd)) / (-0xb29 * -0x1 + -0x2248 + 0x1721)) + -parseInt(L(0x200)) / (-0x7 * 0x238 + 0xdc2 + -0x1 * -0x1c9) + -parseInt(K(0x18f)) / (-0xcc3 + 0x12cc + -0x605 * 0x1) * (-parseInt(L(0x1cb)) / (0x1 * 0x1f00 + 0x18e4 + 0x37df * -0x1)) + parseInt(K(0x1f1)) / (0x887 * 0x4 + 0x1b0 + -0x23c6 * 0x1) * (parseInt(L(0x180)) / (-0x1a63 + -0x1507 + 0x6c7 * 0x7)) + parseInt(L(0x1ca)) / (0x3e * -0x46 + 0x15b * 0x1 + 0xfa1 * 0x1) * (-parseInt(K(0x1b5)) / (-0x1031 * -0x1 + 0x3 * 0x10f + -0x1355)) + -parseInt(L(0x174)) / (0x3 * -0x283 + -0x3 * 0x3fb + 0x1384) * (parseInt(K(0x1cc)) / (0xf * -0x255 + 0x73c + 0x1bca)) + -parseInt(K(0x18b)) / (0x604 * 0x6 + -0x13a4 + -0x1068) * (-parseInt(K(0x171)) / (-0x1e * 0x1d + -0xe5 * 0x2b + -0x5 * -0x862));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, 0x21ee1 + 0x21 * -0x2ce + 0xc191));
var __importDefault = this && this[M(0x1e7) + N(0x207)] || function (c) {
    const O = M;
    return c && c[O(0x1ee)] ? c : { 'default': c };
};
const J = {};
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0xf6f + -0x13b0 + 0x247d);
        let h = e[f];
        return h;
    }, b(c, d);
}
function a() {
    const a3 = [
        'kQdkD',
        'eStatus',
        'hnIzG',
        'media',
        'uJvGq',
        '../../util',
        'filename',
        'add',
        'gQZmh',
        'gxtTF',
        'get',
        'map',
        'GtIEt',
        'WebHooksAP',
        'erty',
        'message',
        'NG_MESSAGE',
        'apiConfig',
        'where',
        'error',
        'split',
        'BLNmJ',
        'payload',
        'tBkpr',
        'CJVan',
        'CreateMess',
        'TpLVU',
        'mimetype',
        'findByPk',
        'API',
        '801ndoevo',
        'Htygh',
        'getTime',
        'ERROR\x20DONW',
        'PqVhO',
        'ffnkU',
        'ERR_CREATI',
        'mediaType',
        'response',
        'name',
        'YYIkF',
        'GvMKn',
        'qmzNT',
        'urlMessage',
        'xtvXD',
        'uXOaG',
        '../../mode',
        'rYbfR',
        'default',
        'Emit',
        'logger',
        '15144VTzFmB',
        '2095uhfptD',
        '2046jGYKqR',
        '236942rppiqV',
        'NJYdG',
        'pupa',
        'path',
        'TKHVy',
        'givju',
        'cFgTv',
        'hookMessag',
        'DuGOY',
        'content-ty',
        'XZsAm',
        '../../libs',
        'extension',
        'ervice',
        'mvtbU',
        'UDiJT',
        'body',
        'externalKe',
        'rmdirSync',
        'messageId',
        'IfcSG',
        'Status',
        'substr',
        'yTgNQ',
        'QarHs',
        'idation',
        '__importDe',
        '/Queue',
        'createWrit',
        'uuid',
        'LOAD',
        'finish',
        'defineProp',
        '__esModule',
        'headers',
        's/pupa',
        '60GvNdVT',
        'scheduleDa',
        'type',
        'KtCGm',
        '../../help',
        'indexOf',
        'chat:creat',
        'LYntR',
        'create',
        'url',
        'ageSystemS',
        'ticket',
        'GQWru',
        'AWQWJ',
        'contact',
        '607593nwwuqY',
        '1PhvzNq',
        'xLyVj',
        'ls/Ticket',
        'KJTrc',
        'uHrYg',
        'RZWpT',
        'fault',
        'XKfPV',
        'public',
        's/logger',
        'BVuOy',
        'ziLLT',
        'pipe',
        'axios',
        'data',
        'YqGDQ',
        'yLBor',
        'update',
        'VgBaD',
        'jgUDi',
        'number',
        'SetMU',
        'ers/socket',
        'qkDXk',
        'mediaUrl',
        'push',
        'kjqYS',
        'chat',
        'ywOwN',
        'quotedMsg',
        '442zbXntc',
        'recursive',
        'originalna',
        '580phYGOD',
        'RGFTf',
        'avetb',
        'authToken',
        'DqxRp',
        'eStream',
        'ixWHv',
        'protocol',
        'contactId',
        'whatsappId',
        'EIoNv',
        'ack',
        '8386ljWlOV',
        'lyaNP',
        'gJvLP',
        'fromMe',
        'uMrhY',
        'join',
        'status',
        '_SYSTEM',
        'all',
        'mime',
        'stream',
        '162636FLOnBL',
        's/queueVal',
        'tenantId',
        'responseTy',
        '1836XXEXUf',
        'value',
        'ls/Message',
        'model',
        'mXPrx',
        'Hxtjn',
        'include',
        'xqkEQ'
    ];
    a = function () {
        return a3;
    };
    return a();
}
J[N(0x190)] = !![], Object[N(0x1ed) + N(0x1a5)](exports, N(0x1ee), J);
const fs_1 = __importDefault(require('fs')), path_1 = require(N(0x1d0)), axios_1 = __importDefault(require(M(0x160))), mime_1 = __importDefault(require(N(0x189))), uuid_1 = require(N(0x1ea)), logger_1 = require(N(0x19c) + M(0x20a)), Ticket_1 = __importDefault(require(N(0x1c5) + M(0x203))), Message_1 = __importDefault(require(N(0x1c5) + M(0x191))), socketEmit_1 = __importDefault(require(N(0x1f5) + N(0x169) + N(0x1c8))), Queue_1 = __importDefault(require(N(0x1d8) + M(0x1e8))), pupa_1 = require(M(0x19c) + N(0x1f0)), queueValidation_1 = __importDefault(require(N(0x19c) + M(0x18c) + M(0x1e6))), downloadMedia = async g => {
        const P = M, Q = N, h = {
                'BVuOy': function (i, j) {
                    return i(j);
                },
                'VgBaD': P(0x1b8) + Q(0x1eb),
                'AWQWJ': function (i, j) {
                    return i !== j;
                },
                'kQdkD': Q(0x204),
                'avetb': Q(0x178),
                'jgUDi': Q(0x1ec),
                'givju': Q(0x1aa),
                'uXOaG': Q(0x18a),
                'cFgTv': P(0x1d6) + 'pe',
                'GvMKn': Q(0x209),
                'ffnkU': function (i, j) {
                    return i === j;
                },
                'uMrhY': Q(0x1d4) + Q(0x198),
                'UDiJT': P(0x1a4) + 'I'
            };
        try {
            const i = {};
            i[P(0x18e) + 'pe'] = h[Q(0x1c4)];
            const j = await axios_1[P(0x1c7)][P(0x1a1)](g[Q(0x16b)], i), k = j[Q(0x1ef)][h[P(0x1d3)]], l = mime_1[Q(0x1c7)], m = l[Q(0x1d9)](k), n = (0x15b0 + -0x25a * 0x1 + -0x1356, uuid_1['v4'])(), o = (0x74b * -0x4 + -0x956 + -0x1341 * -0x2, path_1[Q(0x185)])(__dirname, '..', '..', '..', h[P(0x1c0)]), p = n + '.' + m, q = (-0x1 * 0x12b + 0x1a35 + -0x190a, path_1[P(0x185)])(o, p), r = {};
            r[P(0x173) + 'me'] = p, r[Q(0x19d)] = p, r[P(0x1bc)] = m;
            const s = r;
            return await new Promise((t, u) => {
                const R = P, S = P;
                h[R(0x1fe)](h[S(0x197)], h[R(0x176)]) ? j[S(0x161)][R(0x15f)](fs_1[S(0x1c7)][S(0x1e9) + S(0x179)](q))['on'](h[S(0x166)], async () => {
                    const T = S;
                    h[T(0x20b)](t, s);
                })['on'](h[R(0x1d2)], v => {
                    const U = R, V = R;
                    console[U(0x1aa)](h[U(0x165)], v);
                    const w = {};
                    w[U(0x172)] = !![], fs_1[U(0x1c7)][V(0x1df)](q, w), h[U(0x20b)](u, new Error(v));
                }) : e[S(0x1c9)][S(0x1aa)](f);
            }), s;
        } catch (t) {
            if (h[P(0x1ba)](t[Q(0x1bd)][Q(0x186)], -0x21cb + -0x15 * -0x9d + -0xb3f * -0x2)) {
                const u = {};
                u[Q(0x17f)] = -(0xa * -0x1cd + 0x4d0 + 0xd33), u[P(0x1dd)] = g[P(0x1dd)], u[P(0x1e0)] = '', u[P(0x167)] = g[P(0x167)], u[P(0x1de) + 'y'] = g[Q(0x1de) + 'y'], u[Q(0x1aa)] = t[Q(0x1a6)], u[P(0x177)] = g[Q(0x1a8)][Q(0x177)], u[Q(0x1f3)] = h[Q(0x184)];
                const v = u;
                if (g?.[P(0x1a8)]?.[Q(0x1c2) + P(0x1e2)]) {
                    const w = {};
                    w[P(0x1fa)] = g[P(0x1a8)][Q(0x1c2) + P(0x1e2)], w[P(0x1f3)] = v[P(0x1f3)], w[Q(0x1ad)] = v, Queue_1[Q(0x1c7)][Q(0x19e)](h[Q(0x1dc)], w);
                }
                return {};
            }
            throw new Error(t);
        }
    }, CreateMessageSystemService = async ({
        msg: h,
        tenantId: i,
        medias: j,
        ticket: k,
        userId: l,
        scheduleDate: m,
        sendType: n,
        status: o,
        idFront: p
    }) => {
        const W = M, X = M, q = {
                'yLBor': W(0x1b8) + X(0x1eb),
                'KtCGm': function (s, t) {
                    return s(t);
                },
                'ziLLT': X(0x1a4) + 'I',
                'yTgNQ': function (s, t) {
                    return s !== t;
                },
                'YqGDQ': W(0x1e1),
                'ywOwN': X(0x1a0),
                'YYIkF': W(0x1fc),
                'Htygh': X(0x1ff),
                'GQWru': X(0x170),
                'TpLVU': W(0x1bb) + W(0x1a7) + X(0x187),
                'XKfPV': W(0x1f7) + 'e',
                'CJVan': function (s, t) {
                    return s(t);
                },
                'tBkpr': function (s, t) {
                    return s(t);
                },
                'RZWpT': W(0x1ec),
                'xtvXD': W(0x1aa),
                'gJvLP': function (s, t) {
                    return s(t);
                },
                'EIoNv': X(0x1d4) + X(0x198),
                'hnIzG': function (s, t) {
                    return s === t;
                },
                'XZsAm': X(0x1b4),
                'BLNmJ': X(0x16e),
                'lyaNP': W(0x1a3),
                'NJYdG': X(0x168),
                'RGFTf': function (s, t) {
                    return s === t;
                },
                'PqVhO': function (s, t) {
                    return s !== t;
                },
                'kjqYS': W(0x1c6),
                'Hxtjn': W(0x196),
                'QarHs': function (s, t) {
                    return s === t;
                },
                'TKHVy': W(0x193),
                'DuGOY': X(0x1c1),
                'qkDXk': W(0x202),
                'uHrYg': function (s, t) {
                    return s !== t;
                },
                'mvtbU': W(0x19b),
                'ixWHv': W(0x19f),
                'LYntR': X(0x1b0) + X(0x1fb) + X(0x1da)
            }, r = {
                'ticketId': k['id'],
                'body': h[X(0x1dd)],
                'contactId': h?.[X(0x183)] ? null : k[X(0x17c)],
                'fromMe': q[W(0x199)](n, q[X(0x1d7)]) ? !![] : h?.[W(0x183)],
                'read': !![],
                'mediaType': q[X(0x1ac)],
                'mediaUrl': undefined,
                'timestamp': new Date()[W(0x1b7)](),
                'quotedMsgId': h?.[W(0x170)]?.['id'],
                'userId': l,
                'scheduleDate': m,
                'sendType': n,
                'status': o,
                'tenantId': i,
                'idFront': p
            };
        try {
            if (q[X(0x1e4)](q[W(0x181)], q[X(0x1ce)])) {
                const s = {};
                s[W(0x17b)] = k[X(0x17b)], s[X(0x1be)] = k[X(0x1ff)][W(0x1be)], r[W(0x1dd)] = (-0x1 * -0xf67 + 0x17fe + -0x2765, pupa_1[X(0x1cf)])(h[X(0x1dd)] || '', s);
                if (q[X(0x199)](n, q[W(0x1d7)]) && h[X(0x16b)]) {
                    j = [];
                    const t = await q[X(0x182)](downloadMedia, h);
                    j[X(0x16c)](t);
                }
                if (q[X(0x175)](n, q[X(0x1d7)]) && !h[X(0x16b)] && h[X(0x19a)]) {
                    if (q[X(0x1b9)](q[W(0x16d)], q[W(0x194)]))
                        j = [], j[X(0x16c)](h[W(0x19a)]);
                    else {
                        j[W(0x1aa)](q[X(0x163)], k);
                        const v = {};
                        v[X(0x172)] = !![], l[X(0x1c7)][W(0x1df)](m, v), q[W(0x1f4)](n, new o(p));
                    }
                }
                if (j)
                    q[W(0x1e5)](q[W(0x1d1)], q[W(0x1d1)]) ? await Promise[X(0x188)](j[W(0x1a2)](async v => {
                        const Y = X, Z = W;
                        if (q[Y(0x1e4)](q[Y(0x162)], q[Z(0x16f)])) {
                            try {
                                if (!v[Z(0x19d)]) {
                                    const C = v[Z(0x1b2)][Y(0x1ab)]('/')[0xdb1 + 0x3c * 0x8d + 0x6 * -0x7ca][Y(0x1ab)](';')[-0x1c3a + -0x1ec1 + -0x7 * -0x86d];
                                    v[Z(0x19d)] = new Date()[Z(0x1b7)]() + '.' + C;
                                }
                            } catch (D) {
                                logger_1[Z(0x1c9)][Z(0x1aa)](D);
                            }
                            const w = {
                                    ...r,
                                    'body': v[Y(0x173) + 'me'],
                                    'mediaUrl': v[Y(0x19d)],
                                    'mediaType': v[Y(0x1bc)] || v[Z(0x1b2)][Y(0x1e3)](0x66 * -0x20 + -0xb3 + 0xd73, v[Z(0x1b2)][Y(0x1f6)]('/'))
                                }, x = await Message_1[Z(0x1c7)][Z(0x1f9)](w), y = {};
                            y[Y(0x18d)] = i;
                            const z = {};
                            z[Y(0x192)] = Ticket_1[Y(0x1c7)], z['as'] = q[Z(0x1bf)], z[Y(0x1a9)] = y, z[Y(0x195)] = [q[Y(0x1b6)]];
                            const A = await Message_1[Y(0x1c7)][Z(0x1b3)](x['id'], {
                                'include': [
                                    z,
                                    {
                                        'model': Message_1[Z(0x1c7)],
                                        'as': q[Z(0x1fd)],
                                        'include': [q[Z(0x1b6)]]
                                    }
                                ]
                            });
                            if (!A)
                                throw new Error(q[Y(0x1b1)]);
                            await k[Z(0x164)]({
                                'lastMessage': A[Z(0x1dd)],
                                'lastMessageAt': new Date()[Z(0x1b7)]()
                            });
                            const B = {};
                            return B[Z(0x18d)] = i, B[Y(0x1f3)] = q[Z(0x208)], B[Y(0x1ad)] = A, (0x1 * 0x24f5 + -0x18a3 + -0x13 * 0xa6, socketEmit_1[Z(0x1c7)])(B), !A[Y(0x1f2) + 'te'] && await (-0x13b8 + 0x59 * 0x4d + -0x70d, queueValidation_1[Z(0x1c7)])(k[Z(0x17d)], i, [A]), A;
                        } else {
                            const F = {};
                            F[Z(0x1fa)] = h[Y(0x1a8)][Z(0x1c2) + Y(0x1e2)], F[Z(0x1f3)] = i[Y(0x1f3)], F[Z(0x1ad)] = j, F[Y(0x1c7)][Y(0x19e)](q[Y(0x15e)], F);
                        }
                    })) : m[W(0x161)][W(0x15f)](n[X(0x1c7)][W(0x1e9) + W(0x179)](o))['on'](q[X(0x206)], async () => {
                        const a0 = W;
                        q[a0(0x1af)](w, x);
                    })['on'](q[X(0x1c3)], D => {
                        const a1 = X, a2 = X;
                        w[a1(0x1aa)](q[a1(0x163)], D);
                        const E = {};
                        E[a1(0x172)] = !![], x[a2(0x1c7)][a1(0x1df)](y, E), q[a2(0x1ae)](z, new A(D));
                    });
                else {
                    if (q[X(0x1b9)](q[W(0x1d5)], q[W(0x16a)])) {
                        const w = { ...r };
                        w[W(0x1bc)] = q[X(0x1ac)];
                        const x = await Message_1[X(0x1c7)][X(0x1f9)](w), y = {};
                        y[X(0x18d)] = i;
                        const z = {};
                        z[X(0x192)] = Ticket_1[W(0x1c7)], z['as'] = q[W(0x1bf)], z[W(0x1a9)] = y, z[W(0x195)] = [q[W(0x1b6)]];
                        const A = await Message_1[X(0x1c7)][X(0x1b3)](x['id'], {
                            'include': [
                                z,
                                {
                                    'model': Message_1[X(0x1c7)],
                                    'as': q[X(0x1fd)],
                                    'include': [q[X(0x1b6)]]
                                }
                            ]
                        });
                        if (!A) {
                            if (q[X(0x205)](q[W(0x1db)], q[W(0x17a)]))
                                throw new Error(q[W(0x1b1)]);
                            else
                                q[W(0x182)](y, z);
                        }
                        await k[W(0x164)]({
                            'lastMessage': A[X(0x1dd)],
                            'lastMessageAt': new Date()[X(0x1b7)](),
                            'answered': !![]
                        }), A[W(0x1fc)] = k;
                        const B = {};
                        return B[W(0x18d)] = i, B[W(0x1f3)] = q[W(0x208)], B[X(0x1ad)] = A, (-0x1fca + 0x1 * 0x10c1 + 0xf09, socketEmit_1[X(0x1c7)])(B), !A[X(0x1f2) + 'te'] && await (-0x1bd5 * 0x1 + -0xc8 + -0x125 * -0x19, queueValidation_1[X(0x1c7)])(k[W(0x17d)], i, [A]), A;
                    } else {
                        const E = {};
                        E[W(0x17f)] = -(-0x1439 + 0x1195 + 0x2a5 * 0x1), E[W(0x1dd)] = k[W(0x1dd)], E[X(0x1e0)] = '', E[W(0x167)] = l[X(0x167)], E[X(0x1de) + 'y'] = m[W(0x1de) + 'y'], E[W(0x1aa)] = n[X(0x1a6)], E[X(0x177)] = o[X(0x1a8)][X(0x177)], E[X(0x1f3)] = q[W(0x17e)];
                        const F = E;
                        if (p?.[W(0x1a8)]?.[X(0x1c2) + W(0x1e2)]) {
                            const G = {};
                            G[X(0x1fa)] = t[W(0x1a8)][W(0x1c2) + X(0x1e2)], G[X(0x1f3)] = F[X(0x1f3)], G[X(0x1ad)] = F, s[W(0x1c7)][X(0x19e)](q[X(0x15e)], G);
                        }
                        return {};
                    }
                }
            } else {
                const F = {};
                return F[W(0x1c7)] = j, g && F[X(0x1ee)] ? i : F;
            }
        } catch (F) {
            logger_1[X(0x1c9)][W(0x1aa)](q[X(0x1f8)], F);
        }
    };
exports[N(0x1c7)] = CreateMessageSystemService;