'use strict';const o=b,q=b;(function(c,d){const m=b,n=b,e=c();while(!![]){try{const f=parseInt(m(0x195))/0x1+parseInt(m(0x1a2))/0x2*(-parseInt(n(0x199))/0x3)+parseInt(n(0x19b))/0x4*(-parseInt(n(0x1a0))/0x5)+parseInt(n(0x1a9))/0x6*(parseInt(n(0x198))/0x7)+parseInt(m(0x18b))/0x8*(-parseInt(m(0x187))/0x9)+parseInt(n(0x1a3))/0xa*(parseInt(n(0x18f))/0xb)+-parseInt(n(0x19a))/0xc*(-parseInt(m(0x19c))/0xd);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x23633));function a(){const t=['contact','__esModule','227057dXKYdy','../../models/Ticket','chat','7FMCTeK','21165nORXUz','132awuPpR','615916aKSIoE','132626DIaxgU','__importDefault','findOne','quotedMsg','5qBmGid','../TicketServices/ShowTicketService','46leDITv','10130GFYuYL','default','whatsappId','update','sequelize','pending','742554YdnAMx','tenantId','308637tCkHlf','ERR_CREATING_MESSAGE_SYSTEM','getTime','chat:create','64bRZIWS','../../helpers/socketEmit','mediaType','findByPk','2959jXWBxM','open','mediaName','create'];a=function(){return t;};return a();}var __importDefault=this&&this[o(0x19d)]||function(c){const p=o;return c&&c[p(0x194)]?c:{'default':c};};Object['defineProperty'](exports,o(0x194),{'value':!![]});const sequelize_1=require(o(0x1a7)),socketEmit_1=__importDefault(require(o(0x18c))),Message_1=__importDefault(require('../../models/Message')),Ticket_1=__importDefault(require(q(0x196))),ShowTicketService_1=__importDefault(require(o(0x1a1))),queueValidation_1=__importDefault(require('../../utils/queueValidation')),CreateForwardMessageService=async({userId:c,tenantId:d,message:e,contact:f,ticketIdOrigin:g})=>{const r=q,s=q,h=await(0x0,ShowTicketService_1[r(0x1a4)])({'id':g,'tenantId':d});let i;i=await Ticket_1[s(0x1a4)][s(0x19e)]({'where':{'status':{[sequelize_1['Op']['or']]:[s(0x190),r(0x1a8)]},'tenantId':d,'contactId':f['id']}});!i&&(i=await Ticket_1[s(0x1a4)][r(0x192)]({'contactId':f['id'],'status':r(0x190),'isGroup':f['isGroup'],'userId':c,'tenantId':d,'unreadMessages':0x0,'whatsappId':h['whatsappId'],'lastMessage':e['body'],'lastMessageAt':new Date()[r(0x189)](),'answered':!![]}));const j={'body':e['body'],'contactId':f['id'],'fromMe':!![],'read':!![],'mediaType':e?.[r(0x18d)],'mediaUrl':e?.['mediaName'],'mediaName':e?.[s(0x191)],'timestamp':new Date()['getTime'](),'userId':c,'scheduleDate':null,'sendType':r(0x197),'status':s(0x1a8),'ticketId':i['id'],'tenantId':d},k=await Message_1[r(0x1a4)][r(0x192)](j),l=await Message_1[r(0x1a4)][r(0x18e)](k['id'],{'include':[{'model':Ticket_1[s(0x1a4)],'as':'ticket','where':{'tenantId':d},'include':[r(0x193)]},{'model':Message_1[r(0x1a4)],'as':r(0x19f),'include':[s(0x193)]}]});if(!l)throw new Error(s(0x188));await i[r(0x1a6)]({'lastMessage':l['body'],'lastMessageAt':new Date()[s(0x189)](),'answered':!![]}),await(0x0,queueValidation_1[r(0x1a4)])(i[r(0x1a5)],i[r(0x186)],[l]),(0x0,socketEmit_1[r(0x1a4)])({'tenantId':d,'type':s(0x18a),'payload':l});};function b(c,d){const e=a();return b=function(f,g){f=f-0x186;let h=e[f];return h;},b(c,d);}exports[o(0x1a4)]=CreateForwardMessageService;