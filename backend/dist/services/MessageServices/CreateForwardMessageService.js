'use strict';const o=b,q=b;(function(c,d){const m=b,n=b,e=c();while(!![]){try{const f=-parseInt(m(0x13c))/0x1*(-parseInt(m(0x141))/0x2)+parseInt(m(0x145))/0x3*(parseInt(n(0x14d))/0x4)+parseInt(n(0x139))/0x5*(-parseInt(n(0x144))/0x6)+-parseInt(n(0x143))/0x7*(-parseInt(m(0x156))/0x8)+parseInt(n(0x140))/0x9+parseInt(m(0x147))/0xa*(parseInt(m(0x137))/0xb)+-parseInt(n(0x14b))/0xc*(parseInt(n(0x13b))/0xd);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x50a25));function a(){const t=['3086155JuHcea','findByPk','78REfMOc','1172rFhSNV','../../models/Ticket','__esModule','ERR_CREATING_MESSAGE_SYSTEM','2607255yhqZgW','286fEJcbQ','whatsappId','7cYbOQm','6HyOTFB','896277PNhfYR','../../utils/queueValidation','3300mJRLaQ','create','open','getTime','1436748OFjomX','ticket','8VrnGeJ','default','quotedMsg','sequelize','mediaType','__importDefault','body','contact','../TicketServices/ShowTicketService','3528984FShuQR','../../helpers/socketEmit','5665HrhGCH','findOne'];a=function(){return t;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x136;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[o(0x152)]||function(c){const p=o;return c&&c[p(0x13e)]?c:{'default':c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const sequelize_1=require(o(0x150)),socketEmit_1=__importDefault(require(q(0x136))),Message_1=__importDefault(require('../../models/Message')),Ticket_1=__importDefault(require(q(0x13d))),ShowTicketService_1=__importDefault(require(o(0x155))),queueValidation_1=__importDefault(require(o(0x146))),CreateForwardMessageService=async({userId:c,tenantId:d,message:e,contact:f,ticketIdOrigin:g})=>{const r=o,s=q,h=await(0x0,ShowTicketService_1[r(0x14e)])({'id':g,'tenantId':d});let i;i=await Ticket_1[s(0x14e)][s(0x138)]({'where':{'status':{[sequelize_1['Op']['or']]:[s(0x149),'pending']},'tenantId':d,'contactId':f['id']}});!i&&(i=await Ticket_1[r(0x14e)]['create']({'contactId':f['id'],'status':'open','isGroup':f['isGroup'],'userId':c,'tenantId':d,'unreadMessages':0x0,'whatsappId':h[r(0x142)],'lastMessage':e['body'],'lastMessageAt':new Date()[s(0x14a)](),'answered':!![]}));const j={'body':e[s(0x153)],'contactId':f['id'],'fromMe':!![],'read':!![],'mediaType':e?.[r(0x151)],'mediaUrl':e?.['mediaName'],'mediaName':e?.['mediaName'],'timestamp':new Date()[r(0x14a)](),'userId':c,'scheduleDate':null,'sendType':'chat','status':'pending','ticketId':i['id'],'tenantId':d},k=await Message_1[r(0x14e)][r(0x148)](j),l=await Message_1[s(0x14e)][r(0x13a)](k['id'],{'include':[{'model':Ticket_1[r(0x14e)],'as':r(0x14c),'where':{'tenantId':d},'include':[s(0x154)]},{'model':Message_1['default'],'as':s(0x14f),'include':['contact']}]});if(!l)throw new Error(s(0x13f));await i['update']({'lastMessage':l[r(0x153)],'lastMessageAt':new Date()['getTime'](),'answered':!![]}),await(0x0,queueValidation_1['default'])(i[r(0x142)],i['tenantId'],[l]),(0x0,socketEmit_1[r(0x14e)])({'tenantId':d,'type':'chat:create','payload':l});};exports['default']=CreateForwardMessageService;