'use strict';const q=b,s=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=-parseInt(o(0x19b))/0x1*(-parseInt(p(0x19d))/0x2)+parseInt(o(0x1ab))/0x3+-parseInt(o(0x19a))/0x4*(-parseInt(o(0x1ba))/0x5)+parseInt(o(0x1b0))/0x6+-parseInt(p(0x1b1))/0x7*(parseInt(o(0x1a4))/0x8)+-parseInt(o(0x1aa))/0x9+parseInt(p(0x1a8))/0xa*(parseInt(o(0x1a0))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x1e362));function a(){const x=['Mensagem\x20original\x20nÃ£o\x20encontrada','97504TGsmhn','fromMe','quotedMsg','update','15160SIcwtu','__esModule','ERR_CREATING_MESSAGE','messageId','90Uixxdp','ReZPb','356841iuPTWs','213948GcAnOz','findOne','Erro\x20ao\x20extrair\x20messageId\x20do\x20dataJson','chat:update','WarZQ','440994StzaHs','623qOyZKF','dataJson','create','../../models/Message','default','chat:create','../../helpers/socketEmit','key','HWAqo','40000LlTGVU','../../models/Ticket','__importDefault','editedMessage','protocolMessage','defineProperty','message','8WspgEK','1ENXftK','contact','182918veImNU','aDAox'];a=function(){return x;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x19a;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[q(0x1bc)]||function(c){const r=q;return c&&c[r(0x1a5)]?c:{'default':c};};Object[q(0x1bf)](exports,s(0x1a5),{'value':!![]});const Message_1=__importDefault(require(s(0x1b4))),Ticket_1=__importDefault(require(s(0x1bb))),socketEmit_1=__importDefault(require(q(0x1b7))),Contact_1=__importDefault(require('../../models/Contact'));function extractMessageId(c){const t=q,u=q;try{const d=JSON['parse'](c);return d[t(0x1c0)][t(0x1bd)]['message'][u(0x1be)][u(0x1b8)]['id'];}catch(e){throw new Error(u(0x1ad));}}const CreateMessageService=async({messageData:c,tenantId:d})=>{const v=s,w=s;if(c['mediaType']==='editedMessage'&&c['dataJson']){if(v(0x1b9)===v(0x1b9)){const h=c[w(0x1b2)],i=extractMessageId(h),j=await Message_1[w(0x1b5)][w(0x1ac)]({'where':{'messageId':i,'tenantId':d}});if(j){if('aDAox'===w(0x19e))return await j[v(0x1a3)]({'edited':c['body']}),(0x0,socketEmit_1[v(0x1b5)])({'tenantId':d,'type':v(0x1ae),'payload':j}),j;else g=[{'model':h[v(0x1b5)],'as':'ticket','where':{'tenantId':i},'include':['contact']},{'model':j[w(0x1b5)],'as':w(0x1a2),'include':['contact']}];}else{if(w(0x1af)===v(0x1a9))throw new d(v(0x19f));else throw new Error(w(0x19f));}}else throw new d('ERR_CREATING_MESSAGE');}let e=await Message_1[w(0x1b5)][w(0x1ac)]({'where':{'messageId':c[v(0x1a7)],'tenantId':d}});!e?e=await Message_1[w(0x1b5)][v(0x1b3)]({...c,'tenantId':d}):await e['update'](c);let f;!c[w(0x1a1)]?f=[{'model':Ticket_1[w(0x1b5)],'as':'ticket','where':{'tenantId':d},'include':[v(0x19c)]},{'model':Message_1[w(0x1b5)],'as':w(0x1a2),'include':['contact']},{'model':Contact_1['default'],'as':w(0x19c),'where':{'id':c['contactId']}}]:f=[{'model':Ticket_1['default'],'as':'ticket','where':{'tenantId':d},'include':[v(0x19c)]},{'model':Message_1['default'],'as':'quotedMsg','include':[w(0x19c)]}];const g=await Message_1[w(0x1b5)][w(0x1ac)]({'where':{'messageId':c[w(0x1a7)],'tenantId':d},'include':f});if(!g)throw new Error(v(0x1a6));return(0x0,socketEmit_1['default'])({'tenantId':d,'type':v(0x1b6),'payload':g}),e;};exports[q(0x1b5)]=CreateMessageService;