'use strict';const u=b,w=b;(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=parseInt(s(0x165))/0x1*(-parseInt(t(0x135))/0x2)+parseInt(s(0x155))/0x3+-parseInt(t(0x14a))/0x4+parseInt(t(0x13e))/0x5*(-parseInt(t(0x138))/0x6)+parseInt(s(0x136))/0x7*(parseInt(t(0x13d))/0x8)+-parseInt(t(0x168))/0x9+parseInt(t(0x133))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x51ddc));function b(c,d){const e=a();return b=function(f,g){f=f-0x130;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[u(0x142)]||function(c){const v=u;return c&&c[v(0x15b)]?c:{'default':c};};Object[w(0x161)](exports,'__esModule',{'value':!![]});const path_1=require(w(0x169)),sequelize_1=require(u(0x15d)),SetTicketMessagesAsRead_1=__importDefault(require(u(0x13c))),socketEmit_1=__importDefault(require(u(0x146))),Message_1=__importDefault(require(u(0x15e))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(u(0x157)),SendMessagesSystemWbot=async(c,d)=>{const x=u,y=w,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':'pending',[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][x(0x139)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1[y(0x130)][x(0x14d)]({'where':e,'include':[x(0x148),{'model':Ticket_1[x(0x130)],'as':y(0x167),'where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:'closed'},'isFarewellMessage':!![]},'channel':y(0x144),'whatsappId':c['id']},'include':[y(0x148)]},{'model':Message_1[x(0x130)],'as':x(0x143),'include':[y(0x148)]}],'order':[[x(0x156),y(0x132)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j['contact']['telegramId'],l={};i[x(0x143)]&&(l[x(0x131)]=i[y(0x143)][x(0x158)]);try{if(![x(0x151),y(0x14c)][x(0x14e)](i[x(0x162)])&&i[y(0x152)]){const n=(0x0,path_1[x(0x14f)])(__dirname,'..','..','..',y(0x141)),o=(0x0,path_1[x(0x14f)])(n,i[x(0x152)]);if(i[x(0x162)]===y(0x160)||i[y(0x162)]===x(0x15f))g=await c['telegram'][y(0x15c)](k,{'source':o},l);else{if(i[y(0x162)]==='image')g=await c[x(0x144)][x(0x164)](k,{'source':o},l);else i[x(0x162)]===x(0x134)?g=await c['telegram']['sendVideo'](k,{'source':o},l):g=await c[x(0x144)][x(0x13a)](k,{'source':o},l);}logger_1[x(0x163)][x(0x153)](x(0x140));}else g=await c[x(0x144)]['sendMessage'](k,i[x(0x15a)],l),logger_1['logger'][x(0x153)](x(0x149));const m={...i,...g,'id':i['id'],'timestamp':g[x(0x14b)]*0x3e8,'messageId':g[x(0x13b)],'status':x(0x166),'ack':0x2};await Message_1[x(0x130)][y(0x154)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[y(0x130)])({'tenantId':j[y(0x137)],'type':'chat:ack','payload':{...i['dataValues'],'id':i['id'],'mediaUrl':i[x(0x13f)],'timestamp':m[y(0x150)],'messageId':g[y(0x13b)],'status':y(0x166),'ack':0x2}}),logger_1[x(0x163)]['info'](x(0x159)),await(0x0,SetTicketMessagesAsRead_1[y(0x130)])(j);}catch(p){const q=i['id'],r=i[y(0x167)]['id'];logger_1['logger'][x(0x145)]('Error\x20message\x20is\x20(tenant:\x20'+d+x(0x16a)+r+')'),logger_1[y(0x163)]['error']('Error\x20send\x20message\x20(id:\x20'+q+y(0x147)+p);}}};exports['default']=SendMessagesSystemWbot;function a(){const z=['timestamp','chat','mediaName','info','update','1806738zbYaOW','createdAt','../../utils/logger','messageId','Message\x20Update\x20ok','body','__esModule','sendVoice','sequelize','../../models/Message','ptt','audio','defineProperty','mediaType','logger','sendPhoto','1ofeHnI','sended','ticket','1761723YMztTl','path','\x20|\x20Ticket:\x20','default','reply_to_message_id','ASC','7966350ndejdU','video','761758TAnmKx','49084znifqJ','tenantId','3817818lwMAIy','lte','sendDocument','message_id','../../helpers/SetTicketMessagesAsRead','344cbnEOm','5yxgXNc','mediaUrl','sendMessage\x20media','public','__importDefault','quotedMsg','telegram','error','../../helpers/socketEmit',')::\x20','contact','sendMessage\x20text','608576RlqkVq','date','text','findAll','includes','join'];a=function(){return z;};return a();}