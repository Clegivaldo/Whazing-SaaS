'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x66;let h=e[f];return h;},b(c,d);}const u=b,w=b;(function(c,d){const s=b,t=b,e=c();while(!![]){try{const f=parseInt(s(0x94))/0x1+-parseInt(t(0x77))/0x2+-parseInt(t(0x95))/0x3+-parseInt(t(0x87))/0x4+parseInt(s(0x9a))/0x5*(parseInt(t(0x72))/0x6)+-parseInt(s(0x73))/0x7*(parseInt(s(0x91))/0x8)+parseInt(t(0x75))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x8f91e));var __importDefault=this&&this[u(0x7c)]||function(c){const v=u;return c&&c[v(0x98)]?c:{'default':c};};Object[u(0x97)](exports,'__esModule',{'value':!![]});function a(){const z=['reply_to_message_id','ptt',')::\x20','message_id','2071848lZgwfb','Message\x20Update\x20ok','update','823426tbsljw','1536615vjnonY','ticket','defineProperty','__esModule','telegramId','4595vWvAMh','sendPhoto','chat:ack','logger','sendVideo','timestamp','text','sended','audio','dataValues','mediaUrl','Error\x20message\x20is\x20(tenant:\x20','sendVoice','info','join','quotedMsg','public','default','messageId','3762CRSpga','7AMNCFh','tenantId','6577551hOsteL','sendMessage','157006xcDoFT','error','ASC','body','image','__importDefault','sequelize','date','mediaName','pending','telegram','mediaType','closed','chat','../../utils/logger','sendDocument','2770908AOjyUz','../../models/Message','lte','findAll','sendMessage\x20media','contact'];a=function(){return z;};return a();}const path_1=require('path'),sequelize_1=require(u(0x7d)),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socketEmit_1=__importDefault(require('../../helpers/socketEmit')),Message_1=__importDefault(require(u(0x88))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(w(0x85)),SendMessagesSystemWbot=async(c,d)=>{const x=w,y=w,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':x(0x80),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][x(0x89)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1['default'][y(0x8a)]({'where':e,'include':[x(0x8c),{'model':Ticket_1[y(0x70)],'as':'ticket','where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:y(0x83)},'isFarewellMessage':!![]},'channel':y(0x81),'whatsappId':c['id']},'include':[y(0x8c)]},{'model':Message_1['default'],'as':y(0x6e),'include':['contact']}],'order':[['createdAt',x(0x79)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j['contact'][y(0x99)],l={};i[x(0x6e)]&&(l[y(0x8d)]=i['quotedMsg'][y(0x71)]);try{if(![x(0x84),x(0xa0)]['includes'](i[x(0x82)])&&i[y(0x7f)]){const n=(0x0,path_1['join'])(__dirname,'..','..','..',x(0x6f)),o=(0x0,path_1[y(0x6d)])(n,i[x(0x7f)]);if(i[x(0x82)]===x(0x67)||i['mediaType']===x(0x8e))g=await c[x(0x81)][y(0x6b)](k,{'source':o},l);else{if(i[y(0x82)]===x(0x7b))g=await c[y(0x81)][x(0x9b)](k,{'source':o},l);else i[x(0x82)]==='video'?g=await c[y(0x81)][y(0x9e)](k,{'source':o},l):g=await c[x(0x81)][x(0x86)](k,{'source':o},l);}logger_1[x(0x9d)]['info'](x(0x8b));}else g=await c[x(0x81)][y(0x76)](k,i[x(0x7a)],l),logger_1[y(0x9d)][x(0x6c)]('sendMessage\x20text');const m={...i,...g,'id':i['id'],'timestamp':g[y(0x7e)]*0x3e8,'messageId':g[x(0x90)],'status':'sended','ack':0x2};await Message_1['default'][y(0x93)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[y(0x70)])({'tenantId':j[x(0x74)],'type':x(0x9c),'payload':{...i[y(0x68)],'id':i['id'],'mediaUrl':i[y(0x69)],'timestamp':m[x(0x9f)],'messageId':g[y(0x90)],'status':x(0x66),'ack':0x2}}),logger_1[x(0x9d)][x(0x6c)](y(0x92)),await(0x0,SetTicketMessagesAsRead_1[x(0x70)])(j);}catch(p){const q=i['id'],r=i[y(0x96)]['id'];logger_1['logger']['error'](y(0x6a)+d+'\x20|\x20Ticket:\x20'+r+')'),logger_1['logger'][y(0x78)]('Error\x20send\x20message\x20(id:\x20'+q+y(0x8f)+p);}}};exports[u(0x70)]=SendMessagesSystemWbot;