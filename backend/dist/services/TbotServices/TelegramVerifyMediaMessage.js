'use strict';
const E = b, F = b;
function a() {
    const U = [
        'ZphBi',
        'error',
        'lycAS',
        'bwcIP',
        'rBGXv',
        'GNbwE',
        'sended',
        'tedForMess',
        'kxSMz',
        'jwxFz',
        'BHoJK',
        'SAS',
        'edited_mes',
        'message_id',
        'ageId',
        '409997IAHHMz',
        '32sINeFg',
        'logger',
        '558813gIfnWn',
        'image/webp',
        'ers/getQuo',
        'data',
        '../../util',
        'HRQmH',
        'finish',
        'ERR_DOWNLO',
        'UOraQ',
        'util',
        '\x20ID:\x20',
        'promisify',
        'value',
        'mime_type',
        'LmIAJ',
        'pipe',
        'xiIcR',
        'reateMessa',
        'iAUDu',
        'ClApB',
        'join',
        'QiSQk',
        'reply_to_m',
        'sticker',
        's/logger',
        'photo',
        'SAD',
        'video',
        'fileId',
        'gnLvZ',
        'document',
        '__importDe',
        'erty',
        'audio',
        'public',
        'split',
        'image/png',
        'update',
        'createWrit',
        'GET',
        'xfnOT',
        'toString',
        '../../help',
        'text',
        'fault',
        'writeFile',
        'fnPqd',
        'essage',
        'defineProp',
        'is_animate',
        'messageDat',
        'HBRWU',
        'AD_MEDIA::',
        'fqHHO',
        'caption',
        'telegram',
        'Fedxb',
        'wDcHH',
        'file_id',
        'geService',
        'Services/C',
        'date',
        'ZlBjL',
        'default',
        'axios',
        'received',
        '9112240TziNoZ',
        '480809zZSlVN',
        'SAV',
        'DOrEf',
        'nrEsI',
        'ytxeM',
        'getFileLin',
        'ERROR\x20DONW',
        'cgGeo',
        'WUPsl',
        'type',
        'tenantId',
        'mimeType',
        'LOAD',
        'fileName',
        '372275mlIZCA',
        'getFile',
        'path',
        'dwxir',
        '352322isDBdw',
        'POExb',
        'getTime',
        '1917822DJTfWP',
        '__esModule',
        'file_name',
        'stream',
        'eStream',
        'voice',
        'dRqCs',
        'smxOQ',
        'qUVmy',
        'length',
        'UAdzb',
        'STXAA',
        'WTJIW',
        'sage',
        '../Message',
        'message'
    ];
    a = function () {
        return U;
    };
    return a();
}
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0x1 * -0x157f + -0xa * -0x69 + -0x1921);
        let h = e[f];
        return h;
    }, b(c, d);
}
(function (c, d) {
    const C = b, D = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(C(0xd1)) / (-0x35f + 0x26c9 + -0x103 * 0x23) + -parseInt(D(0xe3)) / (0x1177 + -0x1c2d * -0x1 + -0x2da2) + -parseInt(D(0x8e)) / (-0x7bd + 0x4d + 0x1 * 0x773) + -parseInt(C(0x8c)) / (0xa8f * 0x1 + -0x2008 + 0x157d * 0x1) * (parseInt(C(0xdf)) / (-0x26a + 0x4a * 0x43 + -0x33 * 0x55)) + -parseInt(C(0xe6)) / (0x1 * 0x733 + 0x1bd1 * -0x1 + -0x529 * -0x4) + parseInt(D(0x8b)) / (-0x2 * -0x501 + -0x1f6 * 0x3 + -0x1 * 0x419) + parseInt(D(0xd0)) / (-0x8da * -0x2 + 0x2466 + 0x602 * -0x9);
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, 0x550c1 + 0x2e79 + 0x9e03));
var __importDefault = this && this[E(0xad) + E(0xba)] || function (c) {
    const G = E;
    return c && c[G(0xe7)] ? c : { 'default': c };
};
const u = {};
u[F(0x9a)] = !![], Object[F(0xbe) + F(0xae)](exports, F(0xe7), u);
const path_1 = require(E(0xe1)), util_1 = require(E(0x97)), fs_1 = require('fs'), axios_1 = __importDefault(require(E(0xce))), CreateMessageService_1 = __importDefault(require(F(0x7a) + E(0xca) + F(0x9f) + F(0xc9))), logger_1 = require(E(0x92) + F(0xa6)), getQuotedForMessageId_1 = __importDefault(require(E(0xb8) + E(0x90) + E(0x83) + F(0x8a))), writeFileAsync = (-0x21 * 0x1 + 0x925 * 0x2 + -0x1 * 0x1229, util_1[F(0x99)])(fs_1[F(0xbb)]), getMediaInfo = j => {
        const H = F, I = F, k = {};
        k[H(0xcc)] = H(0xa7), k[H(0xab)] = H(0xa9), k[H(0x7e)] = H(0xaf), k[I(0xd3)] = H(0xeb), k[H(0x86)] = H(0xa5), k[H(0xbc)] = H(0xac), k[H(0xec)] = function (w, z) {
            return w - z;
        }, k[I(0xd4)] = function (w, z) {
            return w == z;
        }, k[H(0x85)] = I(0xb2), k[I(0x7f)] = H(0x8f);
        const l = k, m = j[I(0xa7)] ? l[I(0xcc)] : j[H(0xa9)] ? l[H(0xab)] : j[H(0xaf)] ? l[H(0x7e)] : j[I(0xeb)] ? l[I(0xd3)] : j[I(0xa5)] && !j[H(0xa5)][H(0xbf) + 'd'] ? l[H(0x86)] : l[I(0xbc)], n = j[m], [o, p, q, r, s, t, v] = [
                m,
                n[H(0x9b)] ? n[H(0x9b)] : '',
                ![],
                null,
                n[H(0xc8)] ? n[H(0xc8)] : n[l[I(0xec)](n[H(0xef)], 0x716 * 0x5 + 0xad + -0x241a * 0x1)][H(0xc8)],
                j[I(0xc4)] ? j[H(0xc4)] : '',
                l[H(0xd4)](m, l[I(0xd3)])
            ];
        switch (m) {
        case l[H(0xcc)]:
            const w = {};
            w[H(0xda)] = o, w[H(0xdc)] = l[H(0x85)], w[H(0xa8)] = q, w[H(0xde)] = r, w[H(0xaa)] = s, w[I(0xc4)] = t, w[I(0xd2)] = v;
            return w;
            break;
        case l[H(0xab)]:
            const x = {};
            x[I(0xda)] = o, x[H(0xdc)] = p, x[I(0xa8)] = q, x[H(0xde)] = r, x[H(0xaa)] = s, x[H(0xc4)] = t, x[I(0xd2)] = v;
            return x;
            break;
        case l[I(0x7e)]:
            const y = {};
            y[I(0xda)] = o, y[I(0xdc)] = p, y[I(0xa8)] = q, y[I(0xde)] = r, y[I(0xaa)] = s, y[I(0xc4)] = t, y[H(0xd2)] = v;
            return y;
            break;
        case l[H(0xd3)]:
            const z = {};
            z[I(0xda)] = o, z[H(0xdc)] = p, z[I(0xa8)] = q, z[I(0xde)] = r, z[I(0xaa)] = s, z[I(0xc4)] = t, z[H(0xd2)] = v;
            return z;
            break;
        case l[I(0x86)]:
            const A = {};
            A[H(0xda)] = o, A[H(0xdc)] = l[H(0x7f)], A[I(0xa8)] = q, A[H(0xde)] = r, A[H(0xaa)] = s, A[I(0xc4)] = t, A[I(0xd2)] = v, A[I(0x87)] = !![];
            return A;
            break;
        default:
            const B = {};
            B[I(0xda)] = o, B[H(0xdc)] = p, B[I(0xa8)] = !![], B[H(0xde)] = n[H(0xe8)] ? n[H(0xe8)] : null, B[H(0xaa)] = s, B[I(0xc4)] = t, B[H(0xd2)] = v;
            return B;
            break;
        }
    }, downloadFile = async (c, d) => {
        const J = E, K = E, e = {
                'STXAA': J(0xd7) + J(0xdd),
                'rBGXv': function (g, h) {
                    return g(h);
                },
                'xiIcR': J(0x94),
                'wDcHH': J(0x7d),
                'iAUDu': function (g, h) {
                    return g !== h;
                },
                'QiSQk': J(0x78),
                'GNbwE': function (g, h) {
                    return g !== h;
                },
                'cgGeo': J(0xe4),
                'smxOQ': K(0xb6),
                'fqHHO': J(0xb5),
                'qUVmy': J(0xe9)
            }, f = await (-0x13 * 0x10d + 0x26a * 0x1 + 0x118d, axios_1[K(0xcd)])({
                'url': c[K(0xb7)](),
                'method': e[K(0xc3)],
                'responseType': e[J(0xee)]
            });
        await new Promise((g, h) => {
            const L = J, M = J;
            e[L(0x81)](e[L(0xd8)], e[M(0xed)]) ? f[L(0x91)][M(0x9d)]((-0x1 * -0xc46 + 0xeb0 + -0x1af6, fs_1[M(0xb4) + L(0xea)])(d))['on'](e[M(0x9e)], async () => g(!![]))['on'](e[M(0xc7)], i => {
                const N = M, P = M, j = {
                        'Fedxb': e[N(0xf1)],
                        'dwxir': function (k, l) {
                            const O = N;
                            return e[O(0x80)](k, l);
                        },
                        'LmIAJ': e[N(0x9e)],
                        'ZphBi': e[P(0xc7)]
                    };
                e[N(0xa0)](e[N(0xa3)], e[N(0xa3)]) ? j[N(0x91)][N(0x9d)]((0x753 + -0x7 * -0x45d + -0x25de, k[P(0xb4) + P(0xea)])(l))['on'](j[P(0x9c)], async () => q(!![]))['on'](j[N(0x7c)], v => {
                    const Q = N, R = P;
                    q[Q(0x7d)](j[Q(0xc6)], v), j[R(0xe2)](r, new s(v));
                }) : (console[P(0x7d)](e[P(0xf1)], i), e[P(0x80)](h, new Error(i)));
            }) : e = f?.[L(0x88) + L(0x79)];
        });
    }, VerifyMediaMessage = async (d, e, f, g) => {
        const S = E, T = F, h = {
                'UAdzb': function (v, w) {
                    return v && w;
                },
                'ytxeM': function (v, w) {
                    return v(w);
                },
                'WUPsl': S(0xb0),
                'HBRWU': function (v, w, x) {
                    return v(w, x);
                },
                'HRQmH': function (v, w) {
                    return v * w;
                },
                'UOraQ': T(0x82),
                'kxSMz': S(0xcf),
                'ClApB': function (v, w) {
                    return v || w;
                }
            };
        let i, j = {};
        i = d?.[S(0x7b)], j = d?.[T(0xb3)];
        h[T(0xf0)](!i, j) && (i = j?.[T(0x88) + T(0x79)]);
        const k = await h[S(0xd5)](getMediaInfo, i), l = await d[S(0xc5)][T(0xe0)](k[T(0xaa)]);
        if (!l) {
            logger_1[S(0x8d)][T(0x7d)](T(0x95) + S(0xc2) + S(0x98) + i[T(0x89)]);
            return;
        }
        const m = k[S(0xdc)][S(0xb1)]('/')[-0x495 + 0x294 * 0x5 + -0x2 * 0x427][S(0xb1)](';')[0x1 * -0x563 + 0x1 * 0x591 + -0x2e], n = l[T(0xc8)] + '_' + new Date()[T(0xe5)]() + '.' + m, o = (-0x1ff3 + 0x2e7 * -0x1 + -0x116d * -0x2, path_1[T(0xa2)])(__dirname, '..', '..', '..', h[T(0xd9)], n), p = await d[T(0xc5)][T(0xd6) + 'k'](k[T(0xaa)]);
        await h[T(0xc1)](downloadFile, p, o);
        let q;
        if (i?.[T(0xa4) + T(0xbd)]?.[T(0x89)]) {
            const v = await (-0x948 + -0x13c3 + -0x1 * -0x1d0b, getQuotedForMessageId_1[T(0xcd)])(i[T(0xa4) + T(0xbd)][S(0x89)], f[S(0xdb)]);
            q = v?.['id'] || undefined;
        }
        const r = {
            'messageId': h[T(0xd5)](String, i?.[S(0x89)]),
            'ticketId': f['id'],
            'contactId': e ? undefined : g['id'],
            'body': i[T(0xb9)] || i[T(0xc4)] || n,
            'fromMe': e,
            'read': e,
            'mediaUrl': n,
            'mediaType': k[S(0xdc)][T(0xb1)]('/')[0x1121 + 0x17f2 * -0x1 + -0x5 * -0x15d],
            'quotedMsgId': q,
            'timestamp': h[T(0x93)](+i[T(0xcb)], -0x1b42 + -0x131b + 0x3245),
            'status': e ? h[S(0x96)] : h[S(0x84)]
        };
        await f[S(0xb3)]({
            'lastMessage': i[S(0xb9)] || i[T(0xc4)] || n,
            'lastMessageAt': new Date()[S(0xe5)](),
            'answered': h[S(0xa1)](e, ![])
        });
        const s = {};
        s[S(0xc0) + 'a'] = r, s[S(0xdb)] = f[T(0xdb)];
        const t = await (0x17f * -0xd + 0x119d * -0x2 + 0x36ad * 0x1, CreateMessageService_1[T(0xcd)])(s);
        return t;
    };
exports[F(0xcd)] = VerifyMediaMessage;