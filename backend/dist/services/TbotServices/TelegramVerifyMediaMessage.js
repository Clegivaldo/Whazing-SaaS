'use strict';const y=b,z=b;function b(c,d){const e=a();return b=function(f,g){f=f-0x180;let h=e[f];return h;},b(c,d);}(function(c,d){const v=b,w=b,e=c();while(!![]){try{const f=-parseInt(v(0x193))/0x1*(-parseInt(w(0x184))/0x2)+-parseInt(v(0x1b7))/0x3+-parseInt(w(0x1bb))/0x4*(-parseInt(v(0x1a5))/0x5)+parseInt(w(0x1ac))/0x6*(parseInt(v(0x1b8))/0x7)+-parseInt(w(0x1b0))/0x8+parseInt(w(0x186))/0x9*(-parseInt(v(0x1aa))/0xa)+parseInt(v(0x188))/0xb*(parseInt(w(0x191))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x31b10));var __importDefault=this&&this['__importDefault']||function(c){const x=b;return c&&c[x(0x198)]?c:{'default':c};};function a(){const K=['hZLvq','FutHQ','82685FsXved','defineProperty','path','reply_to_message','pipe','30psshnx','video','102bPvUom','TPhKe','default','ERROR\x20DONWLOAD','1542888KzpSgC','file_id','../MessageServices/CreateMessageService','join','text','image/png','getTime','78801VYbQQo','33341qCSMKD','toString','mime_type','20lYLtjP','util','update','tenantId','image/webp','getFile','received','stream','2wLMkFo','telegram','163881VyFgKI','split','956604AqgRLu','ERR_DOWNLOAD_MEDIA::\x20ID:\x20','edited_message','promisify','audio','file_name','sended','message_id','getFileLink','36fMjLMY','../../utils/logger','52743bAFZiP','document','photo','message','writeFile','__esModule','finish','voice','createWriteStream','date','data','mimeType','fileId','axios','sticker','error'];a=function(){return K;};return a();}Object[y(0x1a6)](exports,z(0x198),{'value':!![]});const path_1=require(y(0x1a7)),util_1=require(y(0x1bc)),fs_1=require('fs'),axios_1=__importDefault(require(y(0x1a0))),CreateMessageService_1=__importDefault(require(z(0x1b2))),logger_1=require(y(0x192)),getQuotedForMessageId_1=__importDefault(require('../../helpers/getQuotedForMessageId')),writeFileAsync=(0x0,util_1[z(0x18b)])(fs_1[y(0x197)]),getMediaInfo=c=>{const A=y,B=z,d=c['photo']?'photo':c[A(0x1ab)]?'video':c[B(0x18c)]?'audio':c[B(0x19a)]?A(0x19a):c[B(0x1a1)]&&!c[B(0x1a1)]['is_animated']?'sticker':A(0x194),e=c[d],[f,g,h,i,j,k,l]=[d,e[B(0x1ba)]?e['mime_type']:'',![],null,e[A(0x1b1)]?e[B(0x1b1)]:e[e['length']-0x1][B(0x1b1)],c['caption']?c['caption']:'',d=='voice'];switch(d){case A(0x195):return{'type':f,'mimeType':B(0x1b5),'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case B(0x1ab):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case A(0x18c):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case B(0x19a):return{'type':f,'mimeType':g,'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l};break;case B(0x1a1):return{'type':f,'mimeType':A(0x180),'SAD':h,'fileName':i,'fileId':j,'caption':k,'SAV':l,'SAS':!![]};break;default:return{'type':f,'mimeType':g,'SAD':!![],'fileName':e['file_name']?e[B(0x18d)]:null,'fileId':j,'caption':k,'SAV':l};break;}},downloadFile=async(c,d)=>{const C=y,D=z,e=await(0x0,axios_1[C(0x1ae)])({'url':c[C(0x1b9)](),'method':'GET','responseType':C(0x183)});await new Promise((f,g)=>{const E=C,F=D;'tnjJr'!==E(0x1a3)?e[F(0x19d)][F(0x1a9)]((0x0,fs_1['createWriteStream'])(d))['on'](E(0x199),async()=>f(!![]))['on'](F(0x1a2),h=>{const G=E;console['error'](G(0x1af),h),g(new Error(h));}):e=f?.[F(0x18a)];});},VerifyMediaMessage=async(c,d,e,f)=>{const H=y,I=y;let g,h={};g=c?.[H(0x196)],h=c?.[H(0x1bd)];!g&&h&&(g=h?.[I(0x18a)]);const i=await getMediaInfo(g),j=await c[I(0x185)][H(0x181)](i[I(0x19f)]);if(!j){logger_1['logger']['error'](H(0x189)+g[H(0x18f)]);return;}const k=i[I(0x19e)][H(0x187)]('/')[0x1][H(0x187)](';')[0x0],l=j[I(0x1b1)]+'_'+new Date()[I(0x1b6)]()+'.'+k,m=(0x0,path_1[H(0x1b3)])(__dirname,'..','..','..','public',l),n=await c[I(0x185)][H(0x190)](i[H(0x19f)]);await downloadFile(n,m);let o;if(g?.[H(0x1a8)]?.[I(0x18f)]){if(H(0x1ad)!==H(0x1a4)){const r=await(0x0,getQuotedForMessageId_1[I(0x1ae)])(g[I(0x1a8)][H(0x18f)],e[I(0x1be)]);o=r?.['id']||undefined;}else j['data'][H(0x1a9)]((0x0,k[H(0x19b)])(l))['on']('finish',async()=>q(!![]))['on'](I(0x1a2),u=>{const J=I;q['error'](J(0x1af),u),r(new s(u));});}const p={'messageId':String(g?.[I(0x18f)]),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':g[I(0x1b4)]||g['caption']||l,'fromMe':d,'read':d,'mediaUrl':l,'mediaType':i[H(0x19e)][I(0x187)]('/')[0x0],'quotedMsgId':o,'timestamp':+g[H(0x19c)]*0x3e8,'status':d?I(0x18e):H(0x182)};await e[I(0x1bd)]({'lastMessage':g[H(0x1b4)]||g['caption']||l,'lastMessageAt':new Date()[I(0x1b6)](),'answered':d||![]});const q=await(0x0,CreateMessageService_1[I(0x1ae)])({'messageData':p,'tenantId':e[I(0x1be)]});return q;};exports[z(0x1ae)]=VerifyMediaMessage;