'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x140;let h=e[f];return h;},b(c,d);}const z=b,B=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=parseInt(x(0x17c))/0x1*(parseInt(y(0x184))/0x2)+parseInt(x(0x15f))/0x3*(-parseInt(y(0x16f))/0x4)+parseInt(x(0x175))/0x5+parseInt(x(0x17f))/0x6*(-parseInt(x(0x17e))/0x7)+parseInt(x(0x153))/0x8*(-parseInt(x(0x147))/0x9)+-parseInt(x(0x157))/0xa+parseInt(x(0x178))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x8147e));function a(){const G=['image','fs/promises','Error\x20send\x20message\x20(id:\x20','fluent-ffmpeg','toBuffer','quotedMsg','info','.mp4','../../utils/sleepRandomTime','696TjSxdX','ptt','log','__esModule','3268090hNmIGJ','createdAt','closed','dataValues','broadcastVideo','join','mediaName','mediaType','128373YJSfZL','lte','default','path','defineProperty','text','error','split','Message\x20Update\x20ok','update','../../helpers/socketEmit','entity','mediaUrl','broadcastPhoto','item_id','../../utils/logger','36ZJPlHs','video','__importDefault','ASC','findAll','includes','5100370GfPGqO','instagram','body','7380109pCGhzj','ticket','timestamp','sendMessage\x20media','994795HQzmyO','broadcastText','159411QihKMb','138UbTQOD','chat','contact','../../models/Message',')::\x20','2uNcxls','sequelize','tenantId','sharp','logger','public','pending','\x20|\x20Ticket:\x20','toFormat','95229VeuyDh','directThread','readFile'];a=function(){return G;};return a();}var __importDefault=this&&this[z(0x171)]||function(c){const A=z;return c&&c[A(0x156)]?c:{'default':c};};Object[z(0x163)](exports,'__esModule',{'value':!![]});const promises_1=require(z(0x14b)),fluent_ffmpeg_1=__importDefault(require(z(0x14d))),path_1=require(z(0x162)),sequelize_1=require(z(0x185)),sharp_1=__importDefault(require(z(0x141))),socketEmit_1=__importDefault(require(z(0x169))),Message_1=__importDefault(require(B(0x182))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(z(0x16e)),sleepRandomTime_1=require(z(0x152)),SendMessagesSystemWbot=async(c,d)=>{const C=z,D=z,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':C(0x144),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][D(0x160)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1['default'][C(0x173)]({'where':e,'include':[D(0x181),{'model':Ticket_1[D(0x161)],'as':'ticket','where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:D(0x159)},'isFarewellMessage':!![]},'channel':C(0x176),'whatsappId':c['id']},'include':[C(0x181)]},{'model':Message_1[C(0x161)],'as':D(0x14f),'include':[C(0x181)]}],'order':[[C(0x158),D(0x172)]]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j[C(0x181)]['instagramPK'],l=await c[C(0x16a)][D(0x148)]([k]);try{if(![D(0x180),D(0x164)][D(0x174)](i[D(0x15e)])&&i[D(0x15d)]){const n=(0x0,path_1['join'])(__dirname,'..','..','..',D(0x143)),o=(0x0,path_1[D(0x15c)])(n,i[D(0x15d)]),p=await(0x0,promises_1[D(0x149)])(o);console[D(0x155)](o);if(i[C(0x15e)]==='audio'||i[D(0x15e)]===D(0x154)){const q=i['mediaName'][C(0x166)]('.'),r=(0x0,path_1[D(0x15c)])(n,q[0x0]+D(0x151));await new Promise((t,u)=>{const E=D,F=D;(0x0,fluent_ffmpeg_1[E(0x161)])(o)[F(0x146)]('mp4')['on'](E(0x165),v=>u(v))['on']('end',()=>t(!![]))['saveToFile'](r);});const s=await(0x0,promises_1[D(0x149)])(r);g=await l['broadcastVoice']({'file':s});}if(i['mediaType']===D(0x14a)){const t=await(0x0,sharp_1[D(0x161)])(p)['jpeg']()[C(0x14e)]();g=await l[C(0x16c)]({'file':t});}i[C(0x15e)]===C(0x170)&&(g=await l[C(0x15b)]({'video':p})),logger_1[C(0x142)][D(0x150)](C(0x17b));}[C(0x180),D(0x164)]['includes'](i[C(0x15e)])&&!i[C(0x15d)]&&(g=await l[D(0x17d)](i[C(0x177)]),logger_1[C(0x142)][C(0x150)]('sendMessage\x20text'));const m={...i,...g,'id':i['id'],'timestamp':i['timestamp'],'messageId':g['item_id'],'status':'sended','ack':0x2};await Message_1[D(0x161)][C(0x168)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[D(0x161)])({'tenantId':j[D(0x140)],'type':'chat:ack','payload':{...i[C(0x15a)],'mediaUrl':i[D(0x16b)],'id':i['id'],'timestamp':i[D(0x17a)],'messageId':g[D(0x16d)],'status':'sended','ack':0x2}}),logger_1[D(0x142)][C(0x150)](D(0x167)),await(0x0,sleepRandomTime_1['sleepRandomTime'])({'minMilliseconds':Number(0x7d0),'maxMilliseconds':Number(0xbb8)});}catch(u){const v=i['id'],w=i[C(0x179)]['id'];logger_1[C(0x142)][D(0x165)]('Error\x20message\x20is\x20(tenant:\x20'+d+C(0x145)+w+')'),logger_1[D(0x142)][C(0x165)](C(0x14c)+v+C(0x183)+u);}}};exports[z(0x161)]=SendMessagesSystemWbot;