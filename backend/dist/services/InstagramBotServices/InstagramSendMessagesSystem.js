'use strict';const z=b,A=b;(function(c,d){const x=b,y=b,e=c();while(!![]){try{const f=-parseInt(x(0x1d7))/0x1+parseInt(y(0x1da))/0x2+-parseInt(x(0x1ef))/0x3*(-parseInt(y(0x1b1))/0x4)+parseInt(y(0x1e5))/0x5*(parseInt(x(0x1bd))/0x6)+parseInt(x(0x1cf))/0x7+-parseInt(y(0x1f5))/0x8*(-parseInt(x(0x1d4))/0x9)+-parseInt(y(0x1cd))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x6c9f4));function a(){const F=['quotedMsg','fluent-ffmpeg','log','toFormat','fs/promises','sleepRandomTime','mp4','\x20|\x20Ticket:\x20','broadcastText','end','5VSZIWG','broadcastVideo','default','tenantId','../../utils/sleepRandomTime','defineProperty','public','audio','Error\x20message\x20is\x20(tenant:\x20','findAll','3QCufbh','createdAt','lte','sharp','directThread','sendMessage\x20text','1519112KVDVvi','dataValues','ticket','sended','2226204ICxovy','info','broadcastVoice','path','mediaType','readFile','mediaName','Error\x20send\x20message\x20(id:\x20','broadcastPhoto','__esModule','body','../../models/Ticket','825648vlEHSt','instagram','text','split','contact','../../models/Message','__importDefault','closed','timestamp','error','chat:ack','jpeg','logger','../../utils/logger','Message\x20Update\x20ok','../../helpers/socketEmit','8802090vWDFNl','update','551040oIqZus',')::\x20','mediaUrl','pending','join','18FSffQu','instagramPK','sendMessage\x20media','198428gTEMdF','chat','.mp4','741792RlavjP'];a=function(){return F;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x1af;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[z(0x1c3)]||function(c){return c&&c['__esModule']?c:{'default':c};};Object[z(0x1ea)](exports,A(0x1ba),{'value':!![]});const promises_1=require(z(0x1df)),fluent_ffmpeg_1=__importDefault(require(A(0x1dc))),path_1=require(A(0x1b4)),sequelize_1=require('sequelize'),sharp_1=__importDefault(require(A(0x1f2))),socketEmit_1=__importDefault(require(A(0x1cc))),Message_1=__importDefault(require(A(0x1c2))),Ticket_1=__importDefault(require(z(0x1bc))),logger_1=require(A(0x1ca)),sleepRandomTime_1=require(z(0x1e9)),SendMessagesSystemWbot=async(c,d)=>{const B=A,C=A,e={'fromMe':!![],'messageId':{[sequelize_1['Op']['is']]:null},'status':B(0x1d2),[sequelize_1['Op']['or']]:[{'scheduleDate':{[sequelize_1['Op'][B(0x1f1)]]:new Date()}},{'scheduleDate':{[sequelize_1['Op']['is']]:null}}]},f=await Message_1['default'][C(0x1ee)]({'where':e,'include':[B(0x1c1),{'model':Ticket_1[C(0x1e7)],'as':'ticket','where':{'tenantId':d,[sequelize_1['Op']['or']]:{'status':{[sequelize_1['Op']['ne']]:B(0x1c4)},'isFarewellMessage':!![]},'channel':B(0x1be),'whatsappId':c['id']},'include':[C(0x1c1)]},{'model':Message_1['default'],'as':C(0x1db),'include':[B(0x1c1)]}],'order':[[B(0x1f0),'ASC']]});let g;for(const h of f){const i=h,{ticket:j}=i,k=j[C(0x1c1)][C(0x1d5)],l=await c['entity'][C(0x1f3)]([k]);try{if(!['chat',C(0x1bf)]['includes'](i[B(0x1b5)])&&i['mediaName']){const n=(0x0,path_1[C(0x1d3)])(__dirname,'..','..','..',C(0x1eb)),o=(0x0,path_1['join'])(n,i['mediaName']),p=await(0x0,promises_1['readFile'])(o);console[B(0x1dd)](o);if(i[B(0x1b5)]===C(0x1ec)||i[C(0x1b5)]==='ptt'){const q=i[C(0x1b7)][B(0x1c0)]('.'),r=(0x0,path_1[B(0x1d3)])(n,q[0x0]+B(0x1d9));await new Promise((t,u)=>{const D=B,E=C;(0x0,fluent_ffmpeg_1[D(0x1e7)])(o)[E(0x1de)](E(0x1e1))['on'](E(0x1c6),v=>u(v))['on'](E(0x1e4),()=>t(!![]))['saveToFile'](r);});const s=await(0x0,promises_1[C(0x1b6)])(r);g=await l[B(0x1b3)]({'file':s});}if(i['mediaType']==='image'){const t=await(0x0,sharp_1['default'])(p)[B(0x1c8)]()['toBuffer']();g=await l[B(0x1b9)]({'file':t});}i[C(0x1b5)]==='video'&&(g=await l[B(0x1e6)]({'video':p})),logger_1[B(0x1c9)][B(0x1b2)](C(0x1d6));}[B(0x1d8),'text']['includes'](i[C(0x1b5)])&&!i[B(0x1b7)]&&(g=await l[B(0x1e3)](i[B(0x1bb)]),logger_1[B(0x1c9)]['info'](C(0x1f4)));const m={...i,...g,'id':i['id'],'timestamp':i[C(0x1c5)],'messageId':g['item_id'],'status':B(0x1b0),'ack':0x2};await Message_1[C(0x1e7)][B(0x1ce)]({...m},{'where':{'id':i['id']}}),(0x0,socketEmit_1[B(0x1e7)])({'tenantId':j[C(0x1e8)],'type':B(0x1c7),'payload':{...i[B(0x1f6)],'mediaUrl':i[B(0x1d1)],'id':i['id'],'timestamp':i['timestamp'],'messageId':g['item_id'],'status':B(0x1b0),'ack':0x2}}),logger_1[B(0x1c9)][B(0x1b2)](B(0x1cb)),await(0x0,sleepRandomTime_1[B(0x1e0)])({'minMilliseconds':Number(0x7d0),'maxMilliseconds':Number(0xbb8)});}catch(u){const v=i['id'],w=i[B(0x1af)]['id'];logger_1[B(0x1c9)]['error'](C(0x1ed)+d+B(0x1e2)+w+')'),logger_1['logger'][C(0x1c6)](C(0x1b8)+v+B(0x1d0)+u);}}};exports[A(0x1e7)]=SendMessagesSystemWbot;