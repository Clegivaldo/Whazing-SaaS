'use strict';const w=b,y=b;function a(){const J=['split','getTime','defineProperty','__importDefault','text','item_type','data','path','video','video_versions','585027GYrHWO','áudio','error','media','audio_src','ijfhY','6725094NXZosv','url','length','received','985894lrrKyO','30OdWusj','7EEcguh','__esModule','bxzsG','ERROR\x20DONWLOAD','voice_media','message','11NtakXS','583185UEblSu','image','join','arquivo','axios','tenantId','default','pipe','3jwPAUa','../MessageServices/CreateMessageService','audio','candidates','media_type','5561544IPdWFD','imagem','4zEnGGI','sended','image_versions2','GET','1045956REzGMP','stream','application','2737119XdnoUs'];a=function(){return J;};return a();}function b(c,d){const e=a();return b=function(f,g){f=f-0x129;let h=e[f];return h;},b(c,d);}(function(c,d){const u=b,v=b,e=c();while(!![]){try{const f=parseInt(u(0x15b))/0x1*(parseInt(v(0x14a))/0x2)+-parseInt(u(0x135))/0x3+-parseInt(v(0x12e))/0x4*(-parseInt(u(0x153))/0x5)+parseInt(v(0x146))/0x6*(parseInt(v(0x14c))/0x7)+-parseInt(v(0x12c))/0x8+parseInt(u(0x140))/0x9*(-parseInt(u(0x14b))/0xa)+parseInt(v(0x152))/0xb*(-parseInt(u(0x132))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xc9cdd));var __importDefault=this&&this[w(0x139)]||function(c){const x=w;return c&&c[x(0x14d)]?c:{'default':c};};Object[y(0x138)](exports,'__esModule',{'value':!![]});const path_1=require(y(0x13d)),fs_1=require('fs'),axios_1=__importDefault(require(y(0x157))),CreateMessageService_1=__importDefault(require(w(0x15c))),getExt=c=>{const z=y,A=y,d=c[z(0x136)]('?'),e=d[0x0][A(0x136)]('/'),f=e[e[z(0x148)]-0x1]['split']('.');return f[0x1];},downloadFile=async(c,d)=>{const B=y,C=y,e=await(0x0,axios_1[B(0x159)])({'url':c['toString'](),'method':B(0x131),'responseType':B(0x133)});await new Promise((f,g)=>{const D=C,E=B;e[D(0x13c)][D(0x15a)]((0x0,fs_1['createWriteStream'])(d))['on']('finish',async()=>f(!![]))['on'](E(0x142),h=>{const F=D,G=D;F(0x145)!==G(0x145)?(l=m[G(0x151)][F(0x150)][F(0x143)],n=o['message'][G(0x150)]['media'][F(0x129)],p=q(r['audio_src']),s=F(0x129),t=G(0x141)):(console['error'](F(0x14f),h),g(new Error(h)));});});},VerifyMediaMessage=async(c,d,e,f)=>{const H=y,I=y;let g,h,i,j=H(0x134),k=H(0x156);c['message']?.[I(0x143)]?.[H(0x12b)]===0x1&&(h=c[I(0x151)][I(0x143)],[g]=c[I(0x151)]['media']['image_versions2'][I(0x12a)],i=getExt(g[I(0x147)]),j=H(0x154),k=H(0x12d));c[H(0x151)]?.[H(0x143)]?.['media_type']===0x2&&(h=c['message'][H(0x143)],[g]=c[H(0x151)][I(0x143)][H(0x13f)],i=getExt(g['url']),j=H(0x13e),k='vídeo');c['message']?.[I(0x13b)]==='voice_media'&&(H(0x14e)==='bxzsG'?(h=c['message'][H(0x150)][I(0x143)],g=c[H(0x151)][I(0x150)][H(0x143)]['audio'],i=getExt(g[I(0x144)]),j=H(0x129),k='áudio'):(l=m[H(0x151)][H(0x143)],[n]=o[H(0x151)][H(0x143)][I(0x130)][H(0x12a)],p=q(r[I(0x147)]),s=H(0x154),t='imagem'));const l=e['id']+'_'+h['id']+'_'+new Date()[H(0x137)]()+'.'+i,m=(0x0,path_1[H(0x155)])(__dirname,'..','..','..','public',l),n=c[H(0x151)][H(0x13b)]===H(0x150)?g[I(0x144)]:g[I(0x147)];await downloadFile(n,m);const o={'messageId':String(c[I(0x151)]?.['item_id']),'ticketId':e['id'],'contactId':d?undefined:f['id'],'body':c[H(0x151)]?.[H(0x13a)]||c[H(0x151)]?.['caption']||k,'fromMe':d,'read':d,'mediaUrl':l,'mediaType':j,'quotedMsgId':'','timestamp':new Date()[I(0x137)](),'status':d?H(0x12f):I(0x149)};await e['update']({'lastMessage':c['message']?.[I(0x13a)]||c[H(0x151)]?.['caption']||k,'lastMessageAt':new Date()[I(0x137)](),'answered':d||![]});const p=await(0x0,CreateMessageService_1[I(0x159)])({'messageData':o,'tenantId':e[I(0x158)]});return p;};exports[y(0x159)]=VerifyMediaMessage;