'use strict';const P=b,R=b;(function(c,d){const N=b,O=b,e=c();while(!![]){try{const f=-parseInt(N(0xae))/0x1+parseInt(N(0xa1))/0x2+parseInt(N(0x8e))/0x3+parseInt(O(0xb2))/0x4+-parseInt(O(0xb8))/0x5*(-parseInt(N(0xbb))/0x6)+-parseInt(N(0x9c))/0x7+-parseInt(O(0xb9))/0x8;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xa24ba));function b(c,d){const e=a();return b=function(f,g){f=f-0x8a;let h=e[f];return h;},b(c,d);}var __importDefault=this&&this[P(0x8c)]||function(c){const Q=P;return c&&c[Q(0xb1)]?c:{'default':c};};Object[P(0xa2)](exports,P(0xb1),{'value':!![]});const sequelize_1=require(P(0x9b)),Ticket_1=__importDefault(require(P(0xa3))),UsersQueues_1=__importDefault(require(R(0x9a))),AppError_1=__importDefault(require(R(0xa5))),Queue_1=__importDefault(require(R(0x94))),User_1=__importDefault(require('../../models/User')),ListSettingsService_1=__importDefault(require(P(0x90))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',status:c,date:d,showAll:e,userId:f,withUnreadMessages:g,queuesIds:h,isNotAssignedUser:i,includeNotQueueDefined:j,tenantId:k,profile:l})=>{const S=P,T=P,m=e==S(0xb4)&&l===T(0x8a),n=g&&g==T(0xb4)?'S':'N',o=i&&i==T(0xb4)?'S':'N',p=m?'S':'N',q=h?'S':'N',r=searchParam?'S':'N',s=await(0x0,ListSettingsService_1[S(0x99)])(k),t=s?.[T(0x9d)](F=>{const U=S;return F['key']===U(0xba);})?.[T(0xad)]===S(0xa4)?'S':'N';if(!c&&!m){if(T(0x92)===T(0x92))throw new AppError_1[(S(0x99))](S(0x9e),0x194);else d=['open',T(0xa8),T(0xa7)];}m&&(T(0xb6)!==S(0xb6)?d=T(0xaa):c=[T(0x8d),T(0xa8),S(0xa7)]);const u=await Queue_1[S(0x99)][T(0xa9)]({'where':{'tenantId':k}})>0x0?'S':'N',v=await User_1['default'][S(0x8b)](f);let w;v[T(0x8f)]===T(0x8a)?(w=await Queue_1[T(0x99)][S(0xac)]({'where':{'tenantId':k,'isActive':!![]},'attributes':['id']}),w=w[T(0x97)](H=>{return{'queueId':H['id']};})):w=await UsersQueues_1['default'][T(0xac)]({'where':{'userId':f}});let x=w[T(0x97)](H=>H[S(0xb5)]);x[S(0xb7)](0x0);if(h){const H=[];h[T(0x95)](I=>{const V=T,W=S,J=x[V(0x93)](K=>Number(I)==K);if(J>-0x1){if(V(0x9f)===W(0x9f))H[V(0xb7)](Number(I));else return d[W(0x98)]===W(0xba);}}),x=H['length']?H:[0x0];}!x[S(0xb0)]&&(x=[0x0]);let y;if(l=='admin'){if(T(0xa6)===T(0xaf)){const J=[];h[S(0x95)](K=>{const X=T,Y=T,L=J[X(0x93)](M=>p(K)==M);L>-0x1&&J[X(0xb7)](p(K));}),l=J[T(0xb0)]?J:[0x0];}else y=y=T(0x96);}else{if(T(0xab)===T(0xa0)){const K=i['findIndex'](L=>o(p)==L);K>-0x1&&o[S(0xb7)](p(q));}else y=S(0xaa);}const z=0x1e,A=z*(+pageNumber-0x1),B=await Ticket_1['default'][S(0x9b)]?.[T(0x91)](y,{'replacements':{'tenantId':k,'isQueuesIds':q,'status':c,'isShowAll':p,'isExistsQueueTenant':u,'queuesIdsUser':x,'userId':f,'isUnread':n,'isNotAssigned':o,'isSearchParam':r,'searchParam':'%'+searchParam+'%','limit':z,'offset':A,'isNotViewAssignedTickets':t,'profile':l},'type':sequelize_1['QueryTypes']['SELECT'],'nest':!![]});let C=0x0,D=0x0;if(B?.[T(0xb0)]){if(T(0xb3)==='ESjAj')return g&&h['__esModule']?i:{'default':j};else C=B[0x0][S(0xa9)],D=B[S(0xb0)];}const E=C>A+D;return{'tickets':B||[],'count':C,'hasMore':E};};function a(){const Z=['QrTNi','findAll','value','1155426FUviic','dpkqm','length','__esModule','1513468oaoWxH','BXDyj','true','queueId','nopyu','push','5576415EmiMPO','3217464DDSVgl','NotViewAssignedTickets','6PbvtuA','admin','findByPk','__importDefault','open','3653745rAKyDC','profile','../SettingServices/ListSettingsService','query','sIPeg','findIndex','../../models/Queue','forEach','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isShowAll\x20=\x20\x27N\x27\x20and\x20\x20(\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','map','key','default','../../models/UsersQueues','sequelize','8932049ysWwiJ','find','ERR_NO_STATUS_SELECTED','ZlnPY','ftxpl','1573626UFNDFg','defineProperty','../../models/Ticket','enabled','../../errors/AppError','vEXnu','closed','pending','count','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20(((\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotViewAssignedTickets\x20=\x20\x27S\x27\x20and\x20((t.\x22userId\x22\x20=\x20:userId\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))\x20or\x20(t.\x22userId\x22\x20is\x20null\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))))\x20OR\x20(:isNotViewAssignedTickets\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20'];a=function(){return Z;};return a();}exports[R(0x99)]=ListTicketsService;