'use strict';const O=b,Q=b;(function(c,d){const M=b,N=b,e=c();while(!![]){try{const f=-parseInt(M(0x160))/0x1+parseInt(N(0x15a))/0x2+-parseInt(N(0x173))/0x3+parseInt(M(0x15b))/0x4*(-parseInt(N(0x14b))/0x5)+parseInt(N(0x162))/0x6+-parseInt(N(0x16f))/0x7*(-parseInt(N(0x15c))/0x8)+parseInt(N(0x161))/0x9*(parseInt(N(0x14e))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x7c591));var __importDefault=this&&this[O(0x156)]||function(c){const P=O;return c&&c[P(0x159)]?c:{'default':c};};Object[Q(0x16a)](exports,'__esModule',{'value':!![]});const sequelize_1=require(Q(0x166)),Ticket_1=__importDefault(require(O(0x171))),UsersQueues_1=__importDefault(require('../../models/UsersQueues')),AppError_1=__importDefault(require('../../errors/AppError')),Queue_1=__importDefault(require(O(0x155))),User_1=__importDefault(require(Q(0x16c))),ListSettingsService_1=__importDefault(require(O(0x169))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',status:c,date:d,showAll:e,userId:f,withUnreadMessages:g,queuesIds:h,isNotAssignedUser:i,includeNotQueueDefined:j,tenantId:k,profile:l})=>{const R=O,S=Q,m=e==R(0x165)&&l===S(0x153),n=g&&g=='true'?'S':'N',o=i&&i==R(0x165)?'S':'N',p=m?'S':'N',q=h?'S':'N',r=searchParam?'S':'N',s=await(0x0,ListSettingsService_1['default'])(k),t=s?.[S(0x16b)](F=>{const T=R,U=R;return F[T(0x15e)]===U(0x170);})?.['value']===R(0x14d)?'S':'N';if(!c&&!m)throw new AppError_1[(S(0x15f))]('ERR_NO_STATUS_SELECTED',0x194);m&&(c=[R(0x164),R(0x174),'closed']);const u=await Queue_1[R(0x15f)][R(0x175)]({'where':{'tenantId':k}})>0x0?'S':'N',v=await User_1[R(0x15f)][R(0x14f)](f);let w;v['profile']===S(0x153)?(w=await Queue_1['default'][R(0x15d)]({'where':{'tenantId':k,'isActive':!![]},'attributes':['id']}),w=w[R(0x158)](F=>{const V=R,W=R;if(V(0x163)==='bpFzN')throw new d['default'](W(0x167),0x194);else return{'queueId':F['id']};})):w=await UsersQueues_1[S(0x15f)][S(0x15d)]({'where':{'userId':f}});let x=w[S(0x158)](F=>F[S(0x151)]);x[S(0x168)](0x0);if(h){if('VmBDo'===R(0x16d)){const F=[];h['forEach'](G=>{const X=R,Y=R,H=x[X(0x150)](I=>Number(G)==I);H>-0x1&&F[Y(0x168)](Number(G));}),x=F[S(0x157)]?F:[0x0];}else return{'queueId':d['id']};}!x[S(0x157)]&&(x=[0x0]);let y;l=='admin'?y=y=S(0x14c):y=S(0x176);const z=0x1e,A=z*(+pageNumber-0x1),B=await Ticket_1[R(0x15f)][S(0x166)]?.[S(0x154)](y,{'replacements':{'tenantId':k,'isQueuesIds':q,'status':c,'isShowAll':p,'isExistsQueueTenant':u,'queuesIdsUser':x,'userId':f,'isUnread':n,'isNotAssigned':o,'isSearchParam':r,'searchParam':'%'+searchParam+'%','limit':z,'offset':A,'isNotViewAssignedTickets':t,'profile':l},'type':sequelize_1[S(0x152)][S(0x16e)],'nest':!![]});let C=0x0,D=0x0;if(B?.[R(0x157)]){if('VJmHx'!=='QrqFF')C=B[0x0][S(0x175)],D=B[R(0x157)];else{const I=[];h[R(0x172)](J=>{const Z=S,a0=S,K=I[Z(0x150)](L=>p(J)==L);K>-0x1&&I[a0(0x168)](p(J));}),l=I[S(0x157)]?I:[0x0];}}const E=C>A+D;return{'tickets':B||[],'count':C,'hasMore':E};};function b(c,d){const e=a();return b=function(f,g){f=f-0x14b;let h=e[f];return h;},b(c,d);}function a(){const a1=['../../models/User','VmBDo','SELECT','61691OmAeIi','NotViewAssignedTickets','../../models/Ticket','forEach','1031898aNKWfe','pending','count','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20(((\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotViewAssignedTickets\x20=\x20\x27S\x27\x20and\x20((t.\x22userId\x22\x20=\x20:userId\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))\x20or\x20(t.\x22userId\x22\x20is\x20null\x20and\x20t.status\x20\x20in\x20(\x20:status\x20))))\x20OR\x20(:isNotViewAssignedTickets\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','40DeOwOJ','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20count(*)\x20OVER\x20(\x20)\x20as\x20count,\x0a\x20\x20\x20\x20c.\x22profilePicUrl\x22,\x0a\x20\x20\x20\x20c.\x22name\x22,\x0a\x20\x20\x20\x20u.\x22name\x22\x20as\x20username,\x0a\x20\x20\x20\x20q.queue,\x0a\x20\x20\x20\x20jsonb_build_object(\x27id\x27,\x20w.id,\x20\x27name\x27,\x20w.\x22name\x22\x20,\x20\x27isDeleted\x27\x20,\x20w.\x22isDeleted\x22)\x20whatsapp,\x0a\x20\x20\x20\x20t.*\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22Whatsapps\x22\x20w\x20on\x20(w.id\x20=\x20t.\x22whatsappId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Contacts\x22\x20c\x20on\x20(t.\x22contactId\x22\x20=\x20c.id)\x0a\x20\x20\x20\x20left\x20join\x20\x22Users\x22\x20u\x20on\x20(u.id\x20=\x20t.\x22userId\x22)\x0a\x20\x20\x20\x20left\x20join\x20\x22Queues\x22\x20q\x20on\x20(t.\x22queueId\x22\x20=\x20q.id)\x0a\x20\x20\x20\x20where\x20t.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20c.\x22tenantId\x22\x20=\x20:tenantId\x0a\x20\x20\x20\x20and\x20t.status\x20in\x20(\x20:status\x20)\x0a\x20\x20\x20\x20and\x20coalesce(t.\x22queueId\x22,\x200)\x20in\x20(\x20:queuesIdsUser\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isShowAll\x20=\x20\x27N\x27\x20and\x20\x20(\x0a\x20\x20\x20\x20\x20\x20(:isExistsQueueTenant\x20=\x20\x27S\x27)\x0a\x20\x20\x20\x20\x20\x20or\x20t.\x22userId\x22\x20=\x20:userId\x20or\x20exists\x20(select\x201\x20from\x20\x22ContactWallets\x22\x20cw\x20where\x20cw.\x22walletId\x22\x20=\x20:userId\x20and\x20cw.\x22contactId\x22\x20=\x20t.\x22contactId\x22)\x20)\x0a\x20\x20\x20\x20)\x20OR\x20(:isShowAll\x20=\x20\x27S\x27)\x20OR\x20(t.\x22isGroup\x22\x20=\x20true)\x20OR\x20(:isExistsQueueTenant\x20=\x20\x27N\x27)\x20)\x0a\x20\x20\x20\x20and\x20((\x20:isUnread\x20=\x20\x27S\x27\x20\x20and\x20t.\x22unreadMessages\x22\x20>\x200)\x20OR\x20(:isUnread\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isNotAssigned\x20=\x20\x27S\x27\x20and\x20t.\x22userId\x22\x20is\x20null)\x20OR\x20(:isNotAssigned\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20and\x20((:isSearchParam\x20=\x20\x27S\x27\x20and\x20(\x20/*exists\x20(\x0a\x20\x20\x20\x20\x20\x20select\x201\x20from\x20\x22Messages\x22\x20m\x20where\x20m.\x22ticketId\x22\x20=\x20t.id\x0a\x20\x20\x20\x20\x20\x20and\x20upper(m.body)\x20like\x20upper(:searchParam)\x0a\x20\x20\x20\x20\x20\x20)\x20or\x20*/\x20(t.id::varchar\x20like\x20:searchParam)\x20or\x20(exists\x20(select\x201\x20from\x20\x22Contacts\x22\x20c\x20where\x20c.id\x20=\x20t.\x22contactId\x22\x20and\x20(upper(c.\x22name\x22)\x20like\x20upper(:searchParam)\x20or\x20c.\x22number\x22\x20like\x20:searchParam))))\x20OR\x20(:isSearchParam\x20=\x20\x27N\x27))\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20order\x20by\x20t.\x22updatedAt\x22\x20desc\x0a\x20\x20\x20\x20limit\x20:limit\x20offset\x20:offset\x20;\x0a\x20\x20','enabled','78680DRIRkR','findByPk','findIndex','queueId','QueryTypes','admin','query','../../models/Queue','__importDefault','length','map','__esModule','180972ROYrmi','221948YuIyTO','232RUlfLs','findAll','key','default','367654UYDXcG','1278nsJQSJ','1209156luDJkx','VmmTU','open','true','sequelize','ERR_NO_STATUS_SELECTED','push','../SettingServices/ListSettingsService','defineProperty','find'];a=function(){return a1;};return a();}exports[Q(0x15f)]=ListTicketsService;