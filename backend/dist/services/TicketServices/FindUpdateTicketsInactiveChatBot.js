'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0xd2;let h=e[f];return h;},b(c,d);}const m=b,o=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=parseInt(k(0xd4))/0x1+-parseInt(k(0xed))/0x2*(parseInt(k(0xd8))/0x3)+parseInt(k(0xe9))/0x4*(parseInt(k(0xe4))/0x5)+-parseInt(l(0xd7))/0x6+parseInt(l(0xdb))/0x7*(parseInt(l(0xda))/0x8)+parseInt(k(0xe0))/0x9*(parseInt(k(0xd9))/0xa)+-parseInt(l(0xe2))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xf2ffd));var __importDefault=this&&this[m(0xdf)]||function(c){const n=m;return c&&c[n(0xd3)]?c:{'default':c};};Object[m(0xeb)](exports,'__esModule',{'value':!![]});function a(){const t=['default','userId','10718466EYmLPZ','321WkbwBa','7450XAUwEm','808BZmwoa','137151GuFCPi','QueryTypes','findByPk','ticket:update','__importDefault','16749AQXqZS','all','33721039XSyPqj','update','124345gqynYt','\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20t.id,\x0a\x20\x20\x20\x20--t.\x22contactId\x22,\x0a\x20\x20\x20\x20--t.\x22lastInteractionBot\x22,\x0a\x20\x20\x20\x20--t.status,\x0a\x20\x20\x20\x20--config->\x27configurations\x27,\x0a\x20\x20\x20\x20--concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x20as\x20time_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27type\x27\x20as\x20type_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27destiny\x27\x20as\x20destiny\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22ChatFlow\x22\x20cf\x20on\x20t.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20cf.id\x20=\x20t.\x22chatFlowId\x22\x0a\x20\x20\x20\x20inner\x20join\x20\x22Settings\x22\x20s\x20on\x20s.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20s.\x22key\x22\x20=\x20\x27botTicketActive\x27\x0a\x20\x20\x20\x20cross\x20join\x20lateral\x20json_array_elements(cf.flow->\x27nodeList\x27)\x20as\x20config\x0a\x20\x20\x20\x20where\x20t.\x22chatFlowId\x22::text\x20=\x20s.value\x0a\x20\x20\x20\x20and\x20t.status\x20=\x20\x27pending\x27\x0a\x20\x20\x20\x20and\x20config->>\x27type\x27\x20=\x20\x27configurations\x27\x0a\x20\x20\x20\x20and\x20t.\x22lastInteractionBot\x22\x20<\x20CURRENT_TIMESTAMP\x20-\x20concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x0a\x20\x20\x20\x20and\x20(t.\x22queueId\x22\x20is\x20null\x20and\x20t.\x22userId\x22\x20is\x20null)\x0a\x20\x20','tenantId','type_action','SELECT','296tejrUl','destiny','defineProperty','queueId','13880FuQtWF','map','sequelize','__esModule','1384221RxdjTT'];a=function(){return t;};return a();}const sequelize_1=require(o(0xd2)),Ticket_1=__importDefault(require('../../models/Ticket')),socketEmit_1=__importDefault(require('../../helpers/socketEmit')),FindUpdateTicketsInactiveChatBot=async()=>{const p=m,q=m,c=p(0xe5),d=await Ticket_1[q(0xd5)][p(0xd2)]?.['query'](c,{'type':sequelize_1[q(0xdc)][p(0xe8)]});Promise[p(0xe1)](d[q(0xee)](async e=>{const r=p,s=q;if(!e[r(0xea)])return;const f=await Ticket_1[s(0xd5)][s(0xdd)](e['id']);if(f){const g={'chatFlowId':null,'stepChatFlow':null,'botRetries':0x0,'lastInteractionBot':new Date()};e['type_action']==0x1&&(g[r(0xec)]=e[r(0xea)]),e[s(0xe7)]==0x2&&(g[r(0xd6)]=e[s(0xea)]),await f[r(0xe3)](g),(0x0,socketEmit_1[r(0xd5)])({'tenantId':f[r(0xe6)],'type':s(0xde),'payload':f});}}));};exports['default']=FindUpdateTicketsInactiveChatBot;