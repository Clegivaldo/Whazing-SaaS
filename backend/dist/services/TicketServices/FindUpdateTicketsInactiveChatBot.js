'use strict';const m=b,o=b;(function(c,d){const k=b,l=b,e=c();while(!![]){try{const f=-parseInt(k(0x103))/0x1+-parseInt(l(0x101))/0x2*(parseInt(k(0x100))/0x3)+-parseInt(l(0x115))/0x4*(parseInt(l(0x10c))/0x5)+-parseInt(k(0x113))/0x6+parseInt(l(0x107))/0x7+parseInt(k(0x112))/0x8+-parseInt(l(0x109))/0x9*(-parseInt(k(0x104))/0xa);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0xaf0a6));var __importDefault=this&&this[m(0x106)]||function(c){const n=m;return c&&c[n(0x10d)]?c:{'default':c};};Object[m(0x111)](exports,'__esModule',{'value':!![]});const sequelize_1=require(m(0x10f)),Ticket_1=__importDefault(require(o(0x102))),socketEmit_1=__importDefault(require(m(0x116))),FindUpdateTicketsInactiveChatBot=async()=>{const p=o,q=o,c='\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20t.id,\x0a\x20\x20\x20\x20--t.\x22contactId\x22,\x0a\x20\x20\x20\x20--t.\x22lastInteractionBot\x22,\x0a\x20\x20\x20\x20--t.status,\x0a\x20\x20\x20\x20--config->\x27configurations\x27,\x0a\x20\x20\x20\x20--concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x20as\x20time_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27type\x27\x20as\x20type_action,\x0a\x20\x20\x20\x20config->\x27configurations\x27->\x27notResponseMessage\x27->\x27destiny\x27\x20as\x20destiny\x0a\x20\x20\x20\x20from\x20\x22Tickets\x22\x20t\x0a\x20\x20\x20\x20inner\x20join\x20\x22ChatFlow\x22\x20cf\x20on\x20t.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20cf.id\x20=\x20t.\x22chatFlowId\x22\x0a\x20\x20\x20\x20inner\x20join\x20\x22Settings\x22\x20s\x20on\x20s.\x22tenantId\x22\x20=\x20cf.\x22tenantId\x22\x20and\x20s.\x22key\x22\x20=\x20\x27botTicketActive\x27\x0a\x20\x20\x20\x20cross\x20join\x20lateral\x20json_array_elements(cf.flow->\x27nodeList\x27)\x20as\x20config\x0a\x20\x20\x20\x20where\x20t.\x22chatFlowId\x22::text\x20=\x20s.value\x0a\x20\x20\x20\x20and\x20t.status\x20=\x20\x27pending\x27\x0a\x20\x20\x20\x20and\x20config->>\x27type\x27\x20=\x20\x27configurations\x27\x0a\x20\x20\x20\x20and\x20t.\x22lastInteractionBot\x22\x20<\x20CURRENT_TIMESTAMP\x20-\x20concat(config->\x27configurations\x27->\x27notResponseMessage\x27->\x27time\x27,\x20\x27\x20MINUTES\x27)::interval\x0a\x20\x20\x20\x20and\x20(t.\x22queueId\x22\x20is\x20null\x20and\x20t.\x22userId\x22\x20is\x20null)\x0a\x20\x20',d=await Ticket_1[p(0x108)][p(0x10f)]?.['query'](c,{'type':sequelize_1['QueryTypes'][q(0xff)]});Promise[p(0x105)](d['map'](async e=>{const r=q,s=p;if(!e['destiny'])return;const f=await Ticket_1['default'][r(0x10a)](e['id']);if(f){const g={'chatFlowId':null,'stepChatFlow':null,'botRetries':0x0,'lastInteractionBot':new Date()};e['type_action']==0x1&&(g['queueId']=e[s(0x110)]),e['type_action']==0x2&&(g[r(0x10e)]=e['destiny']),await f[r(0x10b)](g),(0x0,socketEmit_1[r(0x108)])({'tenantId':f[r(0x114)],'type':r(0x117),'payload':f});}}));};exports['default']=FindUpdateTicketsInactiveChatBot;function b(c,d){const e=a();return b=function(f,g){f=f-0xff;let h=e[f];return h;},b(c,d);}function a(){const t=['ticket:update','SELECT','159DQgTTn','53536AgJhHb','../../models/Ticket','698635JosgcG','9021280OUaZEB','all','__importDefault','8706747ZYGrTI','default','36ILEOgE','findByPk','update','5535ANMmYD','__esModule','userId','sequelize','destiny','defineProperty','3027376ufhMGp','8327838cVQRqI','tenantId','3644gjGCQd','../../helpers/socketEmit'];a=function(){return t;};return a();}