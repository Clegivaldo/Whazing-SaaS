'use strict';function b(c,d){const e=a();return b=function(f,g){f=f-0x1a3;let h=e[f];return h;},b(c,d);}const a2=b,a7=b;(function(c,d){const a0=b,a1=b,e=c();while(!![]){try{const f=parseInt(a0(0x1e3))/0x1+-parseInt(a0(0x1cf))/0x2*(-parseInt(a1(0x1ac))/0x3)+parseInt(a1(0x20a))/0x4+-parseInt(a1(0x1ce))/0x5*(parseInt(a1(0x1b0))/0x6)+parseInt(a1(0x1e0))/0x7*(parseInt(a1(0x1a7))/0x8)+-parseInt(a1(0x1d5))/0x9+-parseInt(a1(0x1eb))/0xa;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x6e2e7));function a(){const aj=['createdAt','UrlMessengerWebHook','../libs/Queue','isDeleted','messenger','HasMany','5816390wRwCAj','VIRTUAL','instagramKey','360','qrcode','farewellMessage','HookStatus','retries','DataType','prototype','instagram','Column','UpdatedAt','session','fbPageId','AllowNull','jsonwebtoken','gupshup','AutoIncrement','decorate','tickets','metadata','whatsapp','phone','Model','waba','design:type','length','object','all','tokenAPI','243620Crrkld','BACKEND_URL','hookSessionStatus','getstatus','./Tenant','184mLjuXH','is_open_ia','./ChatFlow','tenantId','design:returntype','273QaCiHF','TEXT','function','chatFlow','24GsHrxB','color','tenant','findAll','urlWabahooks','type','getDataValue','tokenHook','getOwnPropertyDescriptor','default','/fb-messenger-hooks/','wabaBSP','ZIQxw','sign','env','fbObject','/wabahooks/','./ApiConfig','PrimaryKey','updatedAt','urlServiceStatus','authToken','isDefault','10000d','Default','UrlWabaWebHook','XYxoQ','telegram','chatFlowId','add','584770bpiKxO','12986fZYTSp','ENUM','name','dev','CreateTokenWebHook','design:paramtypes','628488AYdYmX','nNRDz','NODE_ENV','Unique','BelongsTo','ForeignKey','JSONB','BeforeCreate','__decorate','now','plugged','95620ZZzIoF','isActive','__esModule','604642rvtiLK','__importDefault'];a=function(){return aj;};return a();}var __decorate=this&&this[a2(0x1dd)]||function(e,f,g,h){const a3=a2,a4=a2;var j=arguments['length'],k=j<0x3?f:h===null?h=Object[a3(0x1b8)](f,g):h,l;if(typeof Reflect==='object'&&typeof Reflect[a3(0x1fe)]===a3(0x1ae))k=Reflect[a3(0x1fe)](e,f,g,h);else{for(var m=e[a3(0x206)]-0x1;m>=0x0;m--)if(l=e[m])k=(j<0x3?l(k):j>0x3?l(f,g,k):l(f,g))||k;}return j>0x3&&k&&Object['defineProperty'](f,g,k),k;},__metadata=this&&this['__metadata']||function(c,d){const a5=a2,a6=a2;if(typeof Reflect===a5(0x207)&&typeof Reflect[a5(0x200)]==='function')return Reflect['metadata'](c,d);},__importDefault=this&&this[a2(0x1e4)]||function(c){const a8=a2;return c&&c[a8(0x1e2)]?c:{'default':c};};Object['defineProperty'](exports,a2(0x1e2),{'value':!![]});const jsonwebtoken_1=require(a2(0x1fb)),sequelize_typescript_1=require('sequelize-typescript'),webHooks_dev_json_1=__importDefault(require('../config/webHooks.dev.json')),auth_1=__importDefault(require('../config/auth')),Queue_1=__importDefault(require(a7(0x1e7))),ApiConfig_1=__importDefault(require(a7(0x1c1))),Tenant_1=__importDefault(require(a7(0x1a6))),Ticket_1=__importDefault(require('./Ticket')),ChatFlow_1=__importDefault(require(a7(0x1a9)));let Whatsapp=class Whatsapp extends sequelize_typescript_1[a7(0x203)]{static[a7(0x1a5)](){throw new Error('Method\x20not\x20implemented.');}get[a2(0x1c9)](){const a9=a2,aa=a7,c=this[a9(0x1b6)]('tokenHook'),d=this[aa(0x1b6)](aa(0x1bb));let e;e=process[a9(0x1be)][a9(0x1a3)];if(process[a9(0x1be)][aa(0x1d7)]===a9(0x1d2)){if(aa(0x1bc)!==aa(0x1bc)){const {secret:g}=k[a9(0x1b9)];if(!l?.[aa(0x1b7)]&&(m[a9(0x1b5)]==='waba'||n['type']==='messenger')){const h=(0x0,s[a9(0x1bd)])({'tenantId':t['tenantId'],'whatsappId':u['id']},g,{'expiresIn':'10000d'});v['tokenHook']=h;}}else e=webHooks_dev_json_1[aa(0x1b9)][aa(0x1b4)];}return e+a9(0x1c0)+d+'/'+c;}get['UrlMessengerWebHook'](){const ab=a7,ac=a2,c=this['getDataValue'](ab(0x1b7));let d;return d=process['env'][ac(0x1a3)],process[ac(0x1be)][ab(0x1d7)]===ac(0x1d2)&&(d=webHooks_dev_json_1[ac(0x1b9)][ac(0x1b4)]),d+ac(0x1ba)+c;}static async[a2(0x1f1)](c){const ad=a7,ae=a2,{status:d,name:e,qrcode:f,number:g,tenantId:h,id:i}=c,j={'name':e,'number':g,'status':d,'qrcode':f,'timestamp':Date[ad(0x1de)](),'type':ae(0x1a4)},k=await ApiConfig_1['default'][ad(0x1b3)]({'where':{'tenantId':h,'sessionId':i}});if(!k)return;await Promise[ae(0x208)](k['map'](l=>{const af=ad,ag=ae;if('FMmFW'===af(0x1d6))e[ag(0x1c5)]=f[ag(0x1c5)];else{if(l[ag(0x1c4)]){if(l[ag(0x1c5)]){if('IqXHm'===af(0x1ca))return g&&h[ag(0x1e2)]?i:{'default':j};else j['authToken']=l['authToken'];}return Queue_1[ag(0x1b9)][af(0x1cd)]('WebHooksAPI',{'url':l['urlServiceStatus'],'type':j[ag(0x1b5)],'payload':j});}}}));}static async[a7(0x1d3)](c){const ah=a7,ai=a7,{secret:d}=auth_1[ah(0x1b9)];if(!c?.[ah(0x1b7)]&&(c[ai(0x1b5)]===ah(0x204)||c[ai(0x1b5)]===ai(0x1e9))){if('jGpvw'!=='dIski'){const e=(0x0,jsonwebtoken_1[ai(0x1bd)])({'tenantId':c[ai(0x1aa)],'whatsappId':c['id']},d,{'expiresIn':ai(0x1c7)});c[ai(0x1b7)]=e;}else return j[ai(0x1c5)]&&(q[ai(0x1c5)]=r[ah(0x1c5)]),m[ah(0x1b9)][ah(0x1cd)]('WebHooksAPI',{'url':n[ai(0x1c4)],'type':o['type'],'payload':p});}}};__decorate([sequelize_typescript_1[a7(0x1c2)],sequelize_typescript_1[a2(0x1fd)],sequelize_typescript_1[a7(0x1f6)],__metadata(a7(0x205),Number)],Whatsapp[a2(0x1f4)],'id',void 0x0),__decorate([sequelize_typescript_1[a2(0x1fa)],sequelize_typescript_1[a7(0x1d8)],(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1[a2(0x1f3)][a7(0x1ad)]),__metadata('design:type',String)],Whatsapp['prototype'],a7(0x1d1),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1f6)])(sequelize_typescript_1[a7(0x1f3)][a2(0x1ad)]),__metadata(a7(0x205),String)],Whatsapp[a2(0x1f4)],a2(0x1f8),void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a2(0x1f3)][a2(0x1ad)]),__metadata(a2(0x205),String)],Whatsapp['prototype'],a2(0x1ef),void 0x0),__decorate([sequelize_typescript_1[a7(0x1f6)],__metadata(a7(0x205),String)],Whatsapp[a2(0x1f4)],'status',void 0x0),__decorate([sequelize_typescript_1[a7(0x1f6)],__metadata(a7(0x205),String)],Whatsapp['prototype'],'battery',void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x205),Boolean)],Whatsapp[a7(0x1f4)],a2(0x1df),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1c8)])(!![]),sequelize_typescript_1[a7(0x1f6)],__metadata(a7(0x205),Boolean)],Whatsapp['prototype'],a2(0x1e1),void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(![]),sequelize_typescript_1[a7(0x1f6)],__metadata(a2(0x205),Boolean)],Whatsapp[a7(0x1f4)],a7(0x1e8),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x205),Number)],Whatsapp[a2(0x1f4)],a2(0x1f2),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1c8)])(![]),sequelize_typescript_1[a2(0x1fa)],sequelize_typescript_1[a2(0x1f6)],__metadata(a2(0x205),Boolean)],Whatsapp[a2(0x1f4)],a2(0x1c6),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1c8)])(null),sequelize_typescript_1[a7(0x1fa)],sequelize_typescript_1[a2(0x1f6)],__metadata('design:type',String)],Whatsapp[a2(0x1f4)],'tokenTelegram',void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1c8)])(null),sequelize_typescript_1[a2(0x1fa)],sequelize_typescript_1[a7(0x1f6)],__metadata(a7(0x205),String)],Whatsapp[a2(0x1f4)],'instagramUser',void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1[a7(0x1fa)],sequelize_typescript_1['Column'],__metadata(a2(0x205),String)],Whatsapp[a2(0x1f4)],a7(0x1ed),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(null),sequelize_typescript_1[a7(0x1fa)],sequelize_typescript_1[a2(0x1f6)],__metadata(a7(0x205),String)],Whatsapp['prototype'],a2(0x1f9),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(null),sequelize_typescript_1[a7(0x1fa)],(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1[a7(0x1f3)][a7(0x1db)]),__metadata(a2(0x205),Object)],Whatsapp[a2(0x1f4)],a2(0x1bf),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(a7(0x201)),(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1[a2(0x1f3)][a2(0x1d0)]('whatsapp',a7(0x1cb),a2(0x1f5),a7(0x1e9))),__metadata(a2(0x205),String)],Whatsapp[a7(0x1f4)],a7(0x1b5),void 0x0),__decorate([sequelize_typescript_1['CreatedAt'],__metadata(a7(0x205),Date)],Whatsapp[a2(0x1f4)],a7(0x1e5),void 0x0),__decorate([sequelize_typescript_1[a2(0x1f7)],__metadata(a7(0x205),Date)],Whatsapp[a2(0x1f4)],a7(0x1c3),void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x205),Boolean)],Whatsapp[a7(0x1f4)],a7(0x1a8),void 0x0),__decorate([sequelize_typescript_1[a2(0x1f6)],__metadata(a2(0x205),Number)],Whatsapp['prototype'],'queue_transf',void 0x0),__decorate([sequelize_typescript_1['Column'],__metadata(a2(0x205),String)],Whatsapp[a7(0x1f4)],a2(0x1b1),void 0x0),__decorate([sequelize_typescript_1[a2(0x1f6)],__metadata(a7(0x205),String)],Whatsapp['prototype'],'number',void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a7(0x1f3)]['JSONB']),__metadata('design:type',Object)],Whatsapp[a2(0x1f4)],a7(0x202),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1ea)])(()=>Ticket_1[a2(0x1b9)]),__metadata(a7(0x205),Array)],Whatsapp[a2(0x1f4)],a7(0x1ff),void 0x0),__decorate([(0x0,sequelize_typescript_1['ForeignKey'])(()=>Tenant_1[a2(0x1b9)]),sequelize_typescript_1['Column'],__metadata(a2(0x205),Number)],Whatsapp[a2(0x1f4)],a7(0x1aa),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1d9)])(()=>Tenant_1[a2(0x1b9)]),__metadata(a7(0x205),Tenant_1['default'])],Whatsapp[a7(0x1f4)],a2(0x1b2),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1da)])(()=>ChatFlow_1[a7(0x1b9)]),sequelize_typescript_1['Column'],__metadata(a7(0x205),Number)],Whatsapp['prototype'],a2(0x1cc),void 0x0),__decorate([(0x0,sequelize_typescript_1[a7(0x1d9)])(()=>ChatFlow_1['default']),__metadata('design:type',ChatFlow_1['default'])],Whatsapp[a2(0x1f4)],a2(0x1af),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1['DataType'][a7(0x1d0)](a2(0x1ee),a2(0x1fc))),__metadata('design:type',String)],Whatsapp[a7(0x1f4)],a7(0x1bb),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1[a7(0x1f6)])(sequelize_typescript_1[a2(0x1f3)][a7(0x1ad)]),__metadata(a2(0x205),String)],Whatsapp[a2(0x1f4)],a7(0x209),void 0x0),__decorate([(0x0,sequelize_typescript_1[a2(0x1c8)])(null),sequelize_typescript_1[a2(0x1fa)],(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1[a2(0x1f3)][a2(0x1ad)]),__metadata(a2(0x205),String)],Whatsapp[a2(0x1f4)],a7(0x1b7),void 0x0),__decorate([(0x0,sequelize_typescript_1['Default'])(null),sequelize_typescript_1['AllowNull'],(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1['DataType'][a7(0x1ad)]),__metadata('design:type',String)],Whatsapp['prototype'],a7(0x1f0),void 0x0),__decorate([(0x0,sequelize_typescript_1['Column'])(sequelize_typescript_1[a7(0x1f3)][a7(0x1ec)]),__metadata(a2(0x205),String),__metadata(a7(0x1d4),[])],Whatsapp['prototype'],a2(0x1c9),null),__decorate([(0x0,sequelize_typescript_1[a2(0x1f6)])(sequelize_typescript_1[a2(0x1f3)][a7(0x1ec)]),__metadata(a2(0x205),String),__metadata(a2(0x1d4),[])],Whatsapp[a2(0x1f4)],a2(0x1e6),null),__decorate([sequelize_typescript_1['AfterUpdate'],__metadata(a7(0x205),Function),__metadata(a7(0x1d4),[Object]),__metadata(a2(0x1ab),Promise)],Whatsapp,a2(0x1f1),null),__decorate([sequelize_typescript_1['BeforeUpdate'],sequelize_typescript_1[a7(0x1dc)],__metadata('design:type',Function),__metadata(a7(0x1d4),[Whatsapp]),__metadata(a7(0x1ab),Promise)],Whatsapp,'CreateTokenWebHook',null),Whatsapp=__decorate([sequelize_typescript_1['Table']],Whatsapp),exports[a7(0x1b9)]=Whatsapp;