'use strict';const q=b,s=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=-parseInt(o(0x145))/0x1*(-parseInt(o(0x11e))/0x2)+parseInt(o(0x131))/0x3*(-parseInt(p(0x121))/0x4)+-parseInt(p(0x11f))/0x5*(-parseInt(o(0x153))/0x6)+parseInt(p(0x11b))/0x7*(-parseInt(p(0x110))/0x8)+parseInt(o(0x12e))/0x9+-parseInt(p(0x115))/0xa*(parseInt(p(0x116))/0xb)+parseInt(o(0x12d))/0xc*(parseInt(p(0x146))/0xd);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x9b643));var __importDefault=this&&this[q(0x149)]||function(c){const r=q;return c&&c[r(0x148)]?c:{'default':c};};Object[q(0x155)](exports,'__esModule',{'value':!![]}),exports['getIO']=exports[q(0x10e)]=void 0x0;const socket_io_1=require(q(0x124)),socket_io_redis_1=__importDefault(require(q(0x15a))),AppError_1=__importDefault(require(q(0x14c))),decodeTokenSocket_1=__importDefault(require(s(0x157))),logger_1=require(s(0x144)),User_1=__importDefault(require('../models/User')),Chat_1=__importDefault(require(s(0x10f)));let io;const initIO=c=>{const t=q,u=s;io=new socket_io_1['Server'](c,{'cors':{'origin':'*'},'pingTimeout':0x2bf20,'pingInterval':0xea60});const d={'host':process[t(0x13d)][t(0x139)],'port':Number(process[u(0x13d)][t(0x127)]),'username':process[t(0x13d)][t(0x13f)],'password':process[t(0x13d)][u(0x11d)]},e=socket_io_redis_1[t(0x14b)];return io[u(0x130)](e(d)),io[t(0x132)](async(f,g)=>{const v=t,w=t;try{const h=f?.[v(0x117)]?.['auth']?.[v(0x12f)],i=(0x0,decodeTokenSocket_1[v(0x14b)])(h);if(i[w(0x141)]){if(v(0x120)===v(0x135))i['logger'][w(0x113)](v(0x137)+j),k[v(0x147)](w(0x154)+l['id']),m(new n(v(0x150)));else{const k=f?.['handshake']?.[w(0x129)];f[v(0x117)][w(0x129)]={...k,...i[v(0x119)],'id':String(i['data']['id']),'tenantId':String(i['data'][v(0x12a)])};const l=await User_1[w(0x14b)][w(0x114)](i[v(0x119)]['id'],{'attributes':['id','tenantId',v(0x126),v(0x112),w(0x159),w(0x111),w(0x143),'lastOnline']});f[w(0x117)][w(0x129)][w(0x11a)]=l,g();}}g(new Error(v(0x150)));}catch(m){if(w(0x136)!==v(0x10d))logger_1['logger'][v(0x113)](v(0x137)+f),f['emit'](w(0x154)+f['id']),g(new Error(w(0x150)));else return g&&h['__esModule']?i:{'default':j};}}),io['on'](t(0x12b),f=>{const x=t,y=u,{tenantId:g}=f[x(0x117)][y(0x129)];g&&('BdPqV'==='oGVSJ'?(i['logger'][x(0x142)]('Client\x20joined\x20a\x20ticket\x20channel\x20'+j+':'+k),l[y(0x138)](m+':'+n)):(logger_1[x(0x128)][x(0x142)]({'message':x(0x122),'data':f[y(0x117)][x(0x129)]}),f[y(0x138)](g[y(0x11c)]()),f['on'](g+x(0x14f),async i=>{const z=y,A=y;if(z(0x13a)!=='UMpnC')f[A(0x128)]['info']({'message':'SOCKET\x20Client\x20disconnected\x20,\x20'+g+',\x20'+h});else{const k=await User_1[z(0x14b)][A(0x114)](i['userId']);await k[A(0x151)]({'isOnline':!![]}),f[z(0x147)](i[z(0x12a)]+z(0x123),k);}}),f['on'](g+y(0x14e),i=>{const B=x,C=x;B(0x15b)!=='FhpOH'?(logger_1[B(0x128)][B(0x142)](C(0x12c)+g+':'+i),f[B(0x138)](g+':'+i)):(i['logger'][C(0x142)](C(0x13e)+j+':'+k+B(0x15c)),l[B(0x138)](m+':'+n));}),f['on'](g+':joinNotification',()=>{const D=x,E=x;D(0x152)!==D(0x14a)?(logger_1['logger'][E(0x142)]('A\x20client\x20joined\x20notification\x20channel\x20'+g+E(0x13b)),f[D(0x138)](g+E(0x13b))):(g['logger'][D(0x142)](D(0x140)+h+E(0x13b)),i[E(0x138)](j+E(0x13b)));}),f['on'](g+x(0x13c),i=>{const F=x,G=x;if(F(0x158)===F(0x158))logger_1[F(0x128)][F(0x142)](G(0x13e)+g+':'+i+'\x20tickets\x20channel.'),f['join'](g+':'+i);else{if(!f)throw new i[(F(0x14b))](F(0x118));return h;}}),Chat_1[x(0x14b)][y(0x133)](f))),f['on'](y(0x14d),i=>{const H=y,I=y;if('JUopz'!==H(0x125))logger_1[H(0x128)][H(0x142)]({'message':H(0x156)+g+',\x20'+i});else throw new d[(H(0x14b))]('Socket\x20IO\x20not\x20initialized');});}),io;};exports['initIO']=initIO;const getIO=()=>{const J=s,K=q;if(!io)throw new AppError_1[(J(0x14b))](J(0x118));return io;};exports[s(0x134)]=getIO;function b(c,d){const e=a();return b=function(f,g){f=f-0x10d;let h=e[f];return h;},b(c,d);}function a(){const L=['../utils/logger','1TWryMd','13FmBSPG','emit','__esModule','__importDefault','uvfTF','default','../errors/AppError','disconnect',':joinChatBox',':userVerified','authentication\x20error','update','SVPPQ','564KkASTp','tokenInvalid:','defineProperty','SOCKET\x20Client\x20disconnected\x20,\x20','./decodeTokenSocket','DFxiD','profile','socket.io-redis','YzfYW','\x20tickets\x20channel.','XyZEC','initIO','./socketChat/Chat','155912GMplOO','status','email','warn','findByPk','52140VuuIaD','1793jPjJoE','handshake','Socket\x20IO\x20not\x20initialized','data','user','28JxGVhX','toString','IO_REDIS_PASSWORD','151304yUpPwA','27060aaSjtV','qzJbb','20hjUatk','Client\x20connected\x20in\x20tenant',':updateStatusUser','socket.io','kYGNF','name','IO_REDIS_PORT','logger','auth','tenantId','connection','Client\x20joined\x20a\x20ticket\x20channel\x20','14162052lUAxxu','360630SVLtMf','token','adapter','144180wLLWsb','use','register','getIO','WCVjw','YLGDh','tokenInvalid:\x20','join','IO_REDIS_SERVER','UMpnC',':notification',':joinTickets','env','A\x20client\x20joined\x20to\x20','IO_REDIS_USERNAME','A\x20client\x20joined\x20notification\x20channel\x20','isValid','info','lastLogin'];a=function(){return L;};return a();}