'use strict';const q=b,s=b;(function(c,d){const o=b,p=b,e=c();while(!![]){try{const f=-parseInt(o(0x131))/0x1+parseInt(o(0x15b))/0x2*(-parseInt(o(0x125))/0x3)+parseInt(o(0x15a))/0x4+parseInt(o(0x137))/0x5*(-parseInt(p(0x13a))/0x6)+parseInt(p(0x13d))/0x7+-parseInt(o(0x155))/0x8*(parseInt(p(0x13c))/0x9)+-parseInt(o(0x122))/0xa*(-parseInt(p(0x15c))/0xb);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x7f032));function a(){const L=['tokenInvalid:','lastLogin','logger','./socketChat/Chat','default','790933gIflAr','Server','dbFeS','register','HMHyX','A\x20client\x20joined\x20notification\x20channel\x20','90nmbjSm','__importDefault',':joinChatBox','109620QXsYNB','tokenInvalid:\x20','9UcbWwH','6604486GGmDkz','disconnect','handshake','auth','YDdGo',':updateStatusUser',':joinNotification','../utils/logger','RJsDs','getIO','IO_REDIS_USERNAME','../errors/AppError','data','YhzXs','initIO','SKSeT','emit','\x20tickets\x20channel.','lastOnline','IO_REDIS_SERVER','info','Client\x20joined\x20a\x20ticket\x20channel\x20','defineProperty','user','5205936rOslJp','authentication\x20error','./decodeTokenSocket','env','Socket\x20IO\x20not\x20initialized','3500184bIIgcy','2YuaaHY','2134sixSty',':userVerified','email','../models/User','Client\x20connected\x20in\x20tenant','update','tenantId','__esModule','findByPk','isValid','warn','connection','LDkOg','73690VybzeE','toString','status','2872059DmQCEU','use','A\x20client\x20joined\x20to\x20','name',':notification','join','dQPWx'];a=function(){return L;};return a();}var __importDefault=this&&this[q(0x138)]||function(c){const r=q;return c&&c[r(0x163)]?c:{'default':c};};function b(c,d){const e=a();return b=function(f,g){f=f-0x122;let h=e[f];return h;},b(c,d);}Object[q(0x153)](exports,s(0x163),{'value':!![]}),exports[q(0x146)]=exports[q(0x14b)]=void 0x0;const socket_io_1=require('socket.io'),socket_io_redis_1=__importDefault(require('socket.io-redis')),AppError_1=__importDefault(require(q(0x148))),decodeTokenSocket_1=__importDefault(require(s(0x157))),logger_1=require(s(0x144)),User_1=__importDefault(require(q(0x15f))),Chat_1=__importDefault(require(q(0x12f)));let io;const initIO=c=>{const t=s,u=s;io=new socket_io_1[(t(0x132))](c,{'cors':{'origin':'*'},'pingTimeout':0x2bf20,'pingInterval':0xea60});const d={'host':process[u(0x158)][t(0x150)],'port':Number(process[t(0x158)]['IO_REDIS_PORT']),'username':process[t(0x158)][u(0x147)],'password':process['env']['IO_REDIS_PASSWORD']},e=socket_io_redis_1[u(0x130)];return io['adapter'](e(d)),io[t(0x126)](async(f,g)=>{const v=t,w=u;if('xhCUc'!==v(0x133))try{if(v(0x145)===w(0x135))i[w(0x12e)][w(0x151)](w(0x152)+j+':'+k),l[w(0x12a)](m+':'+n);else{const i=f?.[v(0x13f)]?.[w(0x140)]?.['token'],j=(0x0,decodeTokenSocket_1[w(0x130)])(i);if(j[w(0x165)]){const k=f?.[v(0x13f)]?.[w(0x140)];f[w(0x13f)][w(0x140)]={...k,...j[w(0x149)],'id':String(j['data']['id']),'tenantId':String(j['data'][v(0x162)])};const l=await User_1[w(0x130)][w(0x164)](j[v(0x149)]['id'],{'attributes':['id',w(0x162),v(0x128),w(0x15e),'profile',w(0x124),w(0x12d),v(0x14f)]});f['handshake']['auth'][v(0x154)]=l,g();}g(new Error(v(0x156)));}}catch(m){logger_1['logger'][v(0x166)](v(0x13b)+f),f['emit'](v(0x12c)+f['id']),g(new Error(w(0x156)));}else i['logger'][w(0x166)](v(0x13b)+j),k[v(0x14d)](w(0x12c)+l['id']),m(new n('authentication\x20error'));}),io['on'](t(0x167),f=>{const x=u,y=u,{tenantId:g}=f[x(0x13f)][x(0x140)];g&&(logger_1['logger'][x(0x151)]({'message':x(0x160),'data':f['handshake'][x(0x140)]}),f[x(0x12a)](g[y(0x123)]()),f['on'](g+y(0x15d),async h=>{const z=x,A=x;if('dQPWx'===z(0x12b)){const i=await User_1['default'][z(0x164)](h['userId']);await i[A(0x161)]({'isOnline':!![]}),f['emit'](h[A(0x162)]+z(0x142),i);}else i[A(0x12e)][z(0x151)]('A\x20client\x20joined\x20to\x20'+j+':'+k+z(0x14e)),l['join'](m+':'+n);}),f['on'](g+y(0x139),h=>{const B=y,C=y;logger_1[B(0x12e)]['info'](B(0x152)+g+':'+h),f[C(0x12a)](g+':'+h);}),f['on'](g+y(0x143),()=>{const D=y,E=x;if(D(0x14a)!==D(0x14c))logger_1[D(0x12e)][E(0x151)](D(0x136)+g+':notification'),f[D(0x12a)](g+D(0x129));else return g&&h[E(0x163)]?i:{'default':j};}),f['on'](g+':joinTickets',h=>{const F=x,G=x;logger_1[F(0x12e)]['info'](F(0x127)+g+':'+h+F(0x14e)),f[F(0x12a)](g+':'+h);}),Chat_1[y(0x130)][x(0x134)](f)),f['on'](x(0x13e),h=>{const H=y,I=y;if('LDkOg'!==H(0x168)){if(!f)throw new i[(H(0x130))](H(0x159));return h;}else logger_1[H(0x12e)][H(0x151)]({'message':'SOCKET\x20Client\x20disconnected\x20,\x20'+g+',\x20'+h});});}),io;};exports[q(0x14b)]=initIO;const getIO=()=>{const J=s,K=s;if(!io){if(J(0x141)!==J(0x141))g[K(0x12e)][J(0x151)](K(0x136)+h+J(0x129)),i['join'](j+J(0x129));else throw new AppError_1[(K(0x130))](J(0x159));}return io;};exports['getIO']=getIO;